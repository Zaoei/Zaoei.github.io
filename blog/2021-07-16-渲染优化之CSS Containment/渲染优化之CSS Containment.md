---
slug: Containment_
title: æ¸²æŸ“ä¼˜åŒ–ä¹‹CSS Containment.md
authors: Zaoei
tags: [css, optimize]
---

<!--truncate-->

# å¼•è¨€

åœ¨å¼€å§‹ä»‹ç»ä»Šå¤©çš„ä¸»è§’ _CSS Containment_ ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€äº›å‰ç½®çŸ¥è¯†å›æµå’Œé‡ç»˜ï¼Œæ–¹ä¾¿æˆ‘ä»¬ç†è§£ä»¥åŠåº”ç”¨çš„åœºæ™¯ã€‚

## ç®€å•å›å¿†ä¸‹å›æµå’Œé‡ç»˜

- å›æµï¼ˆReflowï¼‰ï¼šå½“æµè§ˆå™¨å¿…é¡»é‡æ–°å¤„ç†å’Œç»˜åˆ¶éƒ¨åˆ†æˆ–å…¨éƒ¨é¡µé¢æ—¶ï¼Œå›æµå°±ä¼šå‘ç”Ÿï¼Œä¾‹å¦‚å…ƒç´ çš„è§„æ¨¡å°ºå¯¸ï¼Œå¸ƒå±€ï¼Œéšè—ç­‰æ”¹å˜è€Œéœ€è¦é‡æ–°æ„å»ºã€‚
- é‡ç»˜ï¼ˆRepaintï¼‰ï¼šå½“æ”¹å˜å…ƒç´ çš„éƒ¨åˆ†å±æ€§è€Œä¸å½±å“å¸ƒå±€æ—¶ï¼Œé‡ç»˜å°±ä¼šå‘ç”Ÿã€‚ä¾‹å¦‚æ”¹å˜å…ƒç´ çš„èƒŒæ™¯é¢œè‰²ã€å­—ä½“é¢œè‰²ç­‰ã€‚

## å›æµä¼šé€ æˆä»€ä¹ˆï¼Ÿ

> Reflows are very expensive in terms of performance, and is one of the main causes of slow DOM scripts, In many cases, they are equivalent to laying out the entire page again.

é€šè¿‡ç¿»è¯‘ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå›æµåœ¨æ€§èƒ½æ–¹é¢æ¶ˆè€—éå¸¸å¤§ï¼Œæ˜¯å¾ˆå¤š DOM åŠ è½½æ…¢çš„åŸå› ä¹‹ä¸€ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œå®ƒä»¬ç›¸å½“äºå†æ¬¡æ¸²æŸ“æ•´ä¸ªé¡µé¢ã€‚

æ¥ä¸‹æ¥ï¼Œæ¥çœ‹çœ‹æœ‰å“ªäº›è¡Œä¸ºä¼šè§¦å‘å›æµ/é‡ç»˜ã€‚

### è§¦å‘å›æµ/é‡ç»˜

- æ·»åŠ ï¼Œåˆ é™¤ï¼Œæ›´æ–° DOM èŠ‚ç‚¹æ—¶ä¼šå‘ç”Ÿå›æµ
- è®¾ç½®å…ƒç´ çš„å±æ€§ä¸º`display:none` æ—¶å‘ç”Ÿå›æµ
- è®¾ç½®å…ƒç´ çš„å±æ€§`visibility: hidden` æ—¶å‘ç”Ÿé‡ç»˜
- DOM èŠ‚ç‚¹ä¸Šå­˜åœ¨åŠ¨ç”»å±æ€§ä¹Ÿå°†è§¦å‘å›æµ
- è°ƒæ•´çª—å£çš„å¤§å°å°†è§¦å‘å›æµ
- `font-style` æ›´æ”¹å­—ä½“é£æ ¼ä¼šæ”¹å˜å…ƒç´ çš„å‡ ä½•å½¢çŠ¶ã€‚ è¿™æ„å‘³ç€å®ƒå¯èƒ½ä¼šå½±å“é¡µé¢ä¸Šå…¶ä»–å…ƒç´ çš„ä½ç½®æˆ–å¤§å°,è§¦å‘å›æµ
- æ·»åŠ æˆ–åˆ é™¤æ ·å¼æ–‡ä»¶å°†å¯¼è‡´å›æµ/é‡ç»˜
- é€šè¿‡ JavaScript è·å–å…ƒç´ çš„å¤§å°ç­‰ï¼Œç”±äºéœ€è¦ç¡®ä¿è·å–åˆ°çš„å€¼ä¸ºæœ€æ–°çš„ï¼Œæµè§ˆå™¨éƒ½ä¼šå…ˆæ‰§è¡Œä¸€æ¬¡å›æµæ¥ä¿è¯å€¼çš„æ­£ç¡®ã€‚ä¾‹å¦‚ _offsetXXX_ã€_clientXXX_ å’Œ _scrollXXX_ ç­‰

### é‡ç»˜å›æµä¼˜åŒ–æ–¹æ¡ˆ

çŸ¥é“äº†è§¦å‘å›æµ/é‡ç»˜çš„åŸå› ï¼Œé‚£ä¹ˆå°±èƒ½æ ¹æ®è¿™äº›åŸå› ï¼Œåˆ¶å®šç›¸åº”çš„ä¼˜åŒ–æ–¹æ¡ˆï¼Œå¦‚ä¸‹ã€‚

- é¿å…ä½¿ç”¨è§¦å‘é‡ç»˜å›æµçš„ CSS å±æ€§ã€‚
- å°½é‡å‡å°‘ JS æ“ä½œä¿®æ”¹ DOM çš„ CSS æ¬¡æ•°ã€‚
- å°†é¢‘ç¹é‡ç»˜å›æµçš„ DOM å…ƒç´ å•ç‹¬ä½œä¸ºä¸€ä¸ªç‹¬ç«‹å›¾å±‚ï¼Œé‚£ä¹ˆè¿™ä¸ª DOM å…ƒç´ çš„é‡ç»˜å’Œå›æµå½±å“åªä¼šåœ¨è¿™ä¸ªå›¾å±‚ä¸­ã€‚

ç»è¿‡äº†ä¼˜åŒ–åï¼Œå›æµå’Œé‡ç»˜çš„æ¬¡æ•°å·²ç»å‡å°‘ï¼Œä½†æ˜¯ä¸å¯é¿å…çš„ï¼Œç”±äºå„ç§åŸå› ï¼Œè¿˜æ˜¯ä¼šäº§ç”Ÿå›æµå’Œé‡ç»˜ã€‚

è¯•æƒ³ä¸€ä¸‹ï¼Œæœ‰ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„é¡µé¢ï¼Œå½“ç”¨æˆ·ç§»åŠ¨é¼ æ ‡åˆ°ä¸€ä¸ªå…ƒç´ ä¸Šï¼Œè§¦å‘è¿™ä¸ªå…ƒç´ `hover`ï¼Œè¿™ä¸ª`hover`çš„æ•ˆæœæ˜¯ä½¿è¿™ä¸ªå…ƒç´ å®½é«˜å‘ç”Ÿæ”¹å˜ï¼ˆ`width`ã€`height`ï¼‰ï¼Œå½“å…ƒç´ çš„å®½é«˜å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæµè§ˆå™¨éœ€è¦è€ƒè™‘åˆ°æ‰€æœ‰å…ƒç´ ï¼Œæ˜¯å¦å‘ç”Ÿäº†ç›¸åº”çš„æ›´æ”¹ï¼Œæ‰€ä»¥æµè§ˆå™¨éœ€è¦å¯¹æ•´ä¸ªé¡µé¢è¿›è¡Œé‡æ–°å¸ƒå±€ï¼Œè€Œå®é™…ä¸Šæ”¹å˜çš„å¯èƒ½åªæœ‰é¡µé¢çš„ä¸€å°éƒ¨åˆ†ï¼Œé¡µé¢å¤§éƒ¨åˆ†å†…å®¹æ˜¯ä¿æŒä¸å˜çš„ã€‚è¿™å¯¹äºæ€§èƒ½æ¥è¯´ï¼Œæ— ç–‘æ˜¯ååˆ†å·®çš„ã€‚

é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§åŠæ³•ï¼Œèƒ½å¤Ÿè®©æµè§ˆå™¨è¿›è¡Œå±€éƒ¨çš„å›æµé‡ç»˜ï¼Œä»è€Œè¾¾åˆ°ä¼˜åŒ–æ€§èƒ½çš„ç›®çš„å‘¢ï¼Ÿæˆ–è€…è¯´ï¼Œå‡å°‘å›æµæ—¶äº§ç”Ÿçš„æ€§èƒ½æ¶ˆè€—ã€‚ç­”æ¡ˆæ˜¯æœ‰çš„ï¼Œå°±æ˜¯ä»Šå¤©æ‰€è¦è®¤è¯†çš„ _CSS Containment_

# CSS Containment

> CSS Containment ä¸»è¦æ˜¯é€šè¿‡å…è®¸å¼€å‘è€…å°†æŸäº›å­æ ‘ä»é¡µé¢ä¸­ç‹¬ç«‹å‡ºæ¥ï¼Œä»è€Œæé«˜é¡µé¢çš„æ€§èƒ½ã€‚å¦‚æœæµè§ˆå™¨çŸ¥é“é¡µé¢ä¸­çš„æŸéƒ¨åˆ†æ˜¯ç‹¬ç«‹çš„ï¼Œå°±èƒ½å¤Ÿä¼˜åŒ–æ¸²æŸ“å¹¶è·å¾—æ€§èƒ½æå‡ã€‚

ç”±äºæœ‰å¾ˆå¤šçš„äº¤äº’æˆ–è€…å¤æ‚çš„æƒ…å†µï¼Œéœ€è¦è§¦å‘å›æµï¼Œé‡æ–°æ¸²æŸ“æ•´ä¸ªé¡µé¢ã€‚ä¸ºäº†æ”¹è¿›è¿™ä¸ªï¼Œæµè§ˆå™¨å¿…é¡»è¯†åˆ«æœ‰å“ªäº›éƒ¨åˆ†æ˜¯ç‹¬ç«‹çš„ã€‚å½“ä»–ä»¬çš„å­å…ƒç´ æœ‰å˜åŒ–æ—¶ï¼Œæµè§ˆå™¨çš„æ¸²æŸ“å¼•æ“èƒ½å¤Ÿè¯†åˆ«åˆ°ï¼Œåªå¯¹éƒ¨åˆ†å…ƒç´ åšå›æµé‡ç»˜ï¼Œè€Œä¸å¯¹æ•´ä¸ªé¡µé¢è¿›è¡Œã€‚

è¯†åˆ«è¿™ä¸ªæ ‡å‡†çš„å±æ€§å°±æ˜¯ `contain` ã€‚

## contain

é€šè¿‡ `contain` å±æ€§å‘Šè¯‰æµè§ˆå™¨ï¼Œè¿™äº›èŠ‚ç‚¹æ˜¯ç‹¬ç«‹çš„ã€‚

## è¯­æ³•ï¼š

```javascript
div {
  contain: none; /* è¡¨ç¤ºå…ƒç´ å°†æ­£å¸¸æ¸²æŸ“ï¼Œæ²¡æœ‰åŒ…å«è§„åˆ™ */
  contain: layout; /* è¡¨ç¤ºå…ƒç´ å¤–éƒ¨æ— æ³•å½±å“å…ƒç´ å†…éƒ¨çš„å¸ƒå±€ï¼Œåä¹‹äº¦ç„¶ */
  contain: paint; /* è¡¨ç¤ºè¿™ä¸ªå…ƒç´ çš„å­å­™èŠ‚ç‚¹ä¸ä¼šåœ¨å®ƒè¾¹ç¼˜å¤–æ˜¾ç¤ºã€‚å¦‚æœä¸€ä¸ªå…ƒç´ åœ¨è§†çª—å¤–æˆ–å› å…¶ä»–åŸå› å¯¼è‡´ä¸å¯è§ï¼Œåˆ™åŒæ ·ä¿è¯å®ƒçš„å­å­™èŠ‚ç‚¹ä¸ä¼šè¢«æ˜¾ç¤ºã€‚ */
  contain: size; /* è¡¨ç¤ºè¿™ä¸ªå…ƒç´ çš„å°ºå¯¸è®¡ç®—ä¸ä¾èµ–äºå®ƒçš„å­å­™å…ƒç´ çš„å°ºå¯¸ */

  contain: content; /* ç­‰ä»·äº contain: layout paint */
  contain: strict; /* ç­‰ä»·äº contain: size layout paint */
}
```

[ä¸€ä¸ªä¾‹å­](https://codepen.io/zaoei/pen/MWyJrwN)

### Layout

> This value turns on layout containment for the element. This ensures that the containment box is totally opaque for layout purposes; nothing outside can affect its internal layout, and vice versa.

è®¾ç½®äº† `layout` å±æ€§ï¼Œå°±æ˜¯å‘Šè¯‰æµè§ˆå™¨å½“å‰å…ƒç´ å†…éƒ¨çš„æ ·å¼å˜åŒ–ä¸ä¼šå¼•èµ·å…ƒç´ å¤–éƒ¨çš„æ ·å¼å˜åŒ–ã€‚å¹¶ä¸”ï¼Œå…ƒç´ å¤–éƒ¨çš„æ ·å¼å˜åŒ–ä¹Ÿä¸ä¼šå¼•èµ·å…ƒç´ å†…éƒ¨çš„æ ·å¼å˜åŒ–ã€‚è¿™æ ·ï¼Œæµè§ˆå™¨å°±å¯ä»¥ç›¸åº”çš„å‡å°‘æ¸²æŸ“å…ƒç´ ï¼Œæé«˜æ¸²æŸ“çš„æ€§èƒ½ã€‚

å¦‚æœè®¾ç½®äº† `layout` å±æ€§çš„å…ƒç´ ï¼Œè¢«é®æŒ¡ï¼Œå¦‚å±å¹•å¤–ã€‚åˆ™æµè§ˆå™¨ä¼šæŠŠè¯¥å…ƒç´ ç›¸å…³çš„å¤„ç†ï¼Œæ”¾åˆ°è¾ƒä½çš„ä¼˜å…ˆçº§ä¸­ã€‚

```javascript
.container li {
    padding: 10px;
    height: 100px;

    contain: layout;
}
```

![8fcea485affb42fe9f173f2c26f07691_tplv-k3u1fbpfcp-watermark.gif](./imgs/8fcea485affb42fe9f173f2c26f07691_tplv-k3u1fbpfcp-watermark.gif)
å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç”±äºå…ƒç´ å†…éƒ¨çš„æ ·å¼å˜åŒ–ï¼Œå¯¼è‡´äº†å…ƒç´ æœ¬èº«å‘ç”Ÿäº†å¤§å°ç­‰èƒ½è§¦å‘å›æµçš„å±æ€§æ—¶ï¼Œé‚£ä¹ˆ `layout` å±æ€§å°†ä¸ç”Ÿæ•ˆã€‚

### Paint

> This value turns on paint containment for the element. This ensures that the descendants of the containment box donâ€™t display outside its bounds, so if an element is off-screen or otherwise not visible, its descendants are also guaranteed to be not visible.

è®¾ç½®äº† `paint` å±æ€§ï¼Œè¡¨ç¤ºè¿™ä¸ªå…ƒç´ çš„å­å­™èŠ‚ç‚¹ä¸ä¼šåœ¨å®ƒè¾¹ç¼˜å¤–æ˜¾ç¤ºã€‚å¦‚æœä¸€ä¸ªå…ƒç´ åœ¨è§†çª—å¤–æˆ–å› å…¶ä»–åŸå› å¯¼è‡´ä¸å¯è§ï¼Œåˆ™åŒæ ·å®ƒçš„å­å­™èŠ‚ç‚¹ä¸ä¼šè¢«æ˜¾ç¤ºã€‚

```javascript
.container li {
    padding: 10px;
    height: 100px;

    contain: paint;
}
```

![51d4f10219664196bc024dc1d77267ea_tplv-k3u1fbpfcp-watermark.gif](./imgs/51d4f10219664196bc024dc1d77267ea_tplv-k3u1fbpfcp-watermark.gif)

å¯¹äºå­å…ƒç´ ï¼Œéƒ¨åˆ†å†…å®¹è¶…å‡ºè¾¹ç•Œï¼Œé‚£ä¹ˆè¯¥éƒ¨åˆ†å†…å®¹ä¹Ÿä¸ä¼šè¢«æ¸²æŸ“ã€‚

ä»æ•ˆæœä¸Šæ¥çœ‹ï¼Œè¿™æœ‰ç‚¹ç±»ä¼¼äº `overflowï¼šhidden`ï¼Œä¸åŒçš„æ˜¯ `overflowï¼šhidden`ï¼Œæ˜¯é€šè¿‡å°†è¶…å‡ºéƒ¨åˆ†è¿›è¡Œè£å‰ªçš„æ–¹å¼ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œå¯¹äºæœ‰æ»šåŠ¨æ¡çš„å…ƒç´ ï¼Œç”±äºæ»šåŠ¨ï¼Œä¼šè§¦å‘å¤šæ¬¡æ¸²æŸ“ï¼Œè¿™äº›æ¸²æŸ“çš„å…ƒç´ ï¼ŒåŒ…å«å½“å‰å¯è§†åŒºå¤–çš„å…ƒç´ ï¼Œé€ æˆäº†æ€§èƒ½æµªè´¹ã€‚è€Œä½¿ç”¨ `paint` å°±å¯ä»¥å¿½ç•¥è¿™äº›å¯è§†åŒºå¤–å…ƒç´ çš„æ¸²æŸ“ï¼Œä»è€Œè¾¾åˆ°ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½ã€‚

### Size

> The value turns on size containment for the element. This ensures that the containment box can be laid out without needing to examine its descendants.

è®¾ç½®äº† `size` å±æ€§çš„å…ƒç´ ï¼Œè¡¨ç¤ºè¿™ä¸ªå…ƒç´ çš„å°ºå¯¸è®¡ç®—ä¸ä¾èµ–äºå®ƒçš„å­å­™å…ƒç´ çš„å°ºå¯¸ã€‚

å¯¹äºæµè§ˆå™¨æ¥è¯´ï¼Œè®¾ç½® `size` å°±æ˜¯å‘Šè¯‰æµè§ˆå™¨ï¼Œè¿™ä¸ªå…ƒç´ çš„å¤§å°å·²ç»å›ºå®šäº†ï¼Œå°±æ˜¯è¿™ä¹ˆå¤§ï¼Œä¸éœ€è¦å†é€šè¿‡é‡æ’å­å…ƒç´ æ¥è·å–å½“å‰å…ƒç´ çš„å¤§å°ã€‚

è®¾ç½®äº† size å±æ€§çš„å…ƒç´ ï¼Œä¸ç®¡å­å…ƒç´ æ˜¯æ€ä¹ˆå¸ƒå±€ï¼Œä»€ä¹ˆæ ·å¼ï¼Œéƒ½ä¸ä¼šå½±å“åˆ°çˆ¶å…ƒç´ ã€‚

```javascript
.container li {
    padding: 10px;
    height: 100px;

    contain: size;
}
```

![0924d1088eb14169aad0ff98385f8d61_tplv-k3u1fbpfcp-watermark.gif](./imgs/0924d1088eb14169aad0ff98385f8d61_tplv-k3u1fbpfcp-watermark.gif)

ä½¿ç”¨è¿™ä¸ª size å±æ€§ï¼Œä¼šæ”¹å˜æ¸²æŸ“çš„æ ¹ç»“ç‚¹ï¼Œä»è€Œè¾¾åˆ°ä¼˜åŒ–çš„ç›®çš„

ä½¿ç”¨å‰ï¼š

![72a3802ea8974ff38015b8ebddca20e2_tplv-k3u1fbpfcp-watermark.png](./imgs/72a3802ea8974ff38015b8ebddca20e2_tplv-k3u1fbpfcp-watermark.png)

ä½¿ç”¨åï¼š

![80e954e5633a48819801688899a3557a_tplv-k3u1fbpfcp-watermark.png](./imgs/80e954e5633a48819801688899a3557a_tplv-k3u1fbpfcp-watermark.png)

å¯ä»¥çœ‹åˆ°ï¼Œ_layout root_ æ˜¯å®Œå…¨ä¸åŒçš„ï¼Œå‰è€…åŸºäº _document_ æ•´ä¸ªé¡µé¢ï¼Œè€Œåè€…æ˜¯åŸºäºå½“å‰çš„ _contain_ å®¹å™¨å…ƒç´ ã€‚

åœ¨æ—¥å¸¸ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ä¸€äº›å®¹å™¨å…ƒç´ ä½¿ç”¨ï¼Œé¿å…å› ä¸ºå®¹å™¨å†…éƒ¨çš„å¸ƒå±€æ”¹å˜ï¼Œè€Œå¯¼è‡´æ•´ä¸ªé¡µé¢çš„å›æµã€‚

### content && strict

> containï¼šcontentï¼› // è¡¨ç¤ºè¿™ä¸ªå…ƒç´ ä¸Šæœ‰é™¤äº† size å’Œ style å¤–çš„æ‰€æœ‰åŒ…å«è§„åˆ™ã€‚ç­‰ä»·äº contain: layout paintã€‚

> containï¼šstrictï¼› // è¡¨ç¤ºé™¤äº† style å¤–çš„æ‰€æœ‰çš„åŒ…å«è§„åˆ™åº”ç”¨äºè¿™ä¸ªå…ƒç´ ã€‚ç­‰ä»·äº contain: size layout paintã€‚

## å¸ƒå±€

ä¸çŸ¥é“å¤§å®¶æ˜¯å¦æ³¨æ„åˆ°ï¼Œè®¾ç½®äº†`contain`çš„å…ƒç´ ï¼Œåªæœ‰åœ¨æ˜ç¡®äº†`width`, `height`çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šäº§ç”Ÿæ•ˆæœï¼Œå¦åˆ™å°±è·Ÿæ­£å¸¸å…ƒç´ ä¸€æ ·ã€‚

çœŸçš„æ²¡æœ‰å…¶ä»–ä»»ä½•å˜åŒ–ä¹ˆï¼Ÿå…¶å®ä¸æ˜¯çš„ã€‚

åªè¦è®¾ç½®äº†`contain`çš„å…ƒç´ ï¼Œå°±ç±»ä¼¼äºä½¿ç”¨ `positionï¼šrelative` å¸ƒå±€ï¼Œä¸åŒçš„æ˜¯ï¼Œ`z-index`ï¼Œä»¥åŠ`top`ã€`left`ç­‰æ”¹å˜ä½ç½®çš„å±æ€§å¯¹å…¶è‡ªèº«æ˜¯æ— æ•ˆã€‚

å¯¹äºè®¾ç½®`contain: layout`ï¼Œé€šè¿‡è§‚å¯Ÿå¯ä»¥çœ‹åˆ°ï¼Œè§‚æ„Ÿä¸Šå®ƒä¸ `positionï¼šrelative` å¹¶æ— åŒºåˆ«ï¼Œéƒ½æ˜¯åœ¨æ­£å¸¸æ–‡æ¡£æµä¸­å æ®ä½ç½®ï¼Œä¸”å­å…ƒç´ æµ®äºæ­£å¸¸æ–‡æ¡£æµä¹‹ä¸Šã€‚

![cfcbe61cf942471aa2efc4d5ef456caf_tplv-k3u1fbpfcp-watermark.png](./imgs/cfcbe61cf942471aa2efc4d5ef456caf_tplv-k3u1fbpfcp-watermark.png)

ä½†æ˜¯ï¼Œå¯¹äºè®¾ç½®`contain: size`çš„å…ƒç´ ï¼Œé€šè¿‡è§‚å¯Ÿå¯ä»¥çœ‹åˆ°ï¼Œå®ƒä¹Ÿæ˜¯åœ¨æ­£å¸¸æ–‡æ¡£æµä¸­å æ®ä½ç½®ï¼Œä¸åŒçš„æ˜¯ï¼Œå­å…ƒç´ æµ®äºæ­£å¸¸æ–‡æ¡£æµä¹‹ä¸‹ï¼Œè¿™å°±å¯ä»¥è¯´æ˜ï¼Œåªè¦è®¾ç½®äº†`contain: size`ï¼Œå®ƒçš„å±‚çº§æ˜¯ä½äºæ­£å¸¸æ–‡æ¡£æµçš„ã€‚

![0c67a7b87772410ab632ca14e3ff0dd7_tplv-k3u1fbpfcp-watermark.png](./imgs/0c67a7b87772410ab632ca14e3ff0dd7_tplv-k3u1fbpfcp-watermark.png)

## example

ä¸ºäº†æ›´ç›´è§‚çš„çœ‹å‡º contain çš„æ•ˆæœï¼Œå…ˆé™„ä¸Š [Manuel Rego Casasnovas](https://blogs.igalia.com/mrego/files/2019/01/css-contain-example.html) å†™çš„ä¾‹å­ã€‚

```javascript
window.performance.now(); // è¿”å›ä¸€ä¸ªè¡¨ç¤ºä»æ€§èƒ½æµ‹é‡æ—¶åˆ»å¼€å§‹ç»è¿‡çš„æ¯«ç§’æ•°
```

é€šè¿‡`[window.performance.now()](https://developer.mozilla.org/zh-CN/docs/Web/API/Performance/now)`è®°å½•å›æµçš„å¼€å§‹æ—¶é—´ï¼Œåœ¨å›æµç»“æŸåå†é€šè¿‡`[window.performance.now()](https://developer.mozilla.org/zh-CN/docs/Web/API/Performance/now)`è®°å½•ä¸€æ¬¡ç»“æŸæ—¶é—´ï¼Œç”¨å¾—åˆ°çš„å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´ç›¸å‡ï¼Œå°±å¾—åˆ°äº†ä¸€æ¬¡å®Œæ•´å›æµæ‰€ç»å†çš„æ—¶é—´ã€‚

```javascript
function runTests() {
  setup(); // åˆ›å»º 1000 ä¸ªèŠ‚ç‚¹

  let avg1 = changeTargetContent(); // æ²¡æœ‰è®¾ç½®containï¼Œè§¦å‘å›æµ

  let targetItem = document.getElementById('targetItem');
  targetItem.style.contain = 'strict';
  let avg2 = changeTargetContent(); // è§¦å‘å›æµ
}

function changeTargetContent() {
  // Force layout.
  document.body.offsetLeft;

  let start = window.performance.now();

  let targetInner = document.getElementById('targetInner');
  targetInner.textContent = targetInner.textContent == 'Hello World!' ? 'BYE' : 'Hello World!';

  // Force layout.
  document.body.offsetLeft;

  let end = window.performance.now();
  let time = end - start;
  return time;
}
```

![06f9f39a3c57410f91a45facd5d1fd11_tplv-k3u1fbpfcp-watermark.png](./imgs/06f9f39a3c57410f91a45facd5d1fd11_tplv-k3u1fbpfcp-watermark.png)

é€šè¿‡å¯¹æ¯”`cantain: strict`è®¾ç½®å‰å’Œè®¾ç½®åï¼Œå¯ä»¥çœ‹åˆ°æ€§èƒ½çš„ä¼˜åŒ–è¾¾åˆ°äº† 80%å·¦å³ã€‚

åœ¨å®é™…é¡¹ç›®é‡Œä¸‹ï¼Œä½¿ç”¨`cantain: strict`å±æ€§åçš„æ•ˆæœã€‚
æˆªå›¾åœºæ™¯ï¼Œç‚¹å‡»äº† 2 æ¬¡æŒ‰é’®ï¼Œå®Œæ•´è§¦å‘äº†ä¸€ä¸ªæ¨¡å—çš„æ‰“å¼€å…³é—­ï¼Œå‰è€…ä¸ºä½¿ç”¨å‰ï¼Œåè€…ä¸ºä½¿ç”¨åçš„çš„å®é™…æ¸²æŸ“æ•ˆæœã€‚

ä½¿ç”¨å‰ï¼š
![b8573215f2e94537b35d76070c2551fd_tplv-k3u1fbpfcp-watermark.png](./imgs/b8573215f2e94537b35d76070c2551fd_tplv-k3u1fbpfcp-watermark.png)

ä½¿ç”¨åï¼š
![22847cd41ac042a5ae8f8a562543d8a2_tplv-k3u1fbpfcp-watermark.png](./imgs/22847cd41ac042a5ae8f8a562543d8a2_tplv-k3u1fbpfcp-watermark.png)

é€šè¿‡æ¯”è¾ƒï¼Œå¯ä»¥çœ‹å‡ºä½¿ç”¨ `cantain: strict` åï¼Œrendering æ—¶é•¿ä» 1750ms é™è‡³ 558msï¼Œä¼˜åŒ–äº† 60%å·¦å³ã€‚è€Œ painting æ—¶é•¿ä» 230ms é™è‡³ 35msï¼Œä¼˜åŒ–äº† 75%çš„å·¦å³ã€‚

rendering å’Œ Painting çš„å ç”¨æ—¶é—´ï¼Œéƒ½æœ‰éå¸¸æ˜æ˜¾çš„å‡å°‘ã€‚ä½¿ç”¨åå¯¹æ¸²æŸ“æ€§èƒ½çš„ä¼˜åŒ–è¿˜æ˜¯éå¸¸æ˜æ˜¾çš„ã€‚

## å…¼å®¹æ€§

![79f1995d73f94a0d8a727b2ec70160f9_tplv-k3u1fbpfcp-watermark.png](./imgs/79f1995d73f94a0d8a727b2ec70160f9_tplv-k3u1fbpfcp-watermark.png)

# å†™åœ¨æœ€å

åœ¨æœ¬æ¬¡çš„å­¦ä¹ ä¸­ï¼Œå…¶å®è¿˜æœ‰ä¸€äº›å€¼å¾—æ¢ç©¶æˆ–è€…æ¯”è¾ƒé—æ†¾çš„åœ°æ–¹ï¼š

- `contain`åœ¨ä¼˜åŒ–é¡µé¢æ¸²æŸ“æ€§èƒ½çš„æƒ…å†µä¸‹ï¼Œæ˜¯å¦ç»™æµè§ˆå™¨å¸¦æ¥äº†å…¶ä»–è´Ÿæ‹…ï¼Ÿä¸ªäººçŒœæµ‹æ˜¯é€šè¿‡ç©ºé—´æ¢æ—¶é—´çš„æ–¹å¼ã€‚
- è®¾è®¡çš„ demo çš„å®é™…æ•ˆæœè·Ÿç†æƒ³ä¸­çš„æ•ˆæœï¼Œå¹¶ä¸ä¸€è‡´ï¼Œä¸å…æœ‰äº›é—æ†¾ã€‚å¦‚å¯¹äº `containï¼špaint` æ¥è¯´ï¼Œåœ¨å±å¹•å¤–æ·»åŠ å­èŠ‚ç‚¹ï¼Œè§¦å‘å›æµé‡ç»˜ï¼Œæ ¹æ®`containï¼špaint`å±æ€§åœ¨å±å¹•å¤–ï¼Œä¸ç»˜åˆ¶å…ƒç´ çš„ç‰¹æ€§ï¼Œé‡ç»˜çš„æ—¶é—´åº”è¯¥æ˜¯éå¸¸å°ï¼Œæˆ–è€…å°†è¿‘ 0ms çš„ï¼Œç„¶è€Œåœ¨å®é™…ä¸­å¹¶æ²¡æœ‰è¾¾åˆ°è¿™ä¸ªæ•ˆæœã€‚

å¦‚æœæ–‡ç« ä¸­å‡ºç°é”™è¯¯ï¼Œæˆ–è€…æœ‰æ›´å¥½çš„éªŒè¯ demoï¼Œæ¬¢è¿ç•™è¨€äº¤æµå“ˆ ğŸ˜Šã€‚

# å‚è€ƒæ–‡çŒ®

- [CSS Containment](https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Containment)
- [CSS Containment in Chrome 52](https://developers.google.com/web/updates/2016/06/css-containment)
- [CSS-Tricks](https://css-tricks.com/almanac/properties/c/contain/)
- [caniuse](https://caniuse.com/?search=contain)
- [An introduction to CSS Containment](https://blogs.igalia.com/mrego/2019/01/11/an-introduction-to-css-containment/)
- [CSS Containment Module Level 1](https://www.w3.org/TR/css-contain-1/)
- [CSS Containment Module Level 2](https://www.w3.org/TR/css-contain-2/)
