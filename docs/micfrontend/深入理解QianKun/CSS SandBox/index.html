<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-micfrontend/æ·±å…¥ç†è§£QianKun/CSS SandBox/CSS SandBox" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">CSS SandBox | Zaoei Blog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" property="og:url" content="https://blog.palashsh.me/docs/micfrontend/æ·±å…¥ç†è§£QianKun/CSS SandBox/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:image" content="https://avatars.githubusercontent.com/u/35087196?v=4"><meta data-rh="true" name="twitter:card" content="https://avatars.githubusercontent.com/u/35087196?v=4"><meta data-rh="true" name="twitter:image" content="https://avatars.githubusercontent.com/u/35087196?v=4"><meta data-rh="true" name="twitter:site" content="@battleofplassey"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="CSS SandBox | Zaoei Blog"><meta data-rh="true" name="description" content="æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»çš„æ˜¯å…³äºCSS Sandboxçš„ä¸€äº›äº‹æƒ…ï¼Œä¸ºä»€ä¹ˆè¦ä»‹ç»è¿™ä¸ªå‘¢ï¼Ÿåœ¨æˆ‘ä»¬æ—¥å¸¸çš„å¼€å‘ä¸­ï¼Œæ ·å¼é—®é¢˜å…¶å®ä¸€ç›´æ˜¯ä¸€ä¸ªæ¯”è¾ƒè€—æ—¶çš„äº‹æƒ…ï¼Œä¸€æ–¹é¢æˆ‘ä»¬æ ¹æ®UIç¨¿ä¸æ–­çš„å»è°ƒæ•´ï¼Œå¦ä¸€æ–¹é¢éšç€é¡¹ç›®è¶Šæ¥è¶Šå¤§å¯èƒ½å“ªä¸€æ¬¡å¼€å‘å°±å‘ç°â€”â€”è¯¶ï¼Œæˆ‘çš„æ ·å¼æ€ä¹ˆä¸èµ·ä½œç”¨äº†ï¼Œäº¦æˆ–æ˜¯æ€ä¹ˆè¢«å¦ä¸€ä¸ªæ ·å¼æ‰€è¦†ç›–äº†ã€‚åŸå› å¯èƒ½æœ‰å¾ˆå¤šï¼š"><meta data-rh="true" property="og:description" content="æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»çš„æ˜¯å…³äºCSS Sandboxçš„ä¸€äº›äº‹æƒ…ï¼Œä¸ºä»€ä¹ˆè¦ä»‹ç»è¿™ä¸ªå‘¢ï¼Ÿåœ¨æˆ‘ä»¬æ—¥å¸¸çš„å¼€å‘ä¸­ï¼Œæ ·å¼é—®é¢˜å…¶å®ä¸€ç›´æ˜¯ä¸€ä¸ªæ¯”è¾ƒè€—æ—¶çš„äº‹æƒ…ï¼Œä¸€æ–¹é¢æˆ‘ä»¬æ ¹æ®UIç¨¿ä¸æ–­çš„å»è°ƒæ•´ï¼Œå¦ä¸€æ–¹é¢éšç€é¡¹ç›®è¶Šæ¥è¶Šå¤§å¯èƒ½å“ªä¸€æ¬¡å¼€å‘å°±å‘ç°â€”â€”è¯¶ï¼Œæˆ‘çš„æ ·å¼æ€ä¹ˆä¸èµ·ä½œç”¨äº†ï¼Œäº¦æˆ–æ˜¯æ€ä¹ˆè¢«å¦ä¸€ä¸ªæ ·å¼æ‰€è¦†ç›–äº†ã€‚åŸå› å¯èƒ½æœ‰å¾ˆå¤šï¼š"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://blog.palashsh.me/docs/micfrontend/æ·±å…¥ç†è§£QianKun/CSS SandBox/"><link data-rh="true" rel="alternate" href="https://blog.palashsh.me/docs/micfrontend/æ·±å…¥ç†è§£QianKun/CSS SandBox/" hreflang="en"><link data-rh="true" rel="alternate" href="https://blog.palashsh.me/docs/micfrontend/æ·±å…¥ç†è§£QianKun/CSS SandBox/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://2KDKKFPT4A-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Zaoei Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Zaoei Blog Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="Zaoei Blog JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R5V7R63B0J"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-R5V7R63B0J",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Zaoei Blog" href="/opensearch.xml">
<link rel="icon" href="/img/docusaurus.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(37, 194, 160)"><link rel="stylesheet" href="/assets/css/styles.09761036.css">
<script src="/assets/js/runtime~main.d0e4631e.js" defer="defer"></script>
<script src="/assets/js/main.46e122de.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Zaoei Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="Zaoei Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" link="blog" href="/">Blog</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" link="doc" doclink="docs/webpack-resolve/README.md" href="/docs/webpack-resolve/">docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Zaoei" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" externallink="https://github.com/Zaoei" link="external" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.png" alt="Zaoei Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="Zaoei Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"><b></b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/algorithm">algorithm</a><button aria-label="Expand sidebar category &#x27;algorithm&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/micfrontend">micfrontend</a><button aria-label="Collapse sidebar category &#x27;micfrontend&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/micfrontend/">README</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/micfrontend/design/">design</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/micfrontend/practice/">qiankun å®è·µ</a><button aria-label="Expand sidebar category &#x27;qiankun å®è·µ&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/micfrontend/æ·±å…¥ç†è§£QianKun/CSS SandBox/">æ·±å…¥ç†è§£QianKun</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/micfrontend/æ·±å…¥ç†è§£QianKun/CSS SandBox/">CSS SandBox</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/micfrontend/æ·±å…¥ç†è§£QianKun/JS SandBox/">JS SandBox</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/micfrontend/æ·±å…¥ç†è§£QianKun/Loadã€Prefetch and Communication/">åŠ è½½æµç¨‹ã€é¢„åŠ è½½ä»¥åŠé€šä¿¡</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/micfrontend/æ·±å…¥ç†è§£QianKun/Review &amp;&amp; Summary/">å›é¡¾å’Œæ€»ç»“</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/micfrontend/æ·±å…¥ç†è§£QianKun/Route/">single-spaä¸­çš„è·¯ç”±å®ç°</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/operating-system">operating system</a><button aria-label="Expand sidebar category &#x27;operating system&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/single sign on/CAS">single sign on</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/webpack-optimize">webpack-optimize</a><button aria-label="Expand sidebar category &#x27;webpack-optimize&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/webpack-resolve">webpack-resolve</a><button aria-label="Expand sidebar category &#x27;webpack-resolve&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/whoami">whoami</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/micfrontend"><span itemprop="name">micfrontend</span></a><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">æ·±å…¥ç†è§£QianKun</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">CSS SandBox</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1 id="css-sandbox">CSS SandBox</h1>
<h1 id="å¼•è¨€">å¼•è¨€</h1>
<p>æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»çš„æ˜¯å…³äº<code>CSS Sandbox</code>çš„ä¸€äº›äº‹æƒ…ï¼Œä¸ºä»€ä¹ˆè¦ä»‹ç»è¿™ä¸ªå‘¢ï¼Ÿåœ¨æˆ‘ä»¬æ—¥å¸¸çš„å¼€å‘ä¸­ï¼Œæ ·å¼é—®é¢˜å…¶å®ä¸€ç›´æ˜¯ä¸€ä¸ªæ¯”è¾ƒè€—æ—¶çš„äº‹æƒ…ï¼Œä¸€æ–¹é¢æˆ‘ä»¬æ ¹æ®UIç¨¿ä¸æ–­çš„å»è°ƒæ•´ï¼Œå¦ä¸€æ–¹é¢éšç€é¡¹ç›®è¶Šæ¥è¶Šå¤§å¯èƒ½å“ªä¸€æ¬¡å¼€å‘å°±å‘ç°â€”â€”è¯¶ï¼Œæˆ‘çš„æ ·å¼æ€ä¹ˆä¸èµ·ä½œç”¨äº†ï¼Œäº¦æˆ–æ˜¯æ€ä¹ˆè¢«å¦ä¸€ä¸ªæ ·å¼æ‰€è¦†ç›–äº†ã€‚åŸå› å¯èƒ½æœ‰å¾ˆå¤šï¼š</p>
<ul>
<li>ä¸è§„èŒƒçš„å‘½åå¯¼è‡´é‡å¤</li>
<li>ä¸ºäº†ç®€å•ï¼Œç›´æ¥æ·»åŠ å…¨å±€æ ·å¼çš„ä¿®æ”¹</li>
<li>æ ·å¼çš„ä¸åˆç†å¤ç”¨</li>
<li>å¤šä¸ªé¡¹ç›®åˆå¹¶æ—¶ï¼Œæ¯ä¸ªå­é¡¹ç›®éƒ½æœ‰è‡ªå·±çš„ç‹¬ç«‹æ ·å¼å’Œé…ç½®ï¼Œå¯èƒ½åœ¨è‡ªå·±é¡¹ç›®ä¸­ä¸å­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼Œä½†æ˜¯åˆå¹¶ä»¥åäº’ç›¸å½±å“é€ æˆäº†æ ·å¼æ±¡æŸ“</li>
<li>ç¬¬ä¸‰æ–¹æ¡†æ¶å¼•å…¥</li>
<li>â€¦â€¦</li>
</ul>
<p>è€Œ<code>CSS Sandbox</code>æ­£å¼ä¸ºäº†éš”ç¦»æ ·å¼ï¼Œä»è€Œè§£å†³æ ·å¼æ±¡æŸ“çš„é—®é¢˜</p>
<h1 id="åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</h1>
<p>é€šè¿‡ä¸Šè¿°æˆ‘ä»¬äº†è§£äº†æ ·å¼æ±¡æŸ“äº§ç”Ÿçš„åŸå› ï¼Œä»ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥æ€»ç»“ä¸€ä¸‹å“ªäº›åœºæ™¯æ—¶æˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>CSS Sandbox</code>è¿›è¡Œæ ·å¼éš”ç¦»å‘¢</p>
<ul>
<li>å¾®å‰ç«¯åœºæ™¯ä¸‹çš„çˆ¶å­ä»¥åŠå­å­åº”ç”¨</li>
<li>å¤§å‹é¡¹ç›®ä»¥åŠå¤æ‚é¡¹ç›®çš„æ ·å¼å†²çª</li>
<li>ç¬¬ä¸‰æ–¹æ¡†æ¶ä»¥åŠè‡ªå®šä¹‰ä¸»é¢˜æ ·å¼çš„è¦†ç›–</li>
<li>â€¦â€¦</li>
</ul>
<h1 id="å¸¸è§çš„è§£å†³æ–¹æ¡ˆ">å¸¸è§çš„è§£å†³æ–¹æ¡ˆ</h1>
<p>æ—¢ç„¶è¯´äº†è¿™ä¹ˆå¤šæ ·å¼æ±¡æŸ“äº§ç”Ÿçš„åŸå› å’Œåº”ç”¨åœºæ™¯ï¼Œé‚£æˆ‘ä»¬è¯¥å¦‚  ä½•è§£å†³ä»–ä»¬å‘¢ï¼Œç›®å‰æœ‰ä»¥ä¸‹å‡ ç§è§£å†³æ–¹æ¡ˆï¼Œå…¶å®è§£å†³çš„æ ¸å¿ƒè¿˜æ˜¯ä¸å˜çš„â€”â€”<code>ä½¿CSSé€‰æ‹©å™¨ä½œç”¨çš„Domå…ƒç´ å”¯ä¸€</code></p>
<p><img alt="Untitled" src="/assets/images/å®ç°æ ·å¼æ²™ç®±çš„æ–¹å¼-8b9702907f0e7752cceeaedf93634766.png" width="1734" height="998"></p>
<p>Tipsï¼šå½“æˆ‘ä»¬åœ¨å®é™…çš„å¼€å‘ä¸­å¯ä»¥æ ¹æ®é¡¹ç›®çš„å®é™…æƒ…å†µè¿›è¡Œé€‰æ‹©</p>
<h2 id="css-in-js">CSS in JS</h2>
<p>çœ‹åå­—æ˜¯ä¸æ˜¯æ„Ÿè§‰å¾ˆé«˜çº§ï¼Œç›´è¯‘ä¸‹å°±æ˜¯ç”¨JSå»å†™CSSæ ·å¼ï¼Œè€Œä¸æ˜¯å†™åœ¨å•ç‹¬çš„æ ·å¼æ–‡ä»¶é‡Œã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-tsx">&lt;p style=&#x27;color:red&#x27;&gt;css in js&lt;/p&gt;
</code></pre>
<p>è¿™å’Œæˆ‘ä»¬ä¼ ç»Ÿçš„å¼€å‘æ€æƒ³å¾ˆä¸ä¸€æ ·ï¼Œä¼ ç»Ÿçš„å¼€å‘åŸåˆ™æ˜¯<code>å…³æ³¨ç‚¹åˆ†ç¦»</code>ï¼Œå°±æ¯”å¦‚æˆ‘ä»¬å¸¸è¯´çš„ä¸å†™<code>è¡Œå†…æ ·å¼</code>ã€<code>è¡Œå†…è„šæœ¬</code>ï¼Œå³HTMLã€JSã€CSSéƒ½å†™åœ¨å¯¹åº”çš„æ–‡ä»¶é‡Œã€‚</p>
<p>å…³äºCSS in JSä¸æ˜¯ä¸€ä¸ªæ–°å…´çš„æŠ€æœ¯ï¼Œä»–çš„çƒ­åº¦ä¸»è¦å‡ºç°äºä¸€äº›Webæ¡†æ¶çš„å‘å±•ï¼Œæ¯”å¦‚è¯´ï¼šReactï¼Œå®ƒæ‰€æ”¯æŒçš„jsxè¯­æ³•ï¼Œå¯ä»¥è®©æˆ‘ä»¬åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­åŒæ—¶å†™jsã€htmlå’Œcssï¼Œå¹¶ä¸”<code>ç»„ä»¶</code>å†…éƒ¨ç®¡ç†è‡ªå·±çš„æ ·å¼ã€é€»è¾‘ï¼Œç»„ä»¶åŒ–å¼€å‘çš„æ€æƒ³æ·±å…¥äººå¿ƒã€‚</p>
<pre><code class="language-tsx">const style = {
	color: &#x27;red&#x27;
}

ReactDOM.render(
  &lt;p style={style}&gt;
     css in js
  &lt;/h1&gt;,
  document.getElementById(&#x27;main&#x27;)
);
</code></pre>
<p>æ¯ä¸ªç»„ä»¶çš„æ ·å¼ç”±è‡ªèº«çš„styleå†³å®šï¼Œä¸ä¾èµ–ä¹Ÿä¸å½±å“å¤–éƒ¨ï¼Œä»è¿™ä¸€ç‚¹æ¥çœ‹ç¡®å®å®ç°äº†æ ·å¼éš”ç¦»çš„æ•ˆæœã€‚</p>
<p>å…³äº<code>Css in js</code>çš„åº“ä¹Ÿæœ‰å¾ˆå¤šï¼Œæ¯”å¦‚è¯´ï¼š</p>
<ul>
<li><a href="https://styled-components.com/docs">styled-components</a></li>
<li><a href="https://polished.js.org/">polished</a></li>
<li>Â·Â·Â·Â·Â·Â·</li>
</ul>
<p>å…¶ä¸­styled-componentsä¼šåŠ¨æ€ç”Ÿæˆä¸€ä¸ªé€‰æ‹©å™¨</p>
<pre><code class="language-tsx">import styled from &#x27;styled-components&#x27;

function App() {
  const Title = styled.h1`
    font-size: 1.5em;
    text-align: center;
    color: palevioletred;
  `;

  return (
    &lt;div&gt;
      &lt;Title&gt;Hello World, this is my first styled component!&lt;/Title&gt;
    &lt;/div&gt;
  );
}
</code></pre>
<p><img alt="Untitled" src="/assets/images/styled-components-d2ba10d0c4cfdab7e50e3d24aab0e4d1.png" width="3004" height="1486"></p>
<h3 id="ä¼˜ç¼ºç‚¹">ä¼˜ç¼ºç‚¹</h3>
<p>| ä¼˜ç‚¹ | â€¢ æ²¡æœ‰ä½œç”¨åŸŸçš„æ ·å¼æ±¡æŸ“é—®é¢˜ï¼ˆä¸»è¦æŒ‡çš„æ˜¯é€šè¿‡å†™å†…è¡Œæ ·å¼ä»¥åŠç”Ÿæˆå”¯ä¸€çš„cssé€‰æ‹©å™¨ï¼‰
â€¢ å‡å°‘äº†æ— ç”¨æ ·å¼çš„å †ç§¯ï¼Œåˆ é™¤ç»„ä»¶å³åˆ é™¤å¯¹åº”çš„æ ·å¼
â€¢ é€šè¿‡å¯¼å‡ºå®šä¹‰çš„æ ·å¼å˜é‡æ–¹ä¾¿è¿›è¡Œå¤ç”¨å’Œé‡æ„ |
| --- | --- |
| ç¼ºç‚¹ | â€¢ å†…è”æ ·å¼ä¸æ”¯æŒä¼ªç±»å’Œé€‰æ‹©å™¨ç­‰å†™æ³•
â€¢ ä»£ç çš„å¯è¯»æ€§æ¯”è¾ƒå·®ï¼Œè¿èƒŒäº†å…³æ³¨ç‚¹åˆ†ç¦»çš„åŸåˆ™
â€¢ è¿è¡Œæ—¶ä¼šæ¶ˆè€—æ€§èƒ½ï¼ŒåŠ¨æ€ç”Ÿæˆcssï¼ˆæˆ‘ä»¬åœ¨å†™cssæ—¶å…¶å®è¿˜æ˜¯jsï¼‰
â€¢ ä¸èƒ½ç»“åˆä¸€äº›CSSé¢„å¤„ç†å™¨ï¼Œæ— æ³•è¿›è¡Œé¢„ç¼–è¯‘ |</p>
<h2 id="æ ·å¼çº¦å®š">æ ·å¼çº¦å®š</h2>
<p>é€šè¿‡çº¦åº”ç”¨çš„å‘½åå‰ç¼€å®ç°ç»Ÿä¸€çš„å¼€å‘å’Œç»´æŠ¤ï¼Œæ¯”å¦‚è¯´BEMçš„å‘½åæ–¹å¼ï¼Œé€šè¿‡å¯¹å—ã€å…ƒç´ ä»¥åŠä¿®é¥°ç¬¦ä¸‰è€…çš„å‘½åæ¥è§„èŒƒçš„æè¿°ä¸€ä¸ªç»„ä»¶</p>
<pre><code class="language-tsx">.dropdown-menu__item-button--disabled
</code></pre>
<h3 id="ä¼˜ç¼ºç‚¹-1">ä¼˜ç¼ºç‚¹</h3>
<p>| ä¼˜ç‚¹ | â€¢ æ ·å¼éš”ç¦»
â€¢ è¯­ä¹‰åŒ–å¼ºï¼Œç»„ä»¶å¯è¯»æ€§é«˜ |
| --- | --- |
| ç¼ºç‚¹ | â€¢ å‘½åå¤ªé•¿
â€¢ ä¾èµ–äºå¼€å‘è€…çš„å‘½å |</p>
<h2 id="é¢„å¤„ç†å™¨">é¢„å¤„ç†å™¨</h2>
<p>é€šè¿‡cssé¢„å¤„ç†å™¨å¯ä»¥å¤„ç†å¾ˆå¤šç‹¬ç‰¹çš„è¯­æ³•æ ¼å¼ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>å¯åµŒå¥—æ€§</li>
</ul>
<pre><code class="language-sass">body {
	with: 20px;
	p {
		color: red;
	}
}
</code></pre>
<ul>
<li>çˆ¶é€‰æ‹©å™¨</li>
</ul>
<pre><code class="language-sass">body {
	with: 20px;
	&amp;:hover {
		with: 30px;
	}
}
</code></pre>
<ul>
<li>å±æ€§ç»§æ‰¿</li>
</ul>
<pre><code class="language-less">.dev {
	width: 200px;
}

span {
	.dev
}
</code></pre>
<ul>
<li>......</li>
</ul>
<p>é€šè¿‡è¿™äº›ç‰¹æ®Šçš„è¯­æ³•è®©cssæ›´å®¹æ˜“è§£è¯»å’Œç»´æŠ¤</p>
<p>ä¸€äº›å¸¸è§çš„å¸‚åœºä¸Šçš„é¢„å¤„ç†å™¨</p>
<ul>
<li>Sass</li>
<li>Less</li>
<li>Stylus</li>
<li>PostCss</li>
<li>......</li>
</ul>
<h3 id="ä¼˜ç¼ºç‚¹-2">ä¼˜ç¼ºç‚¹</h3>
<p>| ä¼˜ç‚¹ | â€¢ å¯è¯»æ€§è¾ƒå¥½ï¼Œæ–¹ä¾¿ç†è§£å’Œç»´æŠ¤domç»“æ„
â€¢ åˆ©ç”¨åµŒå¥—ç­‰æ–¹å¼ï¼Œä¹Ÿå¯ä»¥å¤§å¹…åº¦è§£å†³æ ·å¼æ±¡æŸ“çš„é—®é¢˜ |
| --- | --- |
| ç¼ºç‚¹ | â€¢éœ€è¦å¢åŠ é¢å¤–çš„åŒ…ï¼Œå€ŸåŠ©ç›¸å…³ç¼–è¯‘å·¥å…· |</p>
<p>Tipsï¼šé€šå¸¸ä¸ç±»ä¼¼äºBEMçš„å‘½åæ–¹å¼ç»“åˆï¼Œå¯ä»¥è¾¾åˆ°æé«˜å¼€å‘æ•ˆç‡ï¼Œå¢å¼ºå¯è¯»æ€§ä»¥åŠå¤ç”¨çš„æ•ˆæœ</p>
<h2 id="css-module">CSS Module</h2>
<p>é¡¾åæ€ä¹‰å°±æ˜¯å°†cssè¿›è¡Œæ¨¡å—åŒ–å¤„ç†ï¼Œç¼–è¯‘å¥½åå¯ä»¥é¿å…æ ·å¼è¢«æ±¡æŸ“çš„é—®é¢˜ï¼Œä¸è¿‡ä¾èµ–äº<strong>Webpack</strong>éœ€è¦é…ç½®<code>css-loader</code>ç­‰æ‰“åŒ…å·¥å…·ï¼Œä»¥ä¸‹æ˜¯æˆ‘åœ¨<code>create-react-app</code>åˆ›å»ºçš„é¡¹ç›®ä¸­è¿è¡Œï¼Œç”±äºå…¶å·²ç»åœ¨webpacké…ç½®äº†<code>css-loader</code>ï¼Œå› æ­¤åœ¨æ­¤ç¯‡æ–‡ç« ä¸­ä¸å±•ç¤ºå…·ä½“é…ç½®</p>
<p>index.tsæ–‡ä»¶</p>
<pre><code class="language-tsx">import style from &#x27;./style.module.css&#x27;

function App() {

  return (
    &lt;div&gt;
      &lt;p className={style.text}&gt;Css Module&lt;/p&gt;
    &lt;/div&gt;
  );
}

</code></pre>
<p>style.module.cssæ–‡ä»¶</p>
<pre><code class="language-sass">.text {
  color: red;
}

// ç­‰åŒäº
:local(.text) {
    color: blue;
}

// è¿˜æœ‰ä¸€ç§å…¨å±€æ¨¡å¼ï¼Œæ­¤æ—¶ä¸ä¼šè¿›è¡Œç¼–è¯‘
:global(.text) {
    color: blue;
}
</code></pre>
<p><img alt="Untitled" src="/assets/images/css-module-c1dae3a71ba0b4855fd57f960e9f6ffb.png" width="3014" height="1538"></p>
<p>æ‰“åŒ…å·¥å…·ä¼šåŒæ—¶æŠŠstyle.textä»¥åŠtextç¼–è¯‘æˆç‹¬ä¸€æ— äºŒçš„å€¼</p>
<h3 id="ä¼˜ç¼ºç‚¹-3">ä¼˜ç¼ºç‚¹</h3>
<p>| ä¼˜ç‚¹ | â€¢ å­¦ä¹ æˆæœ¬è¾ƒä½ï¼Œä¸ä¾èµ–äºäººå·¥çº¦æŸ
â€¢ åŸºæœ¬ä¸Šèƒ½100%è§£å†³æ ·å¼æ±¡æŸ“é—®é¢˜
â€¢ æ–¹ä¾¿å®ç°æ¨¡å—çš„å¤ç”¨ |
| --- | --- |
| ç¼ºç‚¹ | â€¢ åªèƒ½åœ¨æ„å»ºæ—¶ä½¿ç”¨ï¼Œä¾èµ–äºcss-loaderç­‰
â€¢ å¯è¯»æ€§å·®ï¼Œåœ¨æ§åˆ¶å°è°ƒè¯•æ—¶å‡ºç°hashå€¼ä¸æ–¹ä¾¿è°ƒè¯• |</p>
<h2 id="shadow-dom">Shadow DOM</h2>
<p>å®ƒå¯ä»¥å°†ä¸€ä¸ªéšè—ã€ç‹¬ç«‹çš„DOMé™„åŠ åˆ°ä¸€ä¸ªå…ƒç´ ä¸Šã€‚å½“æˆ‘ä»¬ç”¨Shadow DOMåŒ…è£¹ä¸€ä¸ªå…ƒ ç´ åï¼Œå…¶å†…æ ·å¼ä¸ä¼šå¯¹å¤–éƒ¨æ ·å¼é€ æˆå½±å“ï¼Œå¤–éƒ¨æ ·å¼ä¹Ÿä¸ä¼šå¯¹å…¶å†…éƒ¨é€ æˆå½±å“</p>
<p><img alt="Untitled" src="/assets/images/shadowDom-a15aec72f79b6076ee3a29feb3dbf46f.png" width="2146" height="1378"></p>
<pre><code class="language-tsx">// åˆ›å»ºä¸€ä¸ªshadow domï¼Œæˆ‘è¿™é‡Œæ˜¯é€šè¿‡refå»æ‹¿é™„ç€çš„èŠ‚ç‚¹ï¼Œä¸€èˆ¬å¯ä»¥ç”¨documentå»æ‹¿
import &#x27;./App.css&#x27;; // å®šä¹‰äº†shadow-textçš„æ ·å¼

function App() {
  const divRef = useRef(null)

  useEffect(() =&gt; {
    if(divRef?.current) {
      const { current } = divRef
      const shadow = current.attachShadow({mode: &#x27;open&#x27;}); // modeç”¨æ¥æ§åˆ¶èƒ½å¦ç”¨jsè·å–shaow domå†…çš„å…ƒç´ 
      shadow.innerHTML = &#x27;&lt;p className=&quot;shadow-text&quot;&gt;Here is some new text&lt;/p&gt;&#x27;;
      console.log(current.shadowRoot)
    }
  }, [])

  return (
    &lt;div&gt;
      &lt;div ref={divRef} className=&#x27;shadow-host&#x27;&gt;&lt;/div&gt;
    &lt;/div&gt;
  );
}

</code></pre>
<p><img alt="Untitled" src="/assets/images/shadowDomä¾‹å­1-2a11532d196f7778e271a3d5a9f0dba0.png" width="2950" height="1356"></p>
<p>å¤–éƒ¨æ ·å¼æ— æ³•å½±å“shadow domå†…éƒ¨çš„æ ·å¼</p>
<p>æˆ‘ä»¬å†æ¥çœ‹ä¸‹shadow domå†…éƒ¨å¾—æ ·å¼ä¼šå½±å“å¤–éƒ¨æ ·å¼å—ï¼Ÿ</p>
<pre><code class="language-tsx">function App() {
  useEffect(() =&gt; {
    if(divRef?.current) {
      const { current } = divRef
      const shadow = current.attachShadow({mode: &#x27;open&#x27;});
      shadow.innerHTML = &#x27;&lt;style&gt;.shadow-h1 { color: red } &lt;/style&gt;&lt;p class=&quot;shadow-h1&quot;&gt;Here is some new text&lt;/p&gt;&#x27;;
      
    }
  }, [])

  return (
    &lt;div&gt;
      &lt;Title&gt;Hello World, this is my first styled component!&lt;/Title&gt;
      &lt;h1 className=&#x27;shadow-h1&#x27;&gt;lalla1&lt;/h1&gt;
      &lt;div ref={divRef} className=&#x27;shadow-host&#x27;&gt;&lt;/div&gt;
    &lt;/div&gt;
  );
}
</code></pre>
<p><img alt="Untitled" src="/assets/images/shadowDomä¾‹å­2-35e5e8ba89bc9859a5c895ec823b6ad4.png" width="2974" height="1442"></p>
<p>ä½†æ˜¯ä¹Ÿæœ‰ä¾‹å¤–ï¼Œé™¤äº†<code>[:focus-within](https://developer.mozilla.org/zh-CN/docs/Web/CSS/:focus-within)</code></p>
<pre><code class="language-tsx">import { useEffect, useRef } from &#x27;react&#x27;
import &#x27;./App.css&#x27;; // .shadow-host:focus-within { background-color: yellow;}

function ShadowExample() {
  const divRef = useRef(null)

  useEffect(() =&gt; {
    if(divRef?.current) {
      const { current } = divRef
      const shadow = current.attachShadow({mode: &#x27;open&#x27;});
      shadow.innerHTML = &#x27;&lt;input class=&quot;shadow-h1&quot;/&gt;&#x27;;
      
    }
  }, [])

  return (
    &lt;div&gt;
      &lt;p&gt;Css Module&lt;/p&gt;
      &lt;div ref={divRef} className=&#x27;shadow-host&#x27;&gt;&lt;/div&gt;
    &lt;/div&gt;
  );
}

export default ShadowExample;
</code></pre>
<p><img alt="Untitled" src="/assets/images/shadowDomä¾‹å­3-7470b63a5594d8dcd8229ee409d58fe9.png" width="2318" height="1384"></p>
<h3 id="é—®é¢˜">é—®é¢˜ï¼š</h3>
<p>æ­£ç”±äº<code>shadow dom</code>å†…çš„æ ·å¼åªä¼šåº”ç”¨äºå†…éƒ¨ï¼Œå¦‚æœæˆ‘ä»¬åœ¨shadow domå†…éƒ¨ç”¨äº†ç±»ä¼¼äº<code>antd</code>çš„<code>Modal</code>è¿™äº›åˆ›å»ºäº<code>document.body</code>ä¸‹çš„å¼¹çª—æˆ–è€…å…¶ä»–ç»„ä»¶æ—¶ï¼Œæ— æ³•åº”ç”¨äº<code>antd</code>çš„æ ·å¼ï¼Œéœ€è¦æŠŠ<code>antd</code>çš„æ ·å¼æ”¾åˆ°ä¸Šä¸€å±‚ä¸­ã€‚</p>
<h3 id="ä¼˜ç¼ºç‚¹-4">ä¼˜ç¼ºç‚¹</h3>
<p>| ä¼˜ç‚¹ | â€¢ ä¸éœ€è¦å¼•å…¥é¢å¤–çš„åŒ…ï¼Œæµè§ˆå™¨åŸç”Ÿæ”¯æŒ
â€¢ ä¸¥æ ¼éš”ç¦» |
| --- | --- |
| ç¼ºç‚¹ | â€¢ åœ¨æŸäº›åœºæ™¯ä¸‹å¯èƒ½å‡ºç°æ ·å¼å¤±æ•ˆçš„é—®é¢˜ï¼Œå¦‚ä¸Šé—®é¢˜ä¸­çš„shadow domå†…åˆ›å»ºäº†å…¨å±€çš„Modal |</p>
<h1 id="æµ…æqiankunä¸­çš„css-sandbox">æµ…æQianKunä¸­çš„CSS SandBox</h1>
<p>ä¸Šé¢æˆ‘ä»¬è®²è§£äº†ä¸€äº›å®ç°æ ·å¼éš”ç¦»çš„åŸºæœ¬æ–¹æ¡ˆï¼Œé‚£ä½œä¸ºä¸€ä¸ªæ¯”è¾ƒæˆç†Ÿçš„å¾®å‰ç«¯æ¡†æ¶<code>QianKun</code>ä¸­åˆæ˜¯æ€ä¹ˆå®ç°æ ·å¼éš”ç¦»æ–¹æ¡ˆçš„å‘¢ï¼Œä»¥ä¸‹çš„æºç è§£ææ˜¯åœ¨<code>v2.6.3</code>çš„ç‰ˆæœ¬ä¸Šç ”ç©¶çš„ï¼Œé¦–å…ˆé€šè¿‡çœ‹æ–‡æ¡£å¯ä»¥å‘ç°</p>
<p><img alt="Untitled" src="/assets/images/qiankunApi-e0c677bb3a6b8f068a2ee67eb5ea418a.png" width="2086" height="146"></p>
<p>åœ¨QianKunä¸­CSS SandBoxæœ‰ä¸¤ç§æ¨¡å¼ï¼š</p>
<ul>
<li><code>strictStyleIsolation</code>â€”â€”ä¸¥æ ¼æ²™ç®±æ¨¡å¼</li>
<li><code>experimentalStyleIsolation</code>â€”â€”å®éªŒæ€§æ²™ç®±æ¨¡å¼</li>
</ul>
<h2 id="strictstyleisolation">strictStyleIsolation</h2>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯è¯¥æ–¹æ¡ˆä¸æ˜¯ä¸€ä¸ªæ— è„‘çš„è§£å†³æ–¹æ¡ˆï¼Œå¼€å¯åéœ€è¦è¿›è¡Œä¸€å®šçš„é€‚é…</p>
</blockquote>
<p>ä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†ä»‹ç»ä¸‹è¯¥æ¨¡å¼ï¼š</p>
<p>æˆ‘ä»¬è®¾ç½®<code>strictStyleIsolation</code>ä¸º<code>true</code>æ—¶ï¼Œ<code>QianKun</code>é‡‡ç”¨çš„æ˜¯<code>Shadow DOM</code>æ–¹æ¡ˆï¼Œæ ¸å¿ƒå°±æ˜¯ä¸ºæ¯ä¸ªå¾®åº”ç”¨åŒ…è£¹ä¸Šä¸€ä¸ªShadow DOMèŠ‚ç‚¹ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹æ˜¯æ€ä¹ˆå®ç°çš„</p>
<p>å…ˆæ¥ä¸ªæµç¨‹å›¾æˆ‘ä»¬æœ‰ä¸ªå¤§è‡´çš„æ¦‚å¿µï¼š</p>
<p><img alt="Untitled" src="/assets/images/strictStyleIsolationæµç¨‹å›¾-f40032414f2ecb9342efef2023e78a24.png" width="1158" height="1374"></p>
<ul>
<li><strong><code>registerMicroApps</code>ï¼šæ³¨å†Œå­åº”ç”¨ï¼Œå¯¹æœªæ³¨å†Œçš„åº”ç”¨è¿›è¡Œè®°å½•ï¼ŒåŒæ—¶è°ƒç”¨single-spaä¸­çš„<code>registerApplication</code>è¿›è¡Œæ³¨å†Œ</strong></li>
<li><code>loadApp</code>ï¼šåŠ è½½å­åº”ç”¨ï¼Œåˆå§‹åŒ–åŠ è½½å­åº”ç”¨çš„Domç»“æ„ï¼Œåˆ›å»ºæ ·å¼æ²™ç®±å’ŒJSæ²™ç®±ç­‰ï¼ŒåŒæ—¶è¿”å›ä¸åŒé˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸ</li>
<li><code>createElement</code>ï¼šæ ·å¼æ²™ç®±çš„å…·ä½“å®ç°ï¼Œä¸»è¦åˆ†ä¸ºä¸¤ç§<code>strictStyleIsolation</code>å’Œ<code>experimentalStyleIsolation</code></li>
</ul>
<p><img alt="Untitled" src="/assets/images/strictStyleIsolation1-4d7aba4f70f3dfbee2f51d7ddfc110cd.png" width="2412" height="1140"></p>
<p><img alt="Untitled" src="/assets/images/strictStyleIsolation2-b2e152836b86acf4b58f3c25b06313cb.png" width="1772" height="844"></p>
<h3 id="registermicroappsæ³¨å†Œå­åº”ç”¨"><strong><strong>registerMicroAppsï¼šæ³¨å†Œå­åº”ç”¨</strong></strong></h3>
<pre><code class="language-tsx">export function registerMicroApps&lt;T extends ObjectType&gt;(apps: Array&lt;RegistrableApp&lt;T&gt;&gt;,lifeCycles?: FrameworkLifeCycles&lt;T&gt;,) {
...
    registerApplication({
      name,
      app: async () =&gt; {
        ...
        // åŠ è½½å¾®åº”ç”¨çš„å…·ä½“æ–¹æ³•ï¼Œæš´éœ²bootstrapã€mountã€unmountç­‰ç”Ÿå‘½å‘¨æœŸä»¥åŠä¸€äº›å…¶ä»–é…ç½®ä¿¡æ¯
        const { mount, ...otherMicroAppConfigs } = (
          await loadApp({ name, props, ...appConfig }, frameworkConfiguration, lifeCycles)
        )();
				...
      },
      // å­åº”ç”¨çš„æ¿€æ´»æ¡ä»¶
      activeWhen: activeRule
			...
    });
  });
}
</code></pre>
<p>è°ƒç”¨single-spaçš„registerApplicationå¯¹åº”ç”¨è¿›è¡Œæ³¨å†Œï¼Œå¹¶ä¸”åœ¨åº”ç”¨æ¿€æ´»çš„æ—¶å€™è°ƒç”¨appçš„å›è°ƒï¼Œå…¶ä¸­æœ€ä¸»è¦çš„æ˜¯<code>loadApp</code>åŠ è½½å¾®åº”ç”¨çš„å…·ä½“æ–¹æ³•</p>
<p>ä¸€äº›å‚æ•°çš„è¯´æ˜ï¼š</p>
<ul>
<li>
<p><code>apps</code>ï¼šå¾®åº”ç”¨çš„æ³¨å†Œä¿¡æ¯</p>
<p><img alt="Untitled" src="/assets/images/strictStyleIsolation3-c89cdbe4ae5b1de30db3cfec7889e487.png" width="648" height="350"></p>
</li>
<li>
<p><code>lifeCycles</code>ï¼šå¾®åº”ç”¨çš„ä¸€äº›ç”Ÿå‘½å‘¨æœŸé’©å­</p>
<p><img alt="Untitled" src="/assets/images/strictStyleIsolation4-b4e8a0ed5b4e6e360b1ed94c32252b60.png" width="1558" height="734"></p>
</li>
</ul>
<h3 id="loadappåŠ è½½å­åº”ç”¨">loadAppï¼šåŠ è½½å­åº”ç”¨</h3>
<pre><code class="language-tsx">function loadApp (app: LoadableApp&lt;T&gt;, configuration: FrameworkConfiguration = {},lifeCycles?: FrameworkLifeCycles&lt;T&gt;) {
...
/**
 * å°†æ“ä½œæƒäº¤ç»™ä¸»åº”ç”¨æ§åˆ¶ï¼Œè¿”å›ç»“æœæ¶‰åŠCSS SandBoxå’ŒJS SandBox
 * template --templateçš„ä¸ºlinkæ›¿æ¢ä¸ºstyleæ³¨é‡Šscriptçš„HTMLæ¨¡ç‰ˆ
 * execScripts --è„šæœ¬æ‰§è¡Œå™¨ï¼Œè®©æŒ‡å®šçš„è„šæœ¬(scripts)åœ¨è§„å®šçš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰§è¡Œï¼Œåªåšäº†è§£æš‚æ—¶ä¸è®²
 * assetPublicPath -- é™æ€èµ„æºåœ°å€ï¼Œåªåšäº†è§£æš‚æ—¶ä¸è®²
 */
const { template, execScripts, assetPublicPath } = await importEntry(entry, importEntryOpts);

// ç»™å­åº”ç”¨åŒ…è£¹ä¸€å±‚divåçš„å­åº”ç”¨htmlæ¨¡ç‰ˆ, æ˜¯æ¨¡ç‰ˆå­—ç¬¦ä¸²çš„å½¢å¼
const appContent = getDefaultTplWrapper(appInstanceId)(template);

let initialAppWrapperElement: HTMLElement | null = createElement(
    appContent,
		// æ˜¯å¦å¼€å¯äº†ä¸¥æ ¼æ¨¡å¼
    strictStyleIsolation,
		// æ˜¯å¦å¼€å¯å®éªŒæ€§çš„æ ·å¼éš”ç¦»
    scopedCSS,
		// æ ¹æ®åº”ç”¨åç”Ÿæˆçš„å”¯ä¸€å€¼ï¼Œå”¯ä¸€åˆ™ä¸ºappNameï¼Œä¸å”¯ä¸€åˆ™ä¸ºappName_[count]ä¸ºå…·ä½“æ•°é‡ï¼Œé‡å¤ä¼šcount++
    appInstanceId,
  );
...
// ä¸‹é¢è¿˜æœ‰ä¸€äº›ç”Ÿå‘½å‘¨æœŸçš„å¤„ç†æ–¹æ³•
}
</code></pre>
<p>Q1ï¼šåˆ°ç°åœ¨ä¸çŸ¥é“è¿˜æœ‰æ²¡æœ‰äººè®°å¾—æˆ‘ä»¬å¼€å¯ä¸¥æ ¼æ ·å¼æ¨¡å¼æ˜¯éœ€è¦åšå•¥ï¼Ÿ</p>
<p>ï¼ï¼ï¼æŠŠå­åº”ç”¨çš„Domç»“æ„æ”¾åˆ°Shadow domä¸­ä¸ä¸»åº”ç”¨éš”ç¦»ï¼Œé˜²æ­¢æ ·å¼æ±¡æŸ“</p>
<p>Q2ï¼šé‚£æˆ‘ä»¬å’‹æ‹¿åˆ°å­åº”ç”¨çš„domç»“æ„å‘¢ï¼Ÿ</p>
<p>æ²¡é”™å°±æ˜¯é€šè¿‡<code>import-html-entry</code>åº“çš„<code>import-html-entry</code>æ–¹æ³•ï¼Œæœ‰å…´è¶£ç»™çœ‹ä¸‹å…³äº<a href="https://juejin.cn/post/6885212507837825038">import-html-entryè§£æ</a></p>
<p><img alt="Untitled" src="/assets/images/strictStyleIsolation5-909dc9cb1f1f63404bf81ccd95438164.png" width="2966" height="1082"></p>
<p>æ²¡é”™æˆ‘ä»¬æ‹¿åˆ°äº†<code>template</code>ã€<code>execScripts</code>å’Œ<code>assetPublicPath</code>ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸å¯¹åä¸¤ä¸ªè¿›è¡Œè®²è§£ï¼Œèšç„¦åˆ°<code>template</code>ä¸Šï¼š</p>
<p>å¯¹æ¯”ä¸‹å­åº”ç”¨åŸæ¥çš„HTMLç»“æ„</p>
<p><img alt="Untitled" src="/assets/images/strictStyleIsolation6-0df3292326eeb7c35d6efe9ae0aee3dd.png" width="1801" height="628"></p>
<p>å¯ä»¥å‘ç°æˆ‘ä»¬æ‹¿åˆ°çš„<code>template</code>æ˜¯<code>link</code>æ ‡ç­¾å˜æˆ<code>style</code>æ ‡ç­¾æ³¨é‡Šäº†<code>script</code>çš„HTMLæ¨¡ç‰ˆï¼Œå…¶ä¸­å°±æœ‰æˆ‘ä»¬éœ€è¦çš„å­åº”ç”¨çš„Domç»“æ„ã€‚</p>
<p>æ‹¿åˆ°ä»¥åQianKuné‡Œåˆåœ¨<code>template</code>ä¸ŠåŒ…è£¹äº†ä¸€å±‚divå½¢æˆä¸€ä¸ªæ–°çš„HTMLç»“æ„çš„æ¨¡ç‰ˆå­—ç¬¦ä¸²ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿä¸»è¦æ˜¯ä¸ºäº†åœ¨ä¸»åº”ç”¨ä¸­æ ‡è¯†è¯¥èŠ‚ç‚¹ä¸‹çš„å†…å®¹ä¸ºå­åº”ç”¨ï¼Œå½“ç„¶åœ¨åé¢æˆ‘ä»¬ä¹Ÿéœ€è¦å®ƒè¿›è¡Œç‰¹åˆ«çš„å¤„ç†ï¼Œè¿™ä¸ªåé¢è®²åˆ°çš„æ—¶å€™å†è¯´ã€‚å› æ­¤æˆ‘ä»¬ç°åœ¨æ‹¿åˆ°çš„<code>appContent</code>é•¿æˆè¿™ä¸ªæ ·å­ï¼š</p>
<p><img alt="Untitled" src="/assets/images/strictStyleIsolation7-755cd43bfb1ae03ac67a420e8e5d403e.png" width="2690" height="848"></p>
<p>è¿™ä¸ªdivçš„idæ˜¯å”¯ä¸€çš„å“ˆï¼ï¼ï¼</p>
<p>é‚£æˆ‘ä»¬ç°åœ¨æ˜¯ä¸æ˜¯å·²ç»åšå¥½äº†å‰æœŸå‡†å¤‡ï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦è¿›å…¥æœ€åä¸€ä¸ªæ­¥éª¤ï¼ŒæŠŠå­åº”ç”¨çš„è¿™ä¸ªDomç»“æ„æŒ‚è½½åˆ°ä¸€ä¸ªshadow domä¸Šï¼Œè¿™å°±è¦ç”¨åˆ°<code>createElement</code>æ–¹æ³•ã€‚</p>
<p>è¿›å…¥<code>createElement</code>æ–¹æ³•å‰æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ç›®å‰çš„å‚æ•°å€¼ï¼š</p>
<ul>
<li>appContentï¼šåŒ…è£¹äº†ä¸€å±‚idå”¯ä¸€çš„divï¼Œå…·ä½“å¦‚ä¸Šæ‰€ç¤º</li>
<li>strictStyleIsolationï¼š<code>true</code></li>
<li>scopedCSSï¼š<code>false</code></li>
<li>appInstanceIdï¼š<code>react16</code></li>
</ul>
<h3 id="createelementæ·»åŠ shadow-dom">createElementï¼šæ·»åŠ shadow dom</h3>
<p>é‚£æˆ‘ä»¬ç°åœ¨å¦‚ä½•å»åˆ›å»ºä¸€ä¸ªshadow domï¼Œåœ¨å‰é¢å…³äºshadow domçš„è®²è§£ä¸­æˆ‘ä»¬çŸ¥é“ï¼Œåˆ›å»ºä¸€ä¸ªshadow domæˆ‘ä»¬éœ€è¦ä¸¤ä¸ªä¸œè¥¿ï¼š</p>
<p>ä¸€ã€æŒ‚è½½çš„domèŠ‚ç‚¹</p>
<p>äºŒã€éœ€è¦æ·»åŠ åˆ°shadow domçš„å†…å®¹</p>
<p>é‚£æˆ‘ä»¬ä»å“ªé‡Œå»æ‰¾å‘¢ï¼Œæ ¹æ®ä¼ è¿›æ¥çš„å‚æ•°å§ï¼Œæˆ‘ä»¬æ— ç–‘æ˜¯è¦å¯¹<code>appContent</code>è¿›è¡Œå¤„ç†äº†ï¼Œå›é¡¾ä¸‹<code>appContent</code>æœ‰ä»€ä¹ˆï¼ŒåŒ…è£¹äº†ä¸€å±‚divçš„å­åº”ç”¨çš„HTMLæ¨¡ç‰ˆæ˜¯å§ï¼Œè‡ªç„¶è€Œç„¶çš„æˆ‘ä»¬å°±å¯ä»¥ä»¥å¤–é¢çš„divä¸ºæŒ‚è½½çš„domèŠ‚ç‚¹ï¼Œæ‹¿å­åº”ç”¨çš„HTMLæ¨¡ç‰ˆä¸ºéœ€è¦æ·»åŠ åˆ°shadow domçš„å†…å®¹ï¼Œå³ï¼š</p>
<p><img alt="Untitled" src="/assets/images/strictStyleIsolation8-bc268c416c51209d5c339a90df341eba.png" width="2438" height="832"></p>
<p>ä½†æ˜¯é—®é¢˜åˆæ¥äº†ï¼Œ ç›®å‰çš„<code>appContent</code>æ˜¯æ¨¡ç‰ˆå­—ç¬¦ä¸²å˜ï¼Œæˆ‘ä»¬å’‹åŠï¼Ÿè¿™è¾¹QianKunçš„å¤„ç†æ–¹æ¡ˆæ˜¯ï¼š</p>
<p><img alt="Untitled" src="/assets/images/strictStyleIsolation9-4d0323c9692b77ac7f3dd02085218fdd.png" width="792" height="1378"></p>
<p>è¿™åªæ˜¯ä¸ªå¤§è‡´æµç¨‹ï¼Œä¸‹é¢è®©æˆ‘ä»¬è·Ÿç€è¿™æ ·çš„æ€æƒ³çœ‹ä¸‹ä»£ç é‡Œå¤„ç†ï¼š</p>
<pre><code class="language-tsx">function createElement(appContent: string,strictStyleIsolation: boolean,scopedCSS: boolean,appInstanceId: string) {
...
const containerElement = document.createElement(&#x27;div&#x27;);
  containerElement.innerHTML = appContent;
  const appElement = containerElement.firstChild as HTMLElement;
	// ä¸¥æ ¼æ ·å¼æ²™ç®±æ¨¡å¼
  if (strictStyleIsolation) {
    if (!supportShadowDOM) {
      console.warn(
        &#x27;[qiankun]: As current browser not support shadow dom, your strictStyleIsolation configuration will be ignored!&#x27;,
      );
    } else {
      const { innerHTML } = appElement;
      appElement.innerHTML = &#x27;&#x27;;
      let shadow: ShadowRoot;

			// åˆ›å»ºshadow domèŠ‚ç‚¹
      if (appElement.attachShadow) {
        shadow = appElement.attachShadow({ mode: &#x27;open&#x27; });
      } else {
        // å…¼å®¹ä½ç‰ˆæœ¬
        shadow = (appElement as any).createShadowRoot();
      }
      shadow.innerHTML = innerHTML;
    }
  }
...
// æ­¤å¤„çœç•¥äº†å¼€å¯experimentalStyleIsolationçš„å¤„ç†æ–¹æ³•
...
return appElement;
}
</code></pre>
<p>è¿™é‡Œæœ‰ä¸ªå¾ˆæœ‰æ„æ€çš„æ˜¯ï¼š</p>
<p>appContentä»¥innerHTMLå˜æˆdomç»“æ„åï¼ŒHTMLæ¨¡ç‰ˆä¸­çš„<code>&lt;html&gt;</code>ã€<code>&lt;head&gt;</code>ä»¥åŠ<code>&lt;body&gt;</code>ä¼šè¢«å»æ‰</p>
<p><img alt="Untitled" src="/assets/images/strictStyleIsolation10-2da6059e6329caa9be3d77c6c01210bf.png" width="2910" height="1464"></p>
<p>æœ€åæˆ‘ä»¬å†æ¥çœ‹ä¸‹å­åº”ç”¨æŒ‚è½½åˆ°ä¸»åº”ç”¨çš„Domç»“æ„ï¼š</p>
<p><img alt="Untitled" src="/assets/images/strictStyleIsolation11-26fc5e46711d13072ab2e3c6b5197fa1.png" width="1674" height="794"></p>
<p>ç¬”è€…åœ¨å®è·µçš„è¿‡ç¨‹ä¸­ä¹Ÿé‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼š</p>
<p>1ã€å¾®åº”ç”¨ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¼•å…¥å›¾ç‰‡å‡ºç°åŠ è½½èµ„æº404çš„é—®é¢˜ï¼Œè¿™è¾¹ç¬”è€…æ²¡æœ‰è¿›è¡Œè¿‡å¤šçš„å°è¯•å¯ä»¥å‚è€ƒä¸‹å®˜æ–¹çš„ï¼š<a href="https://qiankun.umijs.org/zh/faq#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BE%AE%E5%BA%94%E7%94%A8%E5%8A%A0%E8%BD%BD%E7%9A%84%E8%B5%84%E6%BA%90%E4%BC%9A-404">https://qiankun.umijs.org/zh/faq#ä¸ºä»€ä¹ˆå¾®åº”ç”¨åŠ è½½çš„èµ„æºä¼š-404</a></p>
<p>2ã€è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯reactä¸­åŠ¨æ€æ‰“å¼€Modalå¤±æ•ˆçš„é—®é¢˜ï¼ŒåŸå› å¯ä»¥çœ‹ä¸‹â€£ï¼Œå¤§æ¦‚çœ‹äº†ä¸‹å’ŒReactçš„äº‹ä»¶æœºåˆ¶æœ‰å…³ï¼Œå³ä½¿æ˜¯è®¾ç½®å¼¹çª—é»˜è®¤å¼€å¯ï¼Œä¹Ÿä¼šå‡ºç°ä¹‹å‰ä¸Šé¢æåˆ°çš„ï¼Œæ ·å¼ä¸¢å¤±çš„é—®é¢˜</p>
<p>ï¼ï¼ï¼çœ‹ä¸‹ä¸€ä¸ªä¹‹å‰ç®€å•å›é¡¾ä¸‹å§â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p>
<h2 id="experimentalstyleisolation">experimentalStyleIsolation</h2>
<p>æˆ‘ä»¬è®¾ç½®<code>experimentalStyleIsolation</code>ä¸º<code>true</code>æ—¶ï¼Œ<code>QianKun</code>é‡‡ç”¨çš„æ˜¯<code>Runtime css transformer</code> åŠ¨æ€åŠ è½½/å¸è½½æ ·å¼è¡¨æ–¹æ¡ˆï¼Œä¸ºå­åº”ç”¨çš„æ ·å¼è¡¨å¢åŠ ä¸€ä¸ªç‰¹æ®Šçš„é€‰æ‹©å™¨ä»è€Œé™å®šå½±å“èŒƒå›´ï¼Œç±»ä¼¼ä»¥ä¸‹ç»“æ„ï¼š</p>
<pre><code class="language-tsx">// å‡è®¾åº”ç”¨åæ˜¯ react16
&lt;style&gt;
.app-main {
  font-size: 14px;
}
&lt;/style&gt;

&lt;style&gt;
div[data-qiankun=&quot;react16&quot;] .app-main {
  font-size: 14px;
}
&lt;style&gt;
</code></pre>
<p>å…ˆæ¥é€šè¿‡æµç¨‹å›¾äº†è§£ä¸‹å¤§è‡´  æµç¨‹</p>
<p><img alt="111.png" src="/assets/images/experimentalStyleIsolation-5c37f0ce02e2ba50516fda33c13da802.png" width="3153" height="5106"></p>
<h3 id="createelementç»™æœ€å¤–å±‚å¢åŠ data-qiankunå±æ€§å¹¶ä¸”è·å–æ‰€æœ‰styleæ ‡ç­¾">createElementï¼šç»™æœ€å¤–å±‚å¢åŠ data-qiankunå±æ€§ï¼Œå¹¶ä¸”è·å–æ‰€æœ‰styleæ ‡ç­¾</h3>
<pre><code class="language-tsx">function createElement(appContent: string, strictStyleIsolation: boolean, scopedCSS: boolean,appInstanceId: string) {
...
if (scopedCSS) {
		// ç»™æœ€å¤–å±‚è®¾ç½®data-qiankunçš„å±æ€§
    const attr = appElement.getAttribute(css.QiankunCSSRewriteAttr);
    if (!attr) {
      appElement.setAttribute(css.QiankunCSSRewriteAttr, appInstanceId);
    }
		// è·å–æ‰€æœ‰çš„styleæ ‡ç­¾,è¿›è¡Œéå†
    const styleNodes = appElement.querySelectorAll(&#x27;style&#x27;) || [];
    forEach(styleNodes, (stylesheetElement: HTMLStyleElement) =&gt; {
      css.process(appElement!, stylesheetElement, appInstanceId);
    });
  }
...
}

export const QiankunCSSRewriteAttr = &#x27;data-qiankun&#x27;;
</code></pre>
<p>æˆ‘ä»¬æ¥çœ‹ä¸‹è®¾ç½®å®Œå±æ€§åçš„å±æ€§åçš„appElement</p>
<p><img alt="Untitled" src="/assets/images/experimentalStyleIsolation1-a7160cb7bb05a10b3927f30099116fdf.png" width="2242" height="494"></p>
<p>styleNodes</p>
<p><img alt="Untitled" src="/assets/images/experimentalStyleIsolation2-1b99f67e596eb294b766ab927c9a4309.png" width="692" height="110"></p>
<h3 id="cssprocessè¯¦ç»†å¤„ç†">css.processè¯¦ç»†å¤„ç†</h3>
<pre><code class="language-tsx">/**
* å®ä¾‹åŒ–ScopedCSS
* ç”Ÿæˆæ ¹å…ƒç´ å±æ€§é€‰æ‹©å™¨[data-qiankun=&quot;åº”ç”¨å&quot;]å‰ç¼€
*/
export const process = (
  appWrapper: HTMLElement,
  stylesheetElement: HTMLStyleElement | HTMLLinkElement,
  appName: string,
): void =&gt; {
  // å®ä¾‹åŒ–ScopedCSS
  if (!processor) {
    processor = new ScopedCSS();
  }
	...
	// ä¸€äº›ç©ºå€¼çš„å¤„ç†
  const mountDOM = appWrapper;
  if (!mountDOM) {
    return;
  }

  const tag = (mountDOM.tagName || &#x27;&#x27;).toLowerCase();

  if (tag &amp;&amp; stylesheetElement.tagName === &#x27;STYLE&#x27;) {
		// ç”Ÿæˆå‰ç¼€ï¼Œæ ¹å…ƒç´ æ ‡ç­¾å[data-qiankun=&quot;åº”ç”¨å&quot;]
    const prefix = `${tag}[${QiankunCSSRewriteAttr}=&quot;${appName}&quot;]`;
    processor.process(stylesheetElement, prefix);
  }
};
</code></pre>
<ul>
<li>
<p>prefixï¼š</p>
<p><code>div[data-qiankun=&quot;react16&quot;]</code></p>
</li>
<li>
<p>stylesheetElementï¼š</p>
</li>
</ul>
<p><img alt="Untitled" src="/assets/images/experimentalStyleIsolation3-65317c3a950bee05b9349490ba2778ae.png" width="742" height="244"></p>
<h3 id="è¿›å…¥processorprocessçœ‹çœ‹å¯¹å®ƒè¿›è¡Œäº†ä»€ä¹ˆæ“ä½œ">è¿›å…¥processor.processçœ‹çœ‹å¯¹å®ƒè¿›è¡Œäº†ä»€ä¹ˆæ“ä½œ</h3>
<pre><code class="language-tsx">// é‡å†™æ ·å¼é€‰æ‹©å™¨ä»¥åŠå¯¹äºç©ºçš„styleèŠ‚ç‚¹è®¾ç½®MutationObserverç›‘å¬ï¼ŒåŸå› å¯èƒ½å­˜åœ¨åŠ¨æ€å¢åŠ æ ·å¼çš„æƒ…å†µ
process(styleNode: HTMLStyleElement, prefix: string = &#x27;&#x27;) {
		// å½“styleæ ‡ç­¾æœ‰å†…å®¹æ—¶è¿›è¡Œæ“ä½œ
    if (styleNode.textContent !== &#x27;&#x27;) {
			// styleNode.textContentä¸ºstyleæ ‡ç­¾å†…çš„å†…å®¹
      const textNode = document.createTextNode(styleNode.textContent || &#x27;&#x27;);
			// swapNodeä¸ºåˆ›å»ºçš„ç©ºçš„styleæ ‡ç­¾
      this.swapNode.appendChild(textNode);
			// è·å–æ ·å¼è¡¨
      const sheet = this.swapNode.sheet as any;
			// ä»æ ·å¼è¡¨è·å–cssRulesè¯¥å€¼æ˜¯æ ‡å‡†çš„ï¼ŒæŠŠæ ·å¼è§„åˆ™ä»ä¼ªæ•°ç»„è½¬åŒ–æˆæ•°ç»„
      const rules = arrayify&lt;CSSRule&gt;(sheet?.cssRules ?? []);
			// é€šè¿‡éå†å’Œæ­£åˆ™é‡å†™æ¯ä¸ªé€‰æ‹©å™¨çš„å‰ç¼€
      const css = this.rewrite(rules, prefix);
			// å°†å¤„ç†åçš„é‡å†™åçš„cssæ”¾å…¥åŸæ¥çš„styleNodeä¸­
      styleNode.textContent = css;
      // æ¸…ç†å·¥å…·äººswapNode
      this.swapNode.removeChild(textNode);
      return;
    }

		//å¯¹ç©ºçš„æ ·å¼èŠ‚ç‚¹è¿›è¡Œç›‘å¬ï¼Œå¯èƒ½å­˜åœ¨åŠ¨æ€æ’å…¥çš„é—®é¢˜
    const mutator = new MutationObserver((mutations) =&gt; {
      for (let i = 0; i &lt; mutations.length; i += 1) {
				// mutationä¸ºå˜æ›´çš„æ¯ä¸ªè®°å½•MutationRecord
        const mutation = mutations[i];

				// åˆ¤æ–­è¯¥èŠ‚ç‚¹æ˜¯å¦åº”å¤„ç†è¿‡
        if (ScopedCSS.ModifiedTag in styleNode) {
          return;
        }

        if (mutation.type === &#x27;childList&#x27;) {
          const sheet = styleNode.sheet as any;
          const rules = arrayify&lt;CSSRule&gt;(sheet?.cssRules ?? []);
          const css = this.rewrite(rules, prefix);

          styleNode.textContent = css;
          // å¢åŠ å¤„ç†èŠ‚ç‚¹çš„æ ‡è¯†
          (styleNode as any)[ScopedCSS.ModifiedTag] = true;
        }
      }
    });

    // ç›‘å¬å½“å‰çš„styleæ ‡ç­¾ï¼Œå½“styleNodeä¸ºç©ºçš„æ—¶å€™ï¼Œä»¥åŠå˜æ›´çš„æ—¶å€™ï¼Œæ¯”å¦‚å¼•å…¥çš„antdæ ·å¼æ–‡ä»¶
    mutator.observe(styleNode, { childList: true });
  }
</code></pre>
<p>Q1ï¼šä¸ºä»€ä¹ˆåœ¨<code>style</code>æ ‡ç­¾æœ‰å†…å®¹çš„æ—¶å€™ä½¿ç”¨<code>this.swapNode</code>è¿™ä¸ªå·¥å…·äººï¼Œè€Œåœ¨ç›‘å¬çš„æ—¶å€™ä¸ä½¿ç”¨ï¼Ÿ</p>
<p>è¿˜è®°å¾—æˆ‘ä»¬æ˜¯éœ€è¦å¹²ä»€ä¹ˆå—ï¼Ÿ</p>
<p>æ”¹å†™<code>style</code>æ ‡ç­¾å†…çš„æ ·å¼è§„åˆ™</p>
<p>å› æ­¤è¿™é‡Œå°±é€šè¿‡<code>style.sheet.cssRules</code>æ–¹å¼å»è·å–styleæ ‡ç­¾é‡Œçš„æ¯ä¸€æ¡è§„åˆ™è¿›è¡Œé‡å†™ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹<code>sheet</code>æ ·å¼è¡¨çš„æ•°æ®ç»“æ„</p>
<p><img alt="Untitled" src="/assets/images/experimentalStyleIsolation4-580d70c7d6b84f1eee5ded88982be30b.png" width="1299" height="344"></p>
<p>é€šè¿‡è¿™ä¸ªç»“æ„æˆ‘ä»¬å…¶å®ä¸‹ä¸€æ­¥æƒ³è¦åšçš„äº‹æƒ…å¾ˆæ¸…æ¥šäº†</p>
<p>å°±æ˜¯é‡å†™æ¯ä¸€æ¡<code>cssRules</code>å¹¶ä¸”é€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥èµ‹å€¼ç»™<code>style</code>æ ‡ç­¾</p>
<p><img alt="Untitled" src="/assets/images/experimentalStyleIsolation5-2acf7a8bb0f4f77623e7453b1cedea5b.png" width="2754" height="504"></p>
<p>ä½†æ˜¯æˆ‘ä»¬å¾—æ³¨æ„ä¸¤ç‚¹ï¼š</p>
<ul>
<li>é€‰æ‹©å™¨ä¸åŒæˆ‘ä»¬çš„å¤„ç†æ–¹å¼ä¹Ÿä¸åŒ</li>
<li>å¯¹é€‰æ‹©å™¨çš„åŒ¹é…è§„åˆ™çš„å¤„ç†</li>
</ul>
<h3 id="è®©æˆ‘ä»¬çœ‹çœ‹rewriteå…·ä½“è¿›è¡Œäº†ä»€ä¹ˆæ“ä½œè¿™é‡Œä¸»è¦åˆ†ä¸ºä¸¤å—">è®©æˆ‘ä»¬çœ‹çœ‹rewriteå…·ä½“è¿›è¡Œäº†ä»€ä¹ˆæ“ä½œï¼Œè¿™é‡Œä¸»è¦åˆ†ä¸ºä¸¤å—ï¼š</h3>
<ul>
<li>
<p>ä¸€å¯¹é€‰æ‹©å™¨çš„ç±»å‹è¿›è¡Œåˆ¤æ–­</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/CSSRule/type">CSSRule.type</a></p>
</li>
</ul>
<pre><code class="language-tsx">private rewrite(rules: CSSRule[], prefix: string = &#x27;&#x27;) {
    let css = &#x27;&#x27;;

    rules.forEach((rule) =&gt; {
      switch (rule.type) {
	      // æ™®é€šé€‰æ‹©å™¨ç±»å‹
        case RuleType.STYLE:
          css += this.ruleStyle(rule as CSSStyleRule, prefix);
          break;
				// @mediaé€‰æ‹©å™¨ç±»å‹
        case RuleType.MEDIA:
          css += this.ruleMedia(rule as CSSMediaRule, prefix);
          break;
				// @supportsé€‰æ‹©å™¨ç±»å‹
        case RuleType.SUPPORTS:
          css += this.ruleSupport(rule as CSSSupportsRule, prefix);
          break;
        default:
          css += `${rule.cssText}`;
          break;
      }
    });

    return css;
  }
</code></pre>
<ul>
<li>äºŒæ˜¯è¿›è¡Œæ­£åˆ™æ›¿æ¢</li>
</ul>
<p>ç‰¹æ®Šçš„</p>
<pre><code class="language-tsx">// å¤„ç†ç±»ä¼¼äº@media screen and (min-width: 900px) {}
private ruleMedia(rule: CSSMediaRule, prefix: string) {
  const css = this.rewrite(arrayify(rule.cssRules), prefix);
  return `@media ${rule.conditionText} {${css}}`;
}

// å¤„ç†ç±»ä¼¼äº@supports (display: grid) {}
private ruleSupport(rule: CSSSupportsRule, prefix: string) {
  const css = this.rewrite(arrayify(rule.cssRules), prefix);
  return `@supports ${rule.conditionText} {${css}}`;
}
</code></pre>
<p>æ™®é€šçš„</p>
<pre><code class="language-tsx">// prefixä¸º&quot;div[data-qiankun=&quot;react16&quot;]&quot;
private ruleStyle(rule: CSSStyleRule, prefix: string) {
		// æ ¹é€‰æ‹©å™¨ï¼Œæ¯”å¦‚bodyã€htmlä»¥åŠ:root
    const rootSelectorRE = /((?:[^\w\-.#]|^)(body|html|:root))/gm;
		// æ ¹ç»„åˆé€‰æ‹©å™¨ï¼Œç±»ä¼¼äº html body{...}
    const rootCombinationRE = /(html[^\w{[]+)/gm;

		// è·å–é€‰æ‹©å™¨
    const selector = rule.selectorText.trim();

		// è·å–æ ·å¼æ–‡æœ¬ï¼Œæ¯”å¦‚&quot;html { font-family: sans-serif; line-height: 1.15; text-size-adjust: 100%; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); }&quot;
    let { cssText } = rule;
	   // å¯¹æ ¹é€‰æ‹©å™¨(bodyã€htmlã€:root)è¿›è¡Œåˆ¤æ–­ï¼Œæ›¿æ¢æˆprefix
    if (selector === &#x27;html&#x27; || selector === &#x27;body&#x27; || selector === &#x27;:root&#x27;) {
      return cssText.replace(rootSelectorRE, prefix);
    }

    // å¯¹äºæ ¹ç»„åˆé€‰æ‹©å™¨è¿›è¡ŒåŒ¹é…
    if (rootCombinationRE.test(rule.selectorText)) {
      const siblingSelectorRE = /(html[^\w{]+)(\+|~)/gm;
			// å¯¹äºéæ ‡å‡†çš„å…„å¼Ÿé€‰æ‹©å™¨è½¬æ¢æ—¶è¿›è¡Œå¿½ç•¥ï¼Œç½®ç©ºå¤„ç†
      if (!siblingSelectorRE.test(rule.selectorText)) {
        cssText = cssText.replace(rootCombinationRE, &#x27;&#x27;);
      }
    }

    // æ™®é€šé€‰æ‹©å™¨åŒ¹é…
    cssText = cssText.replace(/^[\s\S]+{/, (selectors) =&gt;
			// selectorsä¸ºç±»ä¼¼äº.link{
      selectors.replace(/(^|,\n?)([^,]+)/g, (item, p, s) =&gt; {
				// å¤„ç†ç±»ä¼¼äºdiv,body,span { ... }ï¼Œå«æœ‰æ ¹å…ƒç´ çš„
        if (rootSelectorRE.test(item)) {
          return item.replace(rootSelectorRE, (m) =&gt; {
            const whitePrevChars = [&#x27;,&#x27;, &#x27;(&#x27;];
						// å°†å…¶ä¸­çš„æ ¹å…ƒç´ æ›¿æ¢ä¸ºå‰ç¼€ä¿ç•™,æˆ–è€…ï¼ˆ
            if (m &amp;&amp; whitePrevChars.includes(m[0])) {
              return `${m[0]}${prefix}`;
            }
						// ç›´æ¥æŠŠæ ¹å…ƒç´ æ›¿æ¢æˆå‰ç¼€
            return prefix;
          });
        }

        return `${p}${prefix} ${s.replace(/^ */, &#x27;&#x27;)}`;
      }),
    );

    return cssText;
  }
</code></pre>
<h3 id="åŠ¨æ€æ·»åŠ æ ·å¼çš„æ€è€ƒ">åŠ¨æ€æ·»åŠ æ ·å¼çš„æ€è€ƒğŸ¤”</h3>
<p>é‚£ä¹ˆé€šè¿‡JSåŠ¨æ€æ·»åŠ çš„<code>style</code>ã€<code>link</code>æˆ–è€…<code>script</code>æ ‡ç­¾éƒ½æ˜¯ä¸æ˜¯ä¹Ÿéœ€è¦è¿è¡Œåœ¨ç›¸åº”çš„<code>CSS</code>æˆ–è€…<code>JS</code>æ²™ç®±ä¸­å‘¢ï¼Œæ·»åŠ è¿™äº›æ ‡ç­¾çš„å¸¸è§æ–¹æ³•æ— ç–‘æ˜¯<code>createElement</code>ã€<code>appendChild</code>å’Œ<code>insertBefore</code>ï¼Œé‚£å…¶å®æˆ‘ä»¬åªè¦å¯¹ä»–ä»¬è®¾ç½®ç›‘å¬å°±å¯ä»¥äº†</p>
<p><code>dynamicAppend</code>å°±æ˜¯ç”¨æ¥è§£å†³ä¸Šé¢çš„é—®é¢˜çš„ï¼Œå®ƒæš´éœ²äº†ä¸¤ä¸ªæ–¹æ³•</p>
<ul>
<li>patchStrictSandboxï¼šQianKun JSæ²™ç®±æ¨¡å¼çš„å¤šä¾‹æ¨¡å¼</li>
</ul>
<p><img alt="patchStrictSandbox.png" src="/assets/images/patchStrictSandbox-c6207c8d748f193c9153b1a22aa9cbba.png" width="2660" height="3020"></p>
<p><strong>patchStrictSandbox</strong></p>
<pre><code class="language-tsx">export function patchStrictSandbox(
  appName: string,
	// è¿”å›åŒ…è£¹å­åº”ç”¨çš„é‚£ä¸€å—Domç»“æ„
  appWrapperGetter: () =&gt; HTMLElement | ShadowRoot,
  proxy: Window,
  mounting = true,
  scopedCSS = false,
  excludeAssetFilter?: CallableFunction,
){
  ...
let containerConfig = proxyAttachContainerConfigMap.get(proxy);
  if (!containerConfig) {
    containerConfig = {
      appName,
      proxy,
      appWrapperGetter,
      dynamicStyleSheetElements: [],
      strictGlobal: true,
      excludeAssetFilter,
      scopedCSS,
    };
		// å»ºç«‹äº†ä»£ç†å¯¹è±¡å’Œå­åº”ç”¨é…ç½®ä¿¡æ¯Mapå…³ç³»
    proxyAttachContainerConfigMap.set(proxy, containerConfig);
  }

	// é‡å†™Document.prototype.createElement
  const unpatchDocumentCreate = patchDocumentCreateElement();

	// é‡å†™appendChildã€insertBefore
  const unpatchDynamicAppendPrototypeFunctions = patchHTMLDynamicAppendPrototypeFunctions(
    (element) =&gt; elementAttachContainerConfigMap.has(element),
    (element) =&gt; elementAttachContainerConfigMap.get(element)!,
  );
  ...
}
</code></pre>
<ul>
<li>æ‰©å±•<code>Document.prototype.createElement</code></li>
<li>æ‰©å±•<code>appendChild</code>ã€<code>insertBefore</code></li>
</ul>
<p><strong>patchDocumentCreateElement</strong></p>
<pre><code class="language-tsx">function patchDocumentCreateElement() {
	// è®°å½•createElementæ˜¯å¦è¢«é‡å†™
  const docCreateElementFnBeforeOverwrite = docCreatePatchedMap.get(document.createElement);

  if (!docCreateElementFnBeforeOverwrite) {
    const rawDocumentCreateElement = document.createElement;
		// é‡å†™Document.prototype.createElement
    Document.prototype.createElement = function createElement&lt;K extends keyof HTMLElementTagNameMap&gt;(
      this: Document,
      tagName: K,
      options?: ElementCreationOptions,
    ): HTMLElement {
      const element = rawDocumentCreateElement.call(this, tagName, options);
			// åˆ¤æ–­åˆ›å»ºçš„æ˜¯å¦ä¸ºstyleã€linkå’Œscriptæ ‡ç­¾
      if (isHijackingTag(tagName)) {
        const { window: currentRunningSandboxProxy } = getCurrentRunningApp() || {};
        if (currentRunningSandboxProxy) {
					// è·å–å­åº”ç”¨çš„é…ç½®ä¿¡æ¯
          const proxyContainerConfig = proxyAttachContainerConfigMap.get(currentRunningSandboxProxy);
          if (proxyContainerConfig) {
            // å»ºç«‹æ–°å…ƒç´ elementå’Œå­åº”ç”¨é…ç½®çš„å¯¹åº”å…³ç³»
            elementAttachContainerConfigMap.set(element, proxyContainerConfig);
          }
        }
      }

      return element;
    };

    if (document.hasOwnProperty(&#x27;createElement&#x27;)) {
			// é‡å†™
      document.createElement = Document.prototype.createElement;
    }

    docCreatePatchedMap.set(Document.prototype.createElement, rawDocumentCreateElement);
  }
}

function isHijackingTag(tagName?: string) {
  return (
    tagName?.toUpperCase() === LINK_TAG_NAME ||
    tagName?.toUpperCase() === STYLE_TAG_NAME ||
    tagName?.toUpperCase() === SCRIPT_TAG_NAME
  );
}
</code></pre>
<ul>
<li>é‡å†™<code>document.createElement</code></li>
<li>å»ºç«‹æ–°å…ƒç´ elementå’Œå­åº”ç”¨é…ç½®çš„å¯¹åº”å…³ç³»<code>elementAttachContainerConfigMap</code></li>
</ul>
<p><strong>patchHTMLDynamicAppendPrototypeFunctions</strong></p>
<pre><code class="language-tsx">export function patchHTMLDynamicAppendPrototypeFunctions(
  isInvokedByMicroApp: (element: HTMLElement) =&gt; boolean,
  containerConfigGetter: (element: HTMLElement) =&gt; ContainerConfig,
) {
  // å½“appendChildå’ŒinsertBeforeæ²¡æœ‰è¢«é‡å†™çš„æ—¶å€™
  if (
    HTMLHeadElement.prototype.appendChild === rawHeadAppendChild &amp;&amp;
    HTMLBodyElement.prototype.appendChild === rawBodyAppendChild &amp;&amp;
    HTMLHeadElement.prototype.insertBefore === rawHeadInsertBefore
  ) {
    HTMLHeadElement.prototype.appendChild = getOverwrittenAppendChildOrInsertBefore({
      rawDOMAppendOrInsertBefore: rawHeadAppendChild,
      containerConfigGetter,
      isInvokedByMicroApp,
    }) as typeof rawHeadAppendChild;
    HTMLBodyElement.prototype.appendChild = getOverwrittenAppendChildOrInsertBefore({
      rawDOMAppendOrInsertBefore: rawBodyAppendChild,
      containerConfigGetter,
      isInvokedByMicroApp,
    }) as typeof rawBodyAppendChild;

    HTMLHeadElement.prototype.insertBefore = getOverwrittenAppendChildOrInsertBefore({
      rawDOMAppendOrInsertBefore: rawHeadInsertBefore as any,
      containerConfigGetter,
      isInvokedByMicroApp,
    }) as typeof rawHeadInsertBefore;
  }}
</code></pre>
<ul>
<li>å½“appendChildã€appendChildå’ŒinsertBeforeæ²¡æœ‰è¢«é‡å†™çš„æ—¶å€™è¿›è¡Œé‡å†™</li>
</ul>
<p>getOverwrittenAppendChildOrInsertBefore</p>
<pre><code class="language-tsx">function getOverwrittenAppendChildOrInsertBefore(opts: {
  rawDOMAppendOrInsertBefore: &lt;T extends Node&gt;(newChild: T, refChild?: Node | null) =&gt; T;
  isInvokedByMicroApp: (element: HTMLElement) =&gt; boolean;
  containerConfigGetter: (element: HTMLElement) =&gt; ContainerConfig;
}) {
  return function appendChildOrInsertBefore&lt;T extends Node&gt;(
    this: HTMLHeadElement | HTMLBodyElement,
    newChild: T,
    refChild: Node | null = null,
  ) {
    let element = newChild as any;
    const { rawDOMAppendOrInsertBefore, isInvokedByMicroApp, containerConfigGetter } = opts;
    // å½“ä¸æ˜¯styleã€linkæˆ–è€…æ˜¯scriptæ ‡ç­¾çš„æ—¶å€™æˆ–è€…åœ¨å…ƒç´ çš„åˆ›å»ºæ‰¾ä¸åˆ°å¯¹åº”çš„å­åº”ç”¨é…ç½®ä¿¡æ¯æ—¶ï¼Œèµ°åŸç”Ÿçš„æ–¹æ³•
    if (!isHijackingTag(element.tagName) || !isInvokedByMicroApp(element)) {
      return rawDOMAppendOrInsertBefore.call(this, element, refChild) as T;
    }

    if (element.tagName) {
      // è·å–å½“å‰å­åº”ç”¨çš„é…ç½®ä¿¡æ¯
      const containerConfig = containerConfigGetter(element);
      const {
        appName,
        appWrapperGetter,
        proxy,
        strictGlobal,
        dynamicStyleSheetElements,
        scopedCSS,
        excludeAssetFilter,
      } = containerConfig;

      switch (element.tagName) {
        case LINK_TAG_NAME:
        case STYLE_TAG_NAME: {
          let stylesheetElement: HTMLLinkElement | HTMLStyleElement = newChild as any;
          const { href } = stylesheetElement as HTMLLinkElement;
          // é…ç½®é¡¹ä¸éœ€è¦è¢«åŠ«æŒçš„èµ„æº
          if (excludeAssetFilter &amp;&amp; href &amp;&amp; excludeAssetFilter(href)) {
            return rawDOMAppendOrInsertBefore.call(this, element, refChild) as T;
          }

          // æŒ‚è½½çš„domç»“æ„ï¼Œå³å­åº”ç”¨çš„domç»“æ„
          const mountDOM = appWrapperGetter();

          // å¦‚æœå¼€å¯äº†å®éªŒæ€§çš„æ ·å¼æ²™ç®±æ¨¡å¼
          if (scopedCSS) {
            // exclude link elements like &lt;link rel=&quot;icon&quot; href=&quot;favicon.ico&quot;&gt;
            const linkElementUsingStylesheet =
              element.tagName?.toUpperCase() === LINK_TAG_NAME &amp;&amp;
              (element as HTMLLinkElement).rel === &#x27;stylesheet&#x27; &amp;&amp;
              (element as HTMLLinkElement).href;
            // å¯¹äºlinkæ ‡ç­¾è¿›è¡Œæ ·å¼èµ„æºä¸‹è½½ï¼Œå¹¶è¿›è¡Œæ ·å¼çš„é‡å†™
            if (linkElementUsingStylesheet) {
              const fetch =
                typeof frameworkConfiguration.fetch === &#x27;function&#x27;
                  ? frameworkConfiguration.fetch
                  : frameworkConfiguration.fetch?.fn;
              stylesheetElement = convertLinkAsStyle(
                element,
                (styleElement) =&gt; css.process(mountDOM, styleElement, appName),
                fetch,
              );
              dynamicLinkAttachedInlineStyleMap.set(element, stylesheetElement);
            } else {
              css.process(mountDOM, stylesheetElement, appName);
            }
          }

          // é‡å†™ä»¥åçš„styleæ ‡ç­¾
          dynamicStyleSheetElements.push(stylesheetElement);
          const referenceNode = mountDOM.contains(refChild) ? refChild : null;
          return rawDOMAppendOrInsertBefore.call(mountDOM, stylesheetElement, referenceNode);
        }
	...
}
</code></pre>
<ul>
<li>patchLooseSandboxï¼šQianKun JSæ²™ç®±æ¨¡å¼çš„å•ä¾‹æ¨¡å¼å’Œå¿«ç…§æ¨¡å¼ä¸‹</li>
</ul>
<p><img alt="patchLooseSandbox.png" src="/assets/images/patchLooseSandbox-2b54fc301c0f3f3b0c4e71b965825f0c.png" width="2660" height="2522"></p>
<pre><code class="language-tsx">export function patchLooseSandbox(
  appName: string,
  appWrapperGetter: () =&gt; HTMLElement | ShadowRoot,
  proxy: Window,
  mounting = true,
  scopedCSS = false,
  excludeAssetFilter?: CallableFunction,
): Freer {
  let dynamicStyleSheetElements: Array&lt;HTMLLinkElement | HTMLStyleElement&gt; = [];

  const unpatchDynamicAppendPrototypeFunctions = patchHTMLDynamicAppendPrototypeFunctions(
    // åˆ¤æ–­å½“å‰å¾®åº”ç”¨æ˜¯å¦è¿è¡Œ
		() =&gt; checkActivityFunctions(window.location).some((name) =&gt; name === appName),
    // è¿”å›å¾®åº”ç”¨çš„é…ç½®ä¿¡æ¯
		() =&gt; ({
      appName,
      appWrapperGetter,
      proxy,
      strictGlobal: false,
      scopedCSS,
      dynamicStyleSheetElements,
      excludeAssetFilter,
    }),
  );
}
</code></pre>
<p>ç”±äºæ˜¯å•ä¾‹æ¨¡å¼ä¿®æ”¹çš„è¿˜æ˜¯å…¨å±€çš„windowå»æ‰äº†å¯¹<code>document.createElement</code>çš„é‡å†™ï¼Œä¸éœ€è¦å»ºç«‹å¾®åº”ç”¨å’Œæ–°å»ºå…ƒç´ çš„ä¸€ä¸€å¯¹åº”</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/micfrontend/practice/communication"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">communication</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/micfrontend/æ·±å…¥ç†è§£QianKun/JS SandBox/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">JS SandBox</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#css-in-js" class="table-of-contents__link toc-highlight">CSS in JS</a><ul><li><a href="#ä¼˜ç¼ºç‚¹" class="table-of-contents__link toc-highlight">ä¼˜ç¼ºç‚¹</a></li></ul></li><li><a href="#æ ·å¼çº¦å®š" class="table-of-contents__link toc-highlight">æ ·å¼çº¦å®š</a><ul><li><a href="#ä¼˜ç¼ºç‚¹-1" class="table-of-contents__link toc-highlight">ä¼˜ç¼ºç‚¹</a></li></ul></li><li><a href="#é¢„å¤„ç†å™¨" class="table-of-contents__link toc-highlight">é¢„å¤„ç†å™¨</a><ul><li><a href="#ä¼˜ç¼ºç‚¹-2" class="table-of-contents__link toc-highlight">ä¼˜ç¼ºç‚¹</a></li></ul></li><li><a href="#css-module" class="table-of-contents__link toc-highlight">CSS Module</a><ul><li><a href="#ä¼˜ç¼ºç‚¹-3" class="table-of-contents__link toc-highlight">ä¼˜ç¼ºç‚¹</a></li></ul></li><li><a href="#shadow-dom" class="table-of-contents__link toc-highlight">Shadow DOM</a><ul><li><a href="#é—®é¢˜" class="table-of-contents__link toc-highlight">é—®é¢˜ï¼š</a></li><li><a href="#ä¼˜ç¼ºç‚¹-4" class="table-of-contents__link toc-highlight">ä¼˜ç¼ºç‚¹</a></li></ul></li><li><a href="#strictstyleisolation" class="table-of-contents__link toc-highlight">strictStyleIsolation</a><ul><li><a href="#registermicroappsæ³¨å†Œå­åº”ç”¨" class="table-of-contents__link toc-highlight"><strong><strong>registerMicroAppsï¼šæ³¨å†Œå­åº”ç”¨</strong></strong></a></li><li><a href="#loadappåŠ è½½å­åº”ç”¨" class="table-of-contents__link toc-highlight">loadAppï¼šåŠ è½½å­åº”ç”¨</a></li><li><a href="#createelementæ·»åŠ shadow-dom" class="table-of-contents__link toc-highlight">createElementï¼šæ·»åŠ shadow dom</a></li></ul></li><li><a href="#experimentalstyleisolation" class="table-of-contents__link toc-highlight">experimentalStyleIsolation</a><ul><li><a href="#createelementç»™æœ€å¤–å±‚å¢åŠ data-qiankunå±æ€§å¹¶ä¸”è·å–æ‰€æœ‰styleæ ‡ç­¾" class="table-of-contents__link toc-highlight">createElementï¼šç»™æœ€å¤–å±‚å¢åŠ data-qiankunå±æ€§ï¼Œå¹¶ä¸”è·å–æ‰€æœ‰styleæ ‡ç­¾</a></li><li><a href="#cssprocessè¯¦ç»†å¤„ç†" class="table-of-contents__link toc-highlight">css.processè¯¦ç»†å¤„ç†</a></li><li><a href="#è¿›å…¥processorprocessçœ‹çœ‹å¯¹å®ƒè¿›è¡Œäº†ä»€ä¹ˆæ“ä½œ" class="table-of-contents__link toc-highlight">è¿›å…¥processor.processçœ‹çœ‹å¯¹å®ƒè¿›è¡Œäº†ä»€ä¹ˆæ“ä½œ</a></li><li><a href="#è®©æˆ‘ä»¬çœ‹çœ‹rewriteå…·ä½“è¿›è¡Œäº†ä»€ä¹ˆæ“ä½œè¿™é‡Œä¸»è¦åˆ†ä¸ºä¸¤å—" class="table-of-contents__link toc-highlight">è®©æˆ‘ä»¬çœ‹çœ‹rewriteå…·ä½“è¿›è¡Œäº†ä»€ä¹ˆæ“ä½œï¼Œè¿™é‡Œä¸»è¦åˆ†ä¸ºä¸¤å—ï¼š</a></li><li><a href="#åŠ¨æ€æ·»åŠ æ ·å¼çš„æ€è€ƒ" class="table-of-contents__link toc-highlight">åŠ¨æ€æ·»åŠ æ ·å¼çš„æ€è€ƒğŸ¤”</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/battleofplassey" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://instagram.com/battleofplassey" target="_blank" rel="noopener noreferrer" class="footer__link-item">Instagram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Navigation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/">Home</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/whoami">Stuff of Legend</a></li><li class="footer__item"><a href="https://github.com/battleofplassey" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">other Projects</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://sidtoons.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">SidToons.com<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://vocab.js.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">vocab.js.org<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://tldr.palashsh.me/" target="_blank" rel="noopener noreferrer" class="footer__link-item">TL;DR News<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/img/blogasaurus_secondary.svg" alt="Zaoei Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/blogasaurus_secondary.svg" alt="Zaoei Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></div><div class="footer__copyright">Copyright Â© 2024 Blogasaurus by Palash Shrivastava.</div></div></div></footer></div>
</body>
</html>