<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">渲染优化之CSS Containment.md | Zaoei Blog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" property="og:url" content="https://blog.palashsh.me/Containment_"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:image" content="https://avatars.githubusercontent.com/u/35087196?v=4"><meta data-rh="true" name="twitter:card" content="https://avatars.githubusercontent.com/u/35087196?v=4"><meta data-rh="true" name="twitter:image" content="https://avatars.githubusercontent.com/u/35087196?v=4"><meta data-rh="true" name="twitter:site" content="@battleofplassey"><meta data-rh="true" property="og:title" content="渲染优化之CSS Containment.md | Zaoei Blog"><meta data-rh="true" name="description" content="在开始介绍今天的主角 CSS Containment 之前，我们需要了解一些前置知识回流和重绘，方便我们理解以及应用的场景。"><meta data-rh="true" property="og:description" content="在开始介绍今天的主角 CSS Containment 之前，我们需要了解一些前置知识回流和重绘，方便我们理解以及应用的场景。"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2021-07-16T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/Zaoei"><meta data-rh="true" property="article:tag" content="css,optimize"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://blog.palashsh.me/Containment_"><link data-rh="true" rel="alternate" href="https://blog.palashsh.me/Containment_" hreflang="en"><link data-rh="true" rel="alternate" href="https://blog.palashsh.me/Containment_" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://2KDKKFPT4A-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Zaoei Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Zaoei Blog Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="Zaoei Blog JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R5V7R63B0J"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-R5V7R63B0J",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Zaoei Blog" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.316ffec0.css">
<link rel="preload" href="/assets/js/runtime~main.63300d93.js" as="script">
<link rel="preload" href="/assets/js/main.0e3e750a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">If you like what you see, follow me on <a href="https://twitter.com/intent/follow?screen_name=battleofplassey&amp;region=follow_link" class="twitter-follow-button"><div class="icon"></div>@battleofplassey</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Zaoei Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Zaoei Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" link="blog" href="/">Blog</a><a class="navbar__item navbar__link" link="doc" doclink="docs/webpack-resolve/README.md" href="/docs/webpack-resolve/">docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Zaoei" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" externallink="https://github.com/Zaoei" link="external" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All Blog Posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/tools-select-option">浏览器调试下拉option的方法</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/python environment">搭建 python 环境</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/resize">ResizeObserver</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/utils web">https://caniuse.com</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/Inspection Report">实现一个巡检报告</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/IntersectionObserver">Intersection Observer API</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/softwareDevelopmentSex">软件的拓展性</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/Authority design">关于ant design pro的权限方案设计</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/Containment_">渲染优化之CSS Containment.md</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/attributeFeature">属性特性</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">渲染优化之CSS Containment.md</h1><div class="container_mt6G margin-vert--md"><time datetime="2021-07-16T00:00:00.000Z" itemprop="datePublished">July 16, 2021</time> · <!-- -->15 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/Zaoei" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/46592356?v=4" alt="赵炜"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Zaoei" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">赵炜</span></a></div><small class="avatar__subtitle" itemprop="description">博客作者</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><h1>引言</h1><p>在开始介绍今天的主角 <em>CSS Containment</em> 之前，我们需要了解一些前置知识回流和重绘，方便我们理解以及应用的场景。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="简单回忆下回流和重绘">简单回忆下回流和重绘<a href="#简单回忆下回流和重绘" class="hash-link" aria-label="Direct link to 简单回忆下回流和重绘" title="Direct link to 简单回忆下回流和重绘">​</a></h2><ul><li>回流（Reflow）：当浏览器必须重新处理和绘制部分或全部页面时，回流就会发生，例如元素的规模尺寸，布局，隐藏等改变而需要重新构建。</li><li>重绘（Repaint）：当改变元素的部分属性而不影响布局时，重绘就会发生。例如改变元素的背景颜色、字体颜色等。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="回流会造成什么">回流会造成什么？<a href="#回流会造成什么" class="hash-link" aria-label="Direct link to 回流会造成什么？" title="Direct link to 回流会造成什么？">​</a></h2><blockquote><p>Reflows are very expensive in terms of performance, and is one of the main causes of slow DOM scripts, In many cases, they are equivalent to laying out the entire page again.</p></blockquote><p>通过翻译，我们可以知道，回流在性能方面消耗非常大，是很多 DOM 加载慢的原因之一。在许多情况下，它们相当于再次渲染整个页面。</p><p>接下来，来看看有哪些行为会触发回流/重绘。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="触发回流重绘">触发回流/重绘<a href="#触发回流重绘" class="hash-link" aria-label="Direct link to 触发回流/重绘" title="Direct link to 触发回流/重绘">​</a></h3><ul><li>添加，删除，更新 DOM 节点时会发生回流</li><li>设置元素的属性为<code>display:none</code> 时发生回流</li><li>设置元素的属性<code>visibility: hidden</code> 时发生重绘</li><li>DOM 节点上存在动画属性也将触发回流</li><li>调整窗口的大小将触发回流</li><li><code>font-style</code> 更改字体风格会改变元素的几何形状。 这意味着它可能会影响页面上其他元素的位置或大小,触发回流</li><li>添加或删除样式文件将导致回流/重绘</li><li>通过 JavaScript 获取元素的大小等，由于需要确保获取到的值为最新的，浏览器都会先执行一次回流来保证值的正确。例如 <em>offsetXXX</em>、<em>clientXXX</em> 和 <em>scrollXXX</em> 等</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="重绘回流优化方案">重绘回流优化方案<a href="#重绘回流优化方案" class="hash-link" aria-label="Direct link to 重绘回流优化方案" title="Direct link to 重绘回流优化方案">​</a></h3><p>知道了触发回流/重绘的原因，那么就能根据这些原因，制定相应的优化方案，如下。</p><ul><li>避免使用触发重绘回流的 CSS 属性。</li><li>尽量减少 JS 操作修改 DOM 的 CSS 次数。</li><li>将频繁重绘回流的 DOM 元素单独作为一个独立图层，那么这个 DOM 元素的重绘和回流影响只会在这个图层中。</li></ul><p>经过了优化后，回流和重绘的次数已经减少，但是不可避免的，由于各种原因，还是会产生回流和重绘。</p><p>试想一下，有一个比较复杂的页面，当用户移动鼠标到一个元素上，触发这个元素<code>hover</code>，这个<code>hover</code>的效果是使这个元素宽高发生改变（<code>width</code>、<code>height</code>），当元素的宽高发生改变时，浏览器需要考虑到所有元素，是否发生了相应的更改，所以浏览器需要对整个页面进行重新布局，而实际上改变的可能只有页面的一小部分，页面大部分内容是保持不变的。这对于性能来说，无疑是十分差的。</p><p>那么有没有一种办法，能够让浏览器进行局部的回流重绘，从而达到优化性能的目的呢？或者说，减少回流时产生的性能消耗。答案是有的，就是今天所要认识的 <em>CSS Containment</em></p><h1>CSS Containment</h1><blockquote><p>CSS Containment 主要是通过允许开发者将某些子树从页面中独立出来，从而提高页面的性能。如果浏览器知道页面中的某部分是独立的，就能够优化渲染并获得性能提升。</p></blockquote><p>由于有很多的交互或者复杂的情况，需要触发回流，重新渲染整个页面。为了改进这个，浏览器必须识别有哪些部分是独立的。当他们的子元素有变化时，浏览器的渲染引擎能够识别到，只对部分元素做回流重绘，而不对整个页面进行。</p><p>识别这个标准的属性就是 <code>contain</code> 。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="contain">contain<a href="#contain" class="hash-link" aria-label="Direct link to contain" title="Direct link to contain">​</a></h2><p>通过 <code>contain</code> 属性告诉浏览器，这些节点是独立的。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="语法">语法：<a href="#语法" class="hash-link" aria-label="Direct link to 语法：" title="Direct link to 语法：">​</a></h2><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">div </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">contain</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> none</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* 表示元素将正常渲染，没有包含规则 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">contain</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> layout</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* 表示元素外部无法影响元素内部的布局，反之亦然 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">contain</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> paint</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* 表示这个元素的子孙节点不会在它边缘外显示。如果一个元素在视窗外或因其他原因导致不可见，则同样保证它的子孙节点不会被显示。 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">contain</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> size</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* 表示这个元素的尺寸计算不依赖于它的子孙元素的尺寸 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">contain</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* 等价于 contain: layout paint */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">contain</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> strict</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* 等价于 contain: size layout paint */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><a href="https://codepen.io/zaoei/pen/MWyJrwN" target="_blank" rel="noopener noreferrer">一个例子</a></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="layout">Layout<a href="#layout" class="hash-link" aria-label="Direct link to Layout" title="Direct link to Layout">​</a></h3><blockquote><p>This value turns on layout containment for the element. This ensures that the containment box is totally opaque for layout purposes; nothing outside can affect its internal layout, and vice versa.</p></blockquote><p>设置了 <code>layout</code> 属性，就是告诉浏览器当前元素内部的样式变化不会引起元素外部的样式变化。并且，元素外部的样式变化也不会引起元素内部的样式变化。这样，浏览器就可以相应的减少渲染元素，提高渲染的性能。</p><p>如果设置了 <code>layout</code> 属性的元素，被遮挡，如屏幕外。则浏览器会把该元素相关的处理，放到较低的优先级中。</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">container</span><span class="token plain"> li </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">padding</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> 10px</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">height</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> 100px</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">contain</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> layout</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="8fcea485affb42fe9f173f2c26f07691_tplv-k3u1fbpfcp-watermark.gif" src="/assets/images/8fcea485affb42fe9f173f2c26f07691_tplv-k3u1fbpfcp-watermark-ee44f9037973043fe2d3a32a7016ad6d.gif" width="1740" height="1002" class="img_ev3q">
值得注意的是，由于元素内部的样式变化，导致了元素本身发生了大小等能触发回流的属性时，那么 <code>layout</code> 属性将不生效。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="paint">Paint<a href="#paint" class="hash-link" aria-label="Direct link to Paint" title="Direct link to Paint">​</a></h3><blockquote><p>This value turns on paint containment for the element. This ensures that the descendants of the containment box don’t display outside its bounds, so if an element is off-screen or otherwise not visible, its descendants are also guaranteed to be not visible.</p></blockquote><p>设置了 <code>paint</code> 属性，表示这个元素的子孙节点不会在它边缘外显示。如果一个元素在视窗外或因其他原因导致不可见，则同样它的子孙节点不会被显示。</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">container</span><span class="token plain"> li </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">padding</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> 10px</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">height</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> 100px</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">contain</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> paint</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="51d4f10219664196bc024dc1d77267ea_tplv-k3u1fbpfcp-watermark.gif" src="/assets/images/51d4f10219664196bc024dc1d77267ea_tplv-k3u1fbpfcp-watermark-2ba179883ee92d97d12dcbc15ab87c57.gif" width="1740" height="1002" class="img_ev3q"></p><p>对于子元素，部分内容超出边界，那么该部分内容也不会被渲染。</p><p>从效果上来看，这有点类似于 <code>overflow：hidden</code>，不同的是 <code>overflow：hidden</code>，是通过将超出部分进行裁剪的方式。</p><p>举个例子，对于有滚动条的元素，由于滚动，会触发多次渲染，这些渲染的元素，包含当前可视区外的元素，造成了性能浪费。而使用 <code>paint</code> 就可以忽略这些可视区外元素的渲染，从而达到优化渲染性能。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="size">Size<a href="#size" class="hash-link" aria-label="Direct link to Size" title="Direct link to Size">​</a></h3><blockquote><p>The value turns on size containment for the element. This ensures that the containment box can be laid out without needing to examine its descendants.</p></blockquote><p>设置了 <code>size</code> 属性的元素，表示这个元素的尺寸计算不依赖于它的子孙元素的尺寸。</p><p>对于浏览器来说，设置 <code>size</code> 就是告诉浏览器，这个元素的大小已经固定了，就是这么大，不需要再通过重排子元素来获取当前元素的大小。</p><p>设置了 size 属性的元素，不管子元素是怎么布局，什么样式，都不会影响到父元素。</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">container</span><span class="token plain"> li </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">padding</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> 10px</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">height</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> 100px</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">contain</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> size</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="0924d1088eb14169aad0ff98385f8d61_tplv-k3u1fbpfcp-watermark.gif" src="/assets/images/0924d1088eb14169aad0ff98385f8d61_tplv-k3u1fbpfcp-watermark-beaca27992211713e57358af51c9204f.gif" width="1740" height="1002" class="img_ev3q"></p><p>使用这个 size 属性，会改变渲染的根结点，从而达到优化的目的</p><p>使用前：</p><p><img loading="lazy" alt="72a3802ea8974ff38015b8ebddca20e2_tplv-k3u1fbpfcp-watermark.png" src="/assets/images/72a3802ea8974ff38015b8ebddca20e2_tplv-k3u1fbpfcp-watermark-9ffcb2a873ef70a5b3072991750e5957.png" width="362" height="284" class="img_ev3q"></p><p>使用后：</p><p><img loading="lazy" alt="80e954e5633a48819801688899a3557a_tplv-k3u1fbpfcp-watermark.png" src="/assets/images/80e954e5633a48819801688899a3557a_tplv-k3u1fbpfcp-watermark-92740c7f91aecd2052314f137992fd3b.png" width="592" height="278" class="img_ev3q"></p><p>可以看到，<em>layout root</em> 是完全不同的，前者基于 <em>document</em> 整个页面，而后者是基于当前的 <em>contain</em> 容器元素。</p><p>在日常使用中，我们可以对一些容器元素使用，避免因为容器内部的布局改变，而导致整个页面的回流。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="content--strict">content &amp;&amp; strict<a href="#content--strict" class="hash-link" aria-label="Direct link to content &amp;&amp; strict" title="Direct link to content &amp;&amp; strict">​</a></h3><blockquote><p>contain：content； // 表示这个元素上有除了 size 和 style 外的所有包含规则。等价于 contain: layout paint。</p></blockquote><blockquote><p>contain：strict； // 表示除了 style 外的所有的包含规则应用于这个元素。等价于 contain: size layout paint。</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="布局">布局<a href="#布局" class="hash-link" aria-label="Direct link to 布局" title="Direct link to 布局">​</a></h2><p>不知道大家是否注意到，设置了<code>contain</code>的元素，只有在明确了<code>width</code>, <code>height</code>的情况下，才会产生效果，否则就跟正常元素一样。</p><p>真的没有其他任何变化么？其实不是的。</p><p>只要设置了<code>contain</code>的元素，就类似于使用 <code>position：relative</code> 布局，不同的是，<code>z-index</code>，以及<code>top</code>、<code>left</code>等改变位置的属性对其自身是无效。</p><p>对于设置<code>contain: layout</code>，通过观察可以看到，观感上它与 <code>position：relative</code> 并无区别，都是在正常文档流中占据位置，且子元素浮于正常文档流之上。</p><p><img loading="lazy" alt="cfcbe61cf942471aa2efc4d5ef456caf_tplv-k3u1fbpfcp-watermark.png" src="/assets/images/cfcbe61cf942471aa2efc4d5ef456caf_tplv-k3u1fbpfcp-watermark-63676f9bb2e972a617e8b3d6d437b124.png" width="920" height="738" class="img_ev3q"></p><p>但是，对于设置<code>contain: size</code>的元素，通过观察可以看到，它也是在正常文档流中占据位置，不同的是，子元素浮于正常文档流之下，这就可以说明，只要设置了<code>contain: size</code>，它的层级是低于正常文档流的。</p><p><img loading="lazy" alt="0c67a7b87772410ab632ca14e3ff0dd7_tplv-k3u1fbpfcp-watermark.png" src="/assets/images/0c67a7b87772410ab632ca14e3ff0dd7_tplv-k3u1fbpfcp-watermark-afc1e6ad4dc5c0ba771ca3f424db588d.png" width="1116" height="760" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="example">example<a href="#example" class="hash-link" aria-label="Direct link to example" title="Direct link to example">​</a></h2><p>为了更直观的看出 contain 的效果，先附上 <a href="https://blogs.igalia.com/mrego/files/2019/01/css-contain-example.html" target="_blank" rel="noopener noreferrer">Manuel Rego Casasnovas</a> 写的例子。</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">performance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 返回一个表示从性能测量时刻开始经过的毫秒数</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过<code>[window.performance.now()](https://developer.mozilla.org/zh-CN/docs/Web/API/Performance/now)</code>记录回流的开始时间，在回流结束后再通过<code>[window.performance.now()](https://developer.mozilla.org/zh-CN/docs/Web/API/Performance/now)</code>记录一次结束时间，用得到的开始时间和结束时间相减，就得到了一次完整回流所经历的时间。</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">runTests</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">setup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 创建 1000 个节点</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> avg1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">changeTargetContent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 没有设置contain，触发回流</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> targetItem </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;targetItem&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  targetItem</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">contain</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;strict&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> avg2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">changeTargetContent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 触发回流</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">changeTargetContent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Force layout.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">offsetLeft</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> start </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">performance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> targetInner </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;targetInner&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  targetInner</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">textContent</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> targetInner</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">textContent</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Hello World!&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;BYE&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Hello World!&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Force layout.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">offsetLeft</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> end </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">performance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> end </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> start</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="06f9f39a3c57410f91a45facd5d1fd11_tplv-k3u1fbpfcp-watermark.png" src="/assets/images/06f9f39a3c57410f91a45facd5d1fd11_tplv-k3u1fbpfcp-watermark-3e8d3cd3cdf13ff345322f961f2ef5a1.png" width="1500" height="934" class="img_ev3q"></p><p>通过对比<code>cantain: strict</code>设置前和设置后，可以看到性能的优化达到了 80%左右。</p><p>在实际项目里下，使用<code>cantain: strict</code>属性后的效果。
截图场景，点击了 2 次按钮，完整触发了一个模块的打开关闭，前者为使用前，后者为使用后的的实际渲染效果。</p><p>使用前：
<img loading="lazy" alt="b8573215f2e94537b35d76070c2551fd_tplv-k3u1fbpfcp-watermark.png" src="/assets/images/b8573215f2e94537b35d76070c2551fd_tplv-k3u1fbpfcp-watermark-af7b3f189a697859eedfd3509aea7ef7.png" width="1500" height="575" class="img_ev3q"></p><p>使用后：
<img loading="lazy" alt="22847cd41ac042a5ae8f8a562543d8a2_tplv-k3u1fbpfcp-watermark.png" src="/assets/images/22847cd41ac042a5ae8f8a562543d8a2_tplv-k3u1fbpfcp-watermark-9ddf421ded1e7d2b719d578caee82bc3.png" width="1500" height="586" class="img_ev3q"></p><p>通过比较，可以看出使用 <code>cantain: strict</code> 后，rendering 时长从 1750ms 降至 558ms，优化了 60%左右。而 painting 时长从 230ms 降至 35ms，优化了 75%的左右。</p><p>rendering 和 Painting 的占用时间，都有非常明显的减少。使用后对渲染性能的优化还是非常明显的。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="兼容性">兼容性<a href="#兼容性" class="hash-link" aria-label="Direct link to 兼容性" title="Direct link to 兼容性">​</a></h2><p><img loading="lazy" alt="79f1995d73f94a0d8a727b2ec70160f9_tplv-k3u1fbpfcp-watermark.png" src="/assets/images/79f1995d73f94a0d8a727b2ec70160f9_tplv-k3u1fbpfcp-watermark-b824859a1560102c1b02554e7518852e.png" width="1500" height="454" class="img_ev3q"></p><h1>写在最后</h1><p>在本次的学习中，其实还有一些值得探究或者比较遗憾的地方：</p><ul><li><code>contain</code>在优化页面渲染性能的情况下，是否给浏览器带来了其他负担？个人猜测是通过空间换时间的方式。</li><li>设计的 demo 的实际效果跟理想中的效果，并不一致，不免有些遗憾。如对于 <code>contain：paint</code> 来说，在屏幕外添加子节点，触发回流重绘，根据<code>contain：paint</code>属性在屏幕外，不绘制元素的特性，重绘的时间应该是非常小，或者将近 0ms 的，然而在实际中并没有达到这个效果。</li></ul><p>如果文章中出现错误，或者有更好的验证 demo，欢迎留言交流哈 😊。</p><h1>参考文献</h1><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Containment" target="_blank" rel="noopener noreferrer">CSS Containment</a></li><li><a href="https://developers.google.com/web/updates/2016/06/css-containment" target="_blank" rel="noopener noreferrer">CSS Containment in Chrome 52</a></li><li><a href="https://css-tricks.com/almanac/properties/c/contain/" target="_blank" rel="noopener noreferrer">CSS-Tricks</a></li><li><a href="https://caniuse.com/?search=contain" target="_blank" rel="noopener noreferrer">caniuse</a></li><li><a href="https://blogs.igalia.com/mrego/2019/01/11/an-introduction-to-css-containment/" target="_blank" rel="noopener noreferrer">An introduction to CSS Containment</a></li><li><a href="https://www.w3.org/TR/css-contain-1/" target="_blank" rel="noopener noreferrer">CSS Containment Module Level 1</a></li><li><a href="https://www.w3.org/TR/css-contain-2/" target="_blank" rel="noopener noreferrer">CSS Containment Module Level 2</a></li></ul></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/css">css</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/optimize">optimize</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/Authority design"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">关于ant design pro的权限方案设计</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/attributeFeature"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">属性特性</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#简单回忆下回流和重绘" class="table-of-contents__link toc-highlight">简单回忆下回流和重绘</a></li><li><a href="#回流会造成什么" class="table-of-contents__link toc-highlight">回流会造成什么？</a><ul><li><a href="#触发回流重绘" class="table-of-contents__link toc-highlight">触发回流/重绘</a></li><li><a href="#重绘回流优化方案" class="table-of-contents__link toc-highlight">重绘回流优化方案</a></li></ul></li><li><a href="#contain" class="table-of-contents__link toc-highlight">contain</a></li><li><a href="#语法" class="table-of-contents__link toc-highlight">语法：</a><ul><li><a href="#layout" class="table-of-contents__link toc-highlight">Layout</a></li><li><a href="#paint" class="table-of-contents__link toc-highlight">Paint</a></li><li><a href="#size" class="table-of-contents__link toc-highlight">Size</a></li><li><a href="#content--strict" class="table-of-contents__link toc-highlight">content &amp;&amp; strict</a></li></ul></li><li><a href="#布局" class="table-of-contents__link toc-highlight">布局</a></li><li><a href="#example" class="table-of-contents__link toc-highlight">example</a></li><li><a href="#兼容性" class="table-of-contents__link toc-highlight">兼容性</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/battleofplassey" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://instagram.com/battleofplassey" target="_blank" rel="noopener noreferrer" class="footer__link-item">Instagram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Navigation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/">Home</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/whoami">Stuff of Legend</a></li><li class="footer__item"><a href="https://github.com/battleofplassey" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">other Projects</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://sidtoons.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">SidToons.com<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://vocab.js.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">vocab.js.org<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://tldr.palashsh.me/" target="_blank" rel="noopener noreferrer" class="footer__link-item">TL;DR News<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/img/blogasaurus_secondary.svg" alt="Zaoei Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/img/blogasaurus_secondary.svg" alt="Zaoei Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></div><div class="footer__copyright">Copyright © 2024 Blogasaurus by Palash Shrivastava.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.63300d93.js"></script>
<script src="/assets/js/main.0e3e750a.js"></script>
</body>
</html>