"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[5124],{3905:(e,t,r)=>{r.d(t,{Zo:()=>m,kt:()=>d});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},l=Object.keys(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var o=n.createContext({}),c=function(e){var t=n.useContext(o),r=t;return e&&(r="function"==typeof e?e(t):p(p({},t),e)),r},m=function(e){var t=c(e.components);return n.createElement(o.Provider,{value:t},e.children)},k="mdxType",s={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,l=e.originalType,o=e.parentName,m=i(e,["components","mdxType","originalType","parentName"]),k=c(r),u=a,d=k["".concat(o,".").concat(u)]||k[u]||s[u]||l;return r?n.createElement(d,p(p({ref:t},m),{},{components:r})):n.createElement(d,p({ref:t},m))}));function d(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=r.length,p=new Array(l);p[0]=u;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i[k]="string"==typeof e?e:a,p[1]=i;for(var c=2;c<l;c++)p[c]=r[c];return n.createElement.apply(null,p)}return n.createElement.apply(null,r)}u.displayName="MDXCreateElement"},2810:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>o,contentTitle:()=>p,default:()=>s,frontMatter:()=>l,metadata:()=>i,toc:()=>c});var n=r(7462),a=(r(7294),r(3905));const l={},p="\u6a21\u5757\u70ed\u66ff\u6362",i={unversionedId:"webpack-resolve/hmr",id:"webpack-resolve/hmr",title:"\u6a21\u5757\u70ed\u66ff\u6362",description:"\u4ec0\u4e48\u662f\u70ed\u6a21\u5757\u66ff\u6362",source:"@site/docs/webpack-resolve/hmr.md",sourceDirName:"webpack-resolve",slug:"/webpack-resolve/hmr",permalink:"/docs/webpack-resolve/hmr",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Watch",permalink:"/docs/webpack-resolve/hmr-watch"},next:{title:"initCompiler",permalink:"/docs/webpack-resolve/initCompiler"}},o={},c=[{value:"\u4ec0\u4e48\u662f\u70ed\u6a21\u5757\u66ff\u6362",id:"\u4ec0\u4e48\u662f\u70ed\u6a21\u5757\u66ff\u6362",level:2},{value:"\u6709\u4ec0\u4e48\u597d\u5904\uff1f",id:"\u6709\u4ec0\u4e48\u597d\u5904",level:2},{value:"\u6a21\u5757\u529f\u80fd\u4ecb\u7ecd",id:"\u6a21\u5757\u529f\u80fd\u4ecb\u7ecd",level:2},{value:"\u6267\u884c\u8fc7\u7a0b",id:"\u6267\u884c\u8fc7\u7a0b",level:2}],m={toc:c},k="wrapper";function s(e){let{components:t,...l}=e;return(0,a.kt)(k,(0,n.Z)({},m,l,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"\u6a21\u5757\u70ed\u66ff\u6362"},"\u6a21\u5757\u70ed\u66ff\u6362"),(0,a.kt)("h2",{id:"\u4ec0\u4e48\u662f\u70ed\u6a21\u5757\u66ff\u6362"},"\u4ec0\u4e48\u662f\u70ed\u6a21\u5757\u66ff\u6362"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u6a21\u5757\u70ed\u66ff\u6362(HMR - Hot Module Replacement)\u529f\u80fd\u4f1a\u5728\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u66ff\u6362\u3001\u6dfb\u52a0\u6216\u5220\u9664\u6a21\u5757 \uff0c\u800c\u65e0\u9700\u91cd\u65b0\u52a0\u8f7d\u6574\u4e2a\u9875\u9762\u3002")),(0,a.kt)("h2",{id:"\u6709\u4ec0\u4e48\u597d\u5904"},"\u6709\u4ec0\u4e48\u597d\u5904\uff1f"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4fdd\u7559\u5728\u5b8c\u5168\u91cd\u65b0\u52a0\u8f7d\u9875\u9762\u65f6\u4e22\u5931\u7684\u5e94\u7528\u7a0b\u5e8f\u72b6\u6001\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u53ea\u66f4\u65b0\u53d8\u66f4\u5185\u5bb9\uff0c\u4ee5\u8282\u7701\u5b9d\u8d35\u7684\u5f00\u53d1\u65f6\u95f4\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u8c03\u6574\u6837\u5f0f\u66f4\u52a0\u5feb\u901f - \u51e0\u4e4e\u76f8\u5f53\u4e8e\u5728\u6d4f\u89c8\u5668\u8c03\u8bd5\u5668\u4e2d\u66f4\u6539\u6837\u5f0f\u3002")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://zhuanlan.zhihu.com/p/30669007"},"Webpack HMR \u539f\u7406\u89e3\u6790 - \u77e5\u4e4e")),(0,a.kt)("h2",{id:"\u6a21\u5757\u529f\u80fd\u4ecb\u7ecd"},"\u6a21\u5757\u529f\u80fd\u4ecb\u7ecd"),(0,a.kt)("p",null,"webpack-dev-server: "),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u5f00\u542f webpack server \u670d\u52a1\u7684\uff0c\u5efa\u7acb socket \u94fe\u63a5\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u6a21\u5757\u7f16\u8bd1\u540e\u53d1\u9001 hash \u7b49\u4fe1\u606f\u7ed9\u524d\u7aef"),(0,a.kt)("li",{parentName:"ul"},"\u4e3a\u6d4f\u89c8\u5668\u6ce8\u518c\u4e00\u4e2a ",(0,a.kt)("strong",{parentName:"li"},"webpack_dev_server_client")," \u5bf9\u8c61\uff0cclient \u901a\u8fc7\u8fd9\u4e2a\u5168\u5c40\u5bf9\u8c61\uff0c\u80fd\u591f\u521b\u5efa\u4e00\u4e2a socket \u670d\u52a1\uff0c\u5176\u4e2d\u5305\u542b\u8fde\u63a5\u670d\u52a1\u7684\u4fe1\u606f\uff0c\u4e0d\u9700\u8981 client \u53bb\u8003\u8651\uff0c client \u53ea\u9700\u8981\u5173\u5fc3\u6d88\u606f\u7684\u76d1\u542c"),(0,a.kt)("li",{parentName:"ul"},"\u524d\u7aef\u5165\u53e3\u6587\u4ef6\u65b0\u589e dev-server\u3001client \u6a21\u5757")),(0,a.kt)("p",null,"HotModuleReplacementPlugin"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u5f00\u542f hot\uff0c\u7ed9 bundle \u6ce8\u5165 hot \u76f8\u5173 runtime \u4ee3\u7801\uff0c\u5982 module.hot.accpet \u7b49")),(0,a.kt)("p",null,"webpack-dev-middleware: "),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u6267\u884c webpack watch"),(0,a.kt)("li",{parentName:"ul"},"\u4fee\u6539\u8d44\u6e90\u5b58\u50a8\uff0c\u7531\u78c1\u76d8\u6539\u4e3a\u5185\u5b58\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u670d\u52a1\u4e2d\u95f4\u4ef6\uff0c\u4e3a\u8bf7\u6c42\u589e\u52a0\u62e6\u622a\uff0c\u5ef6\u8fdf\u8fd4\u56de\u54cd\u5e94\u3002\u6a21\u5757\u7f16\u8bd1\u5b8c\u6210\u540e\u5728\u8fdb\u884c\u54cd\u5e94\uff0c")),(0,a.kt)("p",null,"dev-server"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u6a21\u5757\u7684\u53d8\u66f4\u6821\u9a8c\uff0c\u89e6\u53d1 .hot-update.json\uff0c.hot-update.js\u3002\u3002\u3002\u3002")),(0,a.kt)("p",null,"client"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u65b0\u5efa socket \u5efa\u7acb\u4e0e\u670d\u52a1\u5668\u7684\u8fde\u63a5")),(0,a.kt)("h2",{id:"\u6267\u884c\u8fc7\u7a0b"},"\u6267\u884c\u8fc7\u7a0b"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u542f\u52a8 webpack-dev-server")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u5728 webpack \u4e2d\u5224\u65ad\u662f\u5426\u6709\u5b89\u88c5 webpack-dev-server \u8fd9\u4e2a\u5305\uff0c\u4e14\u7248\u672c\u4e3a v4 \u4ee5\u4e0a\u3002")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u67e5\u627e cli \u547d\u4ee4\u4e2d\u7684\u53c2\u6570\uff0c\u4e0e webpack.config.js \u4e2d devServer \u914d\u7f6e\u8fdb\u884c\u5408\u5e76\uff0c\u5f97\u5230\u6700\u7ec8\u7684\u914d\u7f6e\u7ed3\u6784 devServerOptions\u3002")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u5982\u679c webpack-dev-server \u4e0d\u662f v4 \u7248\u672c\u4e0a\uff0c\u505a\u517c\u5bb9\u5904\u7406")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u5224\u65ad port \u7aef\u53e3\u662f\u5426\u88ab\u7528\u8fc7")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u521b\u5efa\u5f00\u53d1\u73af\u5883\u7684\u670d\u52a1\u3002\u6267\u884c webpack-dev-server\uff0c\u628a compiler \u7f13\u5b58\u5728 this.compiler \u4e0a\uff0c\u6267\u884c start \u65b9\u6cd5\u5f00\u59cb\u542f\u52a8\u670d\u52a1\u3002"),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u8fdb\u884c\u4e00\u5927\u5806\u7684\u53c2\u6570\u5904\u7406\uff0c\u6267\u884c initialize \u65b9\u6cd5\uff0c\u5728\u5176\u4e2d\uff0c\u4fee\u6539 enrty \u7684\u5185\u5bb9\uff0c\u589e\u52a0\u4e24\u4e2a\u5165\u53e3\u5185\u5bb9 ",(0,a.kt)("inlineCode",{parentName:"p"},"\u201d../client/index.js\u201d"),"\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"webpack/hot/dev-server"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u628a\u5ba2\u6237\u7aef\u7684\u6240\u9700\u8981\u7684\u4ee3\u7801\uff0c\u901a\u8fc7\u63d2\u4ef6\uff0c\u547d\u540d\u6210 ",(0,a.kt)("inlineCode",{parentName:"p"},"__webpack_dev_server_client__"),"\u3002\u540e\u9762\u7528\u5230\uff0c\u5176\u5b9e\u5c31\u662f\u6211\u4eec\u7684 secket.js \u6587\u4ef6\u3002")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u5206\u522b\u5728 compiler \u5bf9\u8c61\u4e0a\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"invalid")," \u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"done"),"\u6dfb\u52a0\u94a9\u5b50\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"done"),"\u94a9\u5b50\u76d1\u542c\u6a21\u5757\u7f16\u8bd1\u5b8c\u6210\uff0c\u53d1\u9001\u4fe1\u606f\u7ed9\u670d\u52a1\u7aef\uff0c\u670d\u52a1\u7aef\u5728\u628a\u6539\u53d8\u7684 hash \u503c\u53d1\u7ed9\u5ba2\u6237\u7aef\u3002")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u52a0\u8f7d express")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u4e3a\u6240\u6709\u8bf7\u6c42\u6dfb\u52a0\u8bf7\u6c42\u5934 host \u6821\u9a8c")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u52a0\u8f7d webpack-dev-middleware\uff0c\u5e76\u6267\u884c\u3002"),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"\u8bbe\u7f6e ",(0,a.kt)("inlineCode",{parentName:"li"},"done"),"\uff0c\u5728\u7f16\u8bd1\u5b8c\u6210\u4e4b\u540e\uff0c\u904d\u5386\u6267\u884c\u56de\u8c03\u4e8b\u4ef6"),(0,a.kt)("li",{parentName:"ol"},"\u4f7f\u7528 memfs \u5de5\u5177\u5305\uff0c\u91cd\u5199\u4e86 ",(0,a.kt)("inlineCode",{parentName:"li"},"compiler.outputFileSystem")," \u65b9\u6cd5\uff0c\u628a\u8f93\u51fa\u5185\u5bb9\u6253\u5305\u5230\u5185\u5b58\u4e2d\uff0c\u4ece\u5185\u5b58\u4e2d\u53d6\u6bd4\u8f83\u5feb\u3002"),(0,a.kt)("li",{parentName:"ol"},"\u6267\u884c ",(0,a.kt)("inlineCode",{parentName:"li"},"compiler.watch(watchOptions, errorHandler);"),"\u7f16\u8bd1\u6a21\u5757\u5e76\u76d1\u542c\u6587\u4ef6\u3002"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u901a\u8fc7 http \u6a21\u5757\uff0c\u521b\u5efa server\uff0c\u5e76\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"request"),"\u76d1\u542c ",(0,a.kt)("inlineCode",{parentName:"p"},"connection")," \u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"error"),"\u4e8b\u4ef6\u3002",(0,a.kt)("inlineCode",{parentName:"p"},"connection"),"\u4e2d\u4f1a\u6ce8\u518c ",(0,a.kt)("inlineCode",{parentName:"p"},"socket"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u8bbe\u7f6e this.listeners\uff0c \u7528\u4e8e stop \u540e\u5173\u95ed\u5bf9\u5e94 server\u3002")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u901a\u8fc7\u914d\u7f6e\u9879 host \u548c port \u542f\u52a8 server\uff0c\u5f00\u53d1\u73af\u5883\u7684\u670d\u52a1\u5c31\u542f\u52a8\u597d\u4e86")))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u63a5\u4e0b\u6765\u8fdb\u884c webpack \u548c\u670d\u52a1\u7aef\u7684\u901a\u4fe1\u8fc7\u7a0b\u3002"),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"\u6267\u884c ",(0,a.kt)("inlineCode",{parentName:"li"},"this.createWebSocketServer")," \u65b9\u6cd5\uff0c\u83b7\u53d6\u670d\u52a1\u5668\u4f20\u8f93\u6a21\u5757 ",(0,a.kt)("inlineCode",{parentName:"li"},"return implementation = require(\u201c./servers/SockJSServer\u201d);"),"\uff0c\u5e76\u6267\u884c\u751f\u6210\u4e00\u4e2a ",(0,a.kt)("inlineCode",{parentName:"li"},"WebsocketServer"),"\u5bf9\u8c61\uff0c\u5b58\u5728 ",(0,a.kt)("inlineCode",{parentName:"li"},"this.webSocketServer"),"\u4e2d"),(0,a.kt)("li",{parentName:"ol"},"\u901a\u8fc7 ",(0,a.kt)("inlineCode",{parentName:"li"},"ws"),"\u6a21\u5757\u751f\u6210\u4e00\u4e2a WebSocket.Server \u5bf9\u8c61\u3002\u6ce8\u518c\u5bf9\u5e94\u7684 connection \u548c errer \u4e8b\u4ef6"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u6267\u884c ",(0,a.kt)("inlineCode",{parentName:"p"},"this.openBrowser"),"\u6253\u5f00\u6d4f\u89c8\u5668\u9875\u9762"))),(0,a.kt)("p",null,(0,a.kt)("img",{src:r(7313).Z,width:"1581",height:"2521"})),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/webpack/webpack-dev-middleware"},"webpack-dev-middleware")),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u4f7f\u7528 memfs \u5de5\u5177\u5305\uff0c\u91cd\u5199\u4e86 ",(0,a.kt)("inlineCode",{parentName:"li"},"compiler.outputFileSystem")," \u65b9\u6cd5\uff0c\u628a\u8f93\u51fa\u5185\u5bb9\u6253\u5305\u5230\u5185\u5b58\u4e2d\uff0c\u4ece\u5185\u5b58\u4e2d\u53d6\u6bd4\u8f83\u5feb\u3002 ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/webpack/webpack-dev-middleware/blob/master/src/utils/setupOutputFileSystem.js"},"webpack-dev-middleware/setupOutputFileSystem.js at master \xb7 webpack/webpack-dev-middleware \xb7 GitHub"),(0,a.kt)("inlineCode",{parentName:"li"}," outputFileSystem = memfs.createFsFromVolume(new memfs.Volume());")),(0,a.kt)("li",{parentName:"ol"},"\u5728 watch \u6a21\u5f0f\u4e0b\uff0c\u7b49\u5f85\u6a21\u5757\u7f16\u8bd1\u5b8c\u6210\uff0c\u5728\u53d1\u751f\u8bf7\u6c42\u3002"),(0,a.kt)("li",{parentName:"ol"},"\u652f\u6301\u6a21\u5757\u70ed\u66ff\u6362")),(0,a.kt)("p",null,"\u589e\u52a0 \u5165\u53e3\u6587\u4ef6\u7247\u6bb5\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"for (const additionalEntry of additionalEntries) {\n        new webpack.EntryPlugin(compiler.context, additionalEntry, {\n          // eslint-disable-next-line no-undefined\n          name: undefined,\n        }).apply(compiler);\n      }\n")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://webpack.docschina.org/configuration/dev-server/#websockettransport"},"https://webpack.docschina.org/configuration/dev-server/#websockettransport"),"\n",(0,a.kt)("a",{parentName:"p",href:"https://webpack.js.org/api/webpack-dev-server/"},"webpack-dev-server API | webpack"),"\n",(0,a.kt)("a",{parentName:"p",href:"https://www.webpackjs.com/api/hot-module-replacement/"},"\u6a21\u5757\u70ed\u66ff\u6362(hot module replacement) | webpack \u4e2d\u6587\u7f51")))}s.isMDXComponent=!0},7313:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/webpack-dev-server-c42ed805e15ba3411fc5ebbff91248b5.png"}}]);