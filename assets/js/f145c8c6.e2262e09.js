"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1711],{2418:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>c,toc:()=>a});var s=t(4848),r=t(5680);const i={},o="tree-shaking",c={id:"webpack-optimize/tree shaking/README",title:"tree-shaking",description:"tree-shaking \u6700\u65e9\u7531 Rich Harris \u5728 rollup \u4e2d\u63d0\u51fa\u3002",source:"@site/docs/webpack-optimize/tree shaking/README.md",sourceDirName:"webpack-optimize/tree shaking",slug:"/webpack-optimize/tree shaking/",permalink:"/docs/webpack-optimize/tree shaking/",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"resolve",permalink:"/docs/webpack-optimize/resolve/"},next:{title:"webpack tree shaking",permalink:"/docs/webpack-optimize/tree shaking/webpack tree shaking"}},d={},a=[{value:"tree-shaking VS dead code elimination",id:"tree-shaking-vs-dead-code-elimination",level:2},{value:"dead code",id:"dead-code",level:3},{value:"tree shaking \u65e0\u6548\uff1f",id:"tree-shaking-\u65e0\u6548",level:3},{value:"tree shaking \u548c sideEffects",id:"tree-shaking-\u548c-sideeffects",level:4},{value:"usedExports",id:"usedexports",level:4},{value:"tree shaking \u5b9e\u73b0\u539f\u7406",id:"tree-shaking-\u5b9e\u73b0\u539f\u7406",level:2},{value:"rollup",id:"rollup",level:3},{value:"webpack",id:"webpack",level:3},{value:"\u6536\u96c6\u6a21\u5757\u5bfc\u51fa",id:"\u6536\u96c6\u6a21\u5757\u5bfc\u51fa",level:4},{value:"\u6807\u8bb0\u6a21\u5757\u5bfc\u51fa",id:"\u6807\u8bb0\u6a21\u5757\u5bfc\u51fa",level:4},{value:"\u751f\u6210\u4ee3\u7801",id:"\u751f\u6210\u4ee3\u7801",level:4},{value:"\u5220\u9664 Dead Code",id:"\u5220\u9664-dead-code",level:4},{value:"\u53c2\u8003\u8d44\u6599",id:"\u53c2\u8003\u8d44\u6599",level:2}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.RP)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"tree-shaking",children:"tree-shaking"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"tree-shaking"})," \u6700\u65e9\u7531 ",(0,s.jsx)(n.a,{href:"https://github.com/Rich-Harris",children:"Rich Harris"})," \u5728 ",(0,s.jsx)(n.code,{children:"rollup"})," \u4e2d\u63d0\u51fa\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u4e3a\u4e86\u51cf\u5c11\u6700\u7ec8\u6784\u5efa\u4f53\u79ef\u800c\u8bde\u751f\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u4ee5\u4e0b\u662f ",(0,s.jsx)(n.a,{href:"https://developer.mozilla.org/zh-CN/docs/Glossary/Tree_shaking",children:"MDN"})," \u4e2d\u7684\u8bf4\u660e\uff1a"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"tree-shaking \u662f\u4e00\u4e2a\u901a\u5e38\u7528\u4e8e\u63cf\u8ff0\u79fb\u9664 JavaScript \u4e0a\u4e0b\u6587\u4e2d\u7684\u672a\u5f15\u7528\u4ee3\u7801(dead-code) \u884c\u4e3a\u7684\u672f\u8bed\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u5b83\u4f9d\u8d56\u4e8e ES2015 \u4e2d\u7684 import \u548c export \u8bed\u53e5\uff0c\u7528\u6765\u68c0\u6d4b\u4ee3\u7801\u6a21\u5757\u662f\u5426\u88ab\u5bfc\u51fa\u3001\u5bfc\u5165\uff0c\u4e14\u88ab JavaScript \u6587\u4ef6\u4f7f\u7528\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u73b0\u4ee3 JavaScript \u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u6a21\u5757\u6253\u5305(\u5982 webpack \u6216 Rollup)\u5c06\u591a\u4e2a JavaScript \u6587\u4ef6\u6253\u5305\u4e3a\u5355\u4e2a\u6587\u4ef6\u65f6\u81ea\u52a8\u5220\u9664\u672a\u5f15\u7528\u7684\u4ee3\u7801\u3002\u8fd9\u5bf9\u4e8e\u51c6\u5907\u9884\u5907\u53d1\u5e03\u4ee3\u7801\u7684\u5de5\u4f5c\u975e\u5e38\u91cd\u8981\uff0c\u8fd9\u6837\u53ef\u4ee5\u4f7f\u6700\u7ec8\u6587\u4ef6\u5177\u6709\u7b80\u6d01\u7684\u7ed3\u6784\u548c\u6700\u5c0f\u5316\u5927\u5c0f\u3002"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"tree-shaking-vs-dead-code-elimination",children:"tree-shaking VS dead code elimination"}),"\n",(0,s.jsxs)(n.p,{children:["\u8bf4\u8d77 ",(0,s.jsx)(n.code,{children:"tree-shaking"})," \u4e0d\u5f97\u4e0d\u8bf4\u8d77 ",(0,s.jsx)(n.code,{children:"dead code elimination"}),"\uff0c\u7b80\u79f0 ",(0,s.jsx)(n.code,{children:"DCE"}),"\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5f88\u591a\u4eba\u5f80\u5f80\u628a ",(0,s.jsx)(n.code,{children:"tree-shaking"})," \u5f53\u4f5c\u662f\u4e00\u79cd\u5b9e\u73b0 ",(0,s.jsx)(n.code,{children:"DCE"})," \u7684\u6280\u672f\u3002\u5982\u679c\u90fd\u662f\u540c\u4e00\u79cd\u4e1c\u897f\uff0c\u6700\u7ec8\u7684\u76ee\u6807\u662f\u4e00\u81f4\u7684\uff08\u66f4\u5c11\u7684\u4ee3\u7801\uff09\u3002\u4e3a\u4ec0\u4e48\u8981\u91cd\u65b0\u8d77\u4e00\u4e2a\u540d\u5b57\u53eb\u505a ",(0,s.jsx)(n.code,{children:"tree-shaking"})," \u5462\uff1f"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"tree-shaking"})," \u672f\u8bed\u7684\u53d1\u660e\u8005 ",(0,s.jsx)(n.a,{href:"https://github.com/Rich-Harris",children:"Rich Harris"})," \u5728\u4ed6\u5199\u7684\u4e00\u7bc7",(0,s.jsx)(n.a,{href:"https://medium.com/@Rich_Harris/%60tree-shaking%60-versus-dead-code-elimination-d3765df85c80",children:"\u300atree-shaking versus dead code elimination\u300b"}),"\u544a\u8bc9\u4e86\u6211\u4eec\u7b54\u6848\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"Rich Harris \u5f15\u7528\u4e86\u4e00\u4e2a\u505a\u86cb\u7cd5\u7684\u4f8b\u5b50\u3002\u539f\u6587\u5982\u4e0b\uff1a"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Bad analogy time: imagine that you made cakes by throwing whole eggs into the mixing bowl and smashing them up, instead of cracking them open and pouring the contents out. Once the cake comes out of the oven, you remove the fragments of eggshell, except that\u2019s quite tricky so most of the eggshell gets left in there."}),"\n",(0,s.jsx)(n.p,{children:"You\u2019d probably eat less cake, for one thing."}),"\n",(0,s.jsx)(n.p,{children:"That\u2019s what dead code elimination consists of \u2014 taking the finished product, and imperfectly removing bits you don\u2019t want. tree-shaking, on the other hand, asks the opposite question: given that I want to make a cake, which bits of what ingredients do I need to include in the mixing bowl?"}),"\n",(0,s.jsx)(n.p,{children:"Rather than excluding dead code, we\u2019re including live code. Ideally the end result would be the same, but because of the limitations of static analysis in JavaScript that\u2019s not the case. Live code inclusion gets better results, and is prima facie a more logical approach to the problem of preventing our users from downloading unused code."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u7b80\u5355\u6765\u8bf4\uff1a",(0,s.jsx)(n.code,{children:"DCE"})," \u597d\u6bd4\u505a\u86cb\u7cd5\u65f6\uff0c\u76f4\u63a5\u653e\u5165\u6574\u4e2a\u9e21\u86cb\uff0c\u505a\u5b8c\u65f6\u518d\u4ece\u86cb\u7cd5\u4e2d\u53d6\u51fa\u86cb\u58f3\u3002\u800c ",(0,s.jsx)(n.code,{children:"tree-shaking"})," \u5219\u662f\u5148\u53d6\u51fa\u86cb\u58f3\uff0c\u5728\u8fdb\u884c\u505a\u86cb\u7cd5\u3002\u4e24\u8005\u7ed3\u679c\u76f8\u540c\uff0c\u4f46\u662f\u8fc7\u7a0b\u662f\u5b8c\u5168\u4e0d\u540c\u7684\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"dead-code",children:"dead code"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"dead code"})," \u4e00\u822c\u5177\u6709\u4ee5\u4e0b\u51e0\u4e2a\u7279\u5f81:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4ee3\u7801\u4e0d\u4f1a\u88ab\u6267\u884c\uff0c\u4e0d\u53ef\u5230\u8fbe"}),"\n",(0,s.jsx)(n.li,{children:"\u4ee3\u7801\u6267\u884c\u7684\u7ed3\u679c\u4e0d\u4f1a\u88ab\u7528\u5230"}),"\n",(0,s.jsx)(n.li,{children:"\u4ee3\u7801\u53ea\u4f1a\u5f71\u54cd\u6b7b\u53d8\u91cf\uff08\u53ea\u5199\u4e0d\u8bfb\uff09"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u4f7f\u7528 ",(0,s.jsx)(n.code,{children:"webpack"})," \u5728 ",(0,s.jsx)(n.code,{children:"mode: development"})," \u6a21\u5f0f\u4e0b\u5bf9\u4ee5\u4e0b\u4ee3\u7801\u8fdb\u884c\u6253\u5305\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"function app() {\n  var test = '\u6211\u662fapp';\n  function set() {\n    return 1;\n  }\n  return test;\n  test = '\u65e0\u6cd5\u6267\u884c';\n  return test;\n}\n\nexport default app;\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u6700\u7ec8\u6253\u5305\u7ed3\u679c:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"eval(\n  \"function app() {\\n    var test = '\u6211\u662fapp';\\n    function set() {\\n        return 1;\\n    }\\n    return test;\\n    test = '\u65e0\u6cd5\u6267\u884c';\\n    return test;\\n}\\n\\napp();\\n\\n\\n//# sourceURL=webpack://webpack/./src/main.js?\"\n);\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u53ef\u4ee5\u770b\u5230\u6253\u5305\u7684\u7ed3\u679c\u5185\uff0c\u8fd8\u662f\u5b58\u5728\u65e0\u6cd5\u6267\u884c\u5230\u7684\u4ee3\u7801\u5757\u3002"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"webpack"})," \u4e0d\u652f\u6301 ",(0,s.jsx)(n.code,{children:"dead code elimination"})," \u5417\uff1f\u662f\u7684\uff0c",(0,s.jsx)(n.code,{children:"webpack"})," \u4e0d\u652f\u6301\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u539f\u6765\uff0c\u5728 ",(0,s.jsx)(n.code,{children:"webpack"})," \u4e2d\u5b9e\u73b0 ",(0,s.jsx)(n.code,{children:"dead code elimination"})," \u529f\u80fd\u5e76\u4e0d\u662f ",(0,s.jsx)(n.code,{children:"webpack"})," \u672c\u8eab, \u800c\u662f\u5927\u540d\u9f0e\u9f0e\u7684 ",(0,s.jsx)(n.a,{href:"https://github.com/mishoo/UglifyJS",children:"uglify"}),"\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u901a\u8fc7\u9605\u8bfb\u6e90\u7801\u53d1\u73b0\uff0c\u5728 ",(0,s.jsx)(n.code,{children:"mode: development"})," \u6a21\u5f0f\u4e0b\uff0c\u4e0d\u4f1a\u52a0\u8f7d ",(0,s.jsx)(n.code,{children:"terser-webpack-plugin"})," \u63d2\u4ef6\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// lib/config/defaults.js\nD(optimization, 'minimize', production);\nA(optimization, 'minimizer', () => [\n  {\n    apply: (compiler) => {\n      // Lazy load the Terser plugin\n      const TerserPlugin = require('terser-webpack-plugin');\n      new TerserPlugin({\n        terserOptions: {\n          compress: {\n            passes: 2\n          }\n        }\n      }).apply(compiler);\n    }\n  }\n]);\n\n// lib/WebpackOptionsApply.js\nif (options.optimization.minimize) {\n  for (const minimizer of options.optimization.minimizer) {\n    if (typeof minimizer === 'function') {\n      minimizer.call(compiler, compiler);\n    } else if (minimizer !== '...') {\n      minimizer.apply(compiler);\n    }\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u800c ",(0,s.jsx)(n.code,{children:"terser-webpack-plugin"})," \u63d2\u4ef6\u5185\u90e8\u4f7f\u7528\u4e86 ",(0,s.jsx)(n.code,{children:"uglify"})," \u5b9e\u73b0\u7684\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6211\u4eec\u5728 ",(0,s.jsx)(n.code,{children:"mode: production"})," \u6a21\u5f0f\u4e0b\u8fdb\u884c\u6253\u5305\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// \u683c\u5f0f\u5316\u540e\u7ed3\u679c\n(() => {\n    var r = {\n            225: (r) => {\n                r.exports = '\u6211\u662fapp';\n            }\n        },\n    // ...\n})();\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u53ef\u4ee5\u770b\u5230\u6700\u7ec8\u7684\u7ed3\u679c\uff0c\u5df2\u7ecf\u5220\u9664\u4e86\u4e0d\u53ef\u6267\u884c\u90e8\u5206\u7684\u4ee3\u7801\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u5e2e\u6211\u4eec\u538b\u7f29\u4e86\u4ee3\u7801\uff0c\u5220\u9664\u4e86\u6ce8\u91ca\u7b49\u529f\u80fd\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"tree-shaking-\u65e0\u6548",children:"tree shaking \u65e0\u6548\uff1f"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"tree shaking"})," \u672c\u8d28\u4e0a\u662f\u901a\u8fc7\u5206\u6790\u9759\u6001\u7684 ES \u6a21\u5757\uff0c\u6765\u5254\u9664\u672a\u4f7f\u7528\u4ee3\u7801\u7684\u3002"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.em,{children:[(0,s.jsx)(n.code,{children:"ESModule"})," \u7684\u7279\u70b9"]})}),"\n",(0,s.jsxs)(n.p,{children:["\u53ea\u80fd\u4f5c\u4e3a\u6a21\u5757\u9876\u5c42\u7684\u8bed\u53e5\u51fa\u73b0\uff0c\u4e0d\u80fd\u51fa\u73b0\u5728 function \u91cc\u9762\u6216\u662f if \u91cc\u9762\u3002\uff08ECMA-262 15.2)\nimport \u7684\u6a21\u5757\u540d\u53ea\u80fd\u662f\u5b57\u7b26\u4e32\u5e38\u91cf\u3002(ECMA-262 15.2.2)\n\u4e0d\u7ba1 import \u7684\u8bed\u53e5\u51fa\u73b0\u7684\u4f4d\u7f6e\u5728\u54ea\u91cc\uff0c\u5728\u6a21\u5757\u521d\u59cb\u5316\u7684\u65f6\u5019\u6240\u6709\u7684 import \u90fd\u5fc5\u987b\u5df2\u7ecf\u5bfc\u5165\u5b8c\u6210\u3002(ECMA-262 15.2.1.16.4 - 8.a)\nimport binding \u662f immutable \u7684\uff0c\u7c7b\u4f3c const\u3002\u6bd4\u5982\u8bf4\u4f60\u4e0d\u80fd ",(0,s.jsx)(n.code,{children:"import { a } from \u2018./a\u2019"})," \u7136\u540e\u7ed9 a \u8d4b\u503c\u4e2a\u5176\u4ed6\u4ec0\u4e48\u4e1c\u897f\u3002(ECMA-262 15.2.1.16.4 - 12.c.3)\n\u2014\u2013\u5f15\u7528\u81ea\u5c24\u96e8\u6eaa"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6211\u4eec\u6765\u770b\u770b ",(0,s.jsx)(n.code,{children:"tree shaking"})," \u7684\u529f\u6548\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u6211\u4eec\u6709\u4e00\u4e2a\u6a21\u5757"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// ./src/app.js\nexport const firstName = 'firstName';\n\nexport function square(x) {\n  return x.a;\n}\n\nsquare({ a: 123 });\n\nexport function app(x) {\n  return x * x * x;\n}\n\nexport default app;\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5e95\u4e0b\u662f 7 \u4e2a\u5b9e\u4f8b\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// 1*********************************************\n// import App from './app'\n\n// export function main() {\n//     var test = '\u6211\u662findex';\n//     return test;\n// }\n\n// console.log(main)\n\n// 2*********************************************\n\n// import App from './app'\n\n// export function main() {\n//     var test = '\u6211\u662findex';\n//     console.log(App(1))\n//     return test;\n// }\n\n// console.log(main)\n\n// 3*********************************************\n\n// import App from './app'\n\n// export function main() {\n//     var test = '\u6211\u662findex';\n//     App.square(1)\n//     return test;\n// }\n\n// console.log(main)\n\n// 4*********************************************\n\n// import App from './app'\n\n// export function main() {\n//     var test = '\u6211\u662findex';\n//     let methodName = 'square'\n//     App[methodName](1)\n//     return test;\n// }\n\n// console.log(main)\n\n// 6*********************************************\n\n// import * as App from './app'\n\n// export function main() {\n//     var test = '\u6211\u662findex';\n//     App.square(1)\n//     return test;\n// }\n\n// console.log(main)\n\n// 7*********************************************\n\n// import * as App from './app'\n\n// export function main() {\n//     var test = '\u6211\u662findex';\n//     let methodName = 'square'\n//     App[methodName](1)\n//     return test;\n// }\n\n// console.log(main)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u4f7f\u7528 \u6700\u7b80\u5355\u7684",(0,s.jsx)(n.code,{children:"webpack"}),"\u914d\u7f6e\u8fdb\u884c\u6253\u5305"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// webpack.config.js\nmodule.exports = {\n  entry: './src/index.js',\n  output: {\n    filename: 'dist.js'\n  },\n  mode: 'production'\n};\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u901a\u8fc7\u7ed3\u679c\u53ef\u4ee5\u770b\u5230\uff0c\u524d 6 \u4e2d\u7684\u6253\u5305\u7ed3\u679c\uff0c\u90fd\u5bf9\u6b7b\u4ee3\u7801\u8fdb\u884c\u4e86\u6d88\u9664\uff0c\u53ea\u6709\u7b2c 7 \u79cd\uff0c\u6d88\u9664\u5931\u8d25\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"/* ... */\nconst r = 'firstName';\nfunction o(e) {\n  return e.a;\n}\nfunction n(e) {\n  return e * e * e;\n}\no({ a: 123 });\nconst a = n;\nconsole.log(function () {\n  return t.square(1), '\u6211\u662findex';\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u672c\u4eba\u6ca1\u6709\u8be6\u7ec6\u4e86\u89e3\u8fc7\uff0c\u53ea\u80fd\u731c\u6d4b\u4e0b\uff0c\u7531\u4e8e ",(0,s.jsx)(n.code,{children:"JavaScript"})," \u52a8\u6001\u8bed\u8a00\u7684\u7279\u6027\u4f7f\u5f97\u9759\u6001\u5206\u6790\u6bd4\u8f83\u56f0\u96be\uff0c\u76ee\u524d\u7684\u7684\u89e3\u6790\u5668\u662f\u901a\u8fc7\u9759\u6001\u89e3\u6790\u7684\uff0c\u8fd8\u65e0\u6cd5\u5206\u6790\u5168\u91cf\u5bfc\u5165\uff0c\u52a8\u6001\u4f7f\u7528\u7684\u8bed\u6cd5\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5bf9\u4e8e\u66f4\u591a ",(0,s.jsx)(n.code,{children:"tree shaking"})," \u6267\u884c\u76f8\u5173\u7684\u53ef\u4ee5\u53c2\u8003\u4e00\u4e0b\u94fe\u63a5\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/rollup/rollup/issues/349",children:"Tree shaking class methods"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://segmentfault.com/a/1190000012794598",children:"\u4f60\u7684 tree-shaking \u5e76\u6ca1\u4ec0\u4e48\u5375\u7528"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://segmentfault.com/a/1190000037595350",children:"tree-shaking \u6548\u679c\u63a2\u8ba8"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u5f53\u7136\u4e86\uff0c\u673a\u667a\u7684\u7a0b\u5e8f\u5458\u662f\u4e0d\u4f1a\u88ab\u8fd9\u4e2a\u7ed9\u96be\u4f4f\u7684\uff0c\u65e2\u7136\u9759\u6001\u5206\u6790\u4e0d\u884c\uff0c\u90a3\u5c31\u7531\u5f00\u53d1\u8005\u624b\u52a8\u6765\u5c06\u6587\u4ef6\u6807\u8bb0\u4e3a\u65e0\u526f\u4f5c\u7528(side-effect-free)\u3002"}),"\n",(0,s.jsx)(n.h4,{id:"tree-shaking-\u548c-sideeffects",children:"tree shaking \u548c sideEffects"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"sideEffects"})," \u652f\u6301\u4e24\u79cd\u5199\u6cd5\uff0c\u4e00\u79cd\u662f ",(0,s.jsx)(n.code,{children:"false"}),"\uff0c\u53e6\u4e00\u79cd\u662f\u6570\u7ec4"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u5982\u679c\u6240\u6709\u4ee3\u7801\u90fd\u4e0d\u5305\u542b\u526f\u4f5c\u7528\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7b80\u5355\u5730\u5c06\u8be5\u5c5e\u6027\u6807\u8bb0\u4e3a ",(0,s.jsx)(n.code,{children:"false"})]}),"\n",(0,s.jsx)(n.li,{children:"\u5982\u679c\u4f60\u7684\u4ee3\u7801\u786e\u5b9e\u6709\u4e00\u4e9b\u526f\u4f5c\u7528\uff0c\u53ef\u4ee5\u6539\u4e3a\u63d0\u4f9b\u4e00\u4e2a\u6570\u7ec4"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u53ef\u4ee5\u5728 ",(0,s.jsx)(n.code,{children:"package.js"})," \u4e2d\u8fdb\u884c\u8bbe\u7f6e\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'// boolean\n{\n  "sideEffects": false\n}\n\n// array\n{\n  "sideEffects": ["./src/app.js", "*.css"]\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u4e5f\u53ef\u4ee5\u5728 ",(0,s.jsx)(n.code,{children:"module.rules"})," \u4e2d\u8fdb\u884c\u8bbe\u7f6e\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"module.exports = {\n  module: {\n    rules: [\n      {\n        test: /\\.jsx?$/,\n        exclude: /(node_modules)/,\n        use: {\n          loader: 'babel-loader'\n        },\n        sideEffects: false || []\n      }\n    ]\n  }\n};\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u8bbe\u7f6e\u4e86 ",(0,s.jsx)(n.code,{children:"sideEffects: false"}),"\uff0c\u540e\u5728\u91cd\u65b0\u6253\u5305"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:" var e = {\n            225: (e, r, t) => {\n                (e = t.hmd(e)).exports = '\u6211\u662fmain';\n            }\n        },\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u53ea\u5269\u4e0b ",(0,s.jsx)(n.code,{children:"main.js"})," \u6a21\u5757\u7684\u4ee3\u7801\uff0c\u5df2\u7ecf\u628a ",(0,s.jsx)(n.code,{children:"app.js"})," \u7684\u4ee3\u7801\u6d88\u9664\u4e86\u3002"]}),"\n",(0,s.jsx)(n.h4,{id:"usedexports",children:"usedExports"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"webpack"})," \u4e2d\u9664\u4e86 ",(0,s.jsx)(n.code,{children:"sideEffects"})," \u8fd8\u63d0\u4f9b\u4e86\u4e00\u79cd\u53e6\u4e00\u79cd\u6807\u8bb0\u6d88\u9664\u7684\u65b9\u5f0f\u3002\u90a3\u5c31\u662f\u901a\u8fc7\u914d\u7f6e\u9879 ",(0,s.jsx)(n.code,{children:"usedExports"})," \u3002"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u7531 optimization.usedExports \u6536\u96c6\u7684\u4fe1\u606f\u4f1a\u88ab\u5176\u5b83\u4f18\u5316\u624b\u6bb5\u6216\u8005\u4ee3\u7801\u751f\u6210\u4f7f\u7528\uff0c\u6bd4\u5982\u672a\u4f7f\u7528\u7684\u5bfc\u51fa\u5185\u5bb9\u4e0d\u4f1a\u88ab\u751f\u6210\uff0c\u5f53\u6240\u6709\u7684\u4f7f\u7528\u90fd\u9002\u914d\uff0c\u5bfc\u51fa\u540d\u79f0\u4f1a\u88ab\u5904\u7406\u505a\u5355\u4e2a\u6807\u8bb0\u5b57\u7b26\u3002 \u5728\u538b\u7f29\u5de5\u5177\u4e2d\u7684\u65e0\u7528\u4ee3\u7801\u6e05\u9664\u4f1a\u53d7\u76ca\u4e8e\u8be5\u9009\u9879\uff0c\u800c\u4e14\u80fd\u591f\u53bb\u9664\u672a\u4f7f\u7528\u7684\u5bfc\u51fa\u5185\u5bb9\u3002"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"mode: productions"})," \u4e0b\u662f\u9ed8\u8ba4\u5f00\u542f\u7684\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"module.exports = {\n  //...\n  optimization: {\n    usedExports: true\n  }\n};\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"usedExports"})," \u4f1a\u4f7f\u7528 ",(0,s.jsx)(n.code,{children:"terser"})," \u5224\u65ad\u4ee3\u7801\u6709\u6ca1\u6709 ",(0,s.jsx)(n.code,{children:"sideEffect"}),"\uff0c\u5982\u679c\u6ca1\u6709\u7528\u5230\uff0c\u53c8\u6ca1\u6709 ",(0,s.jsx)(n.code,{children:"sideEffect"})," \u7684\u8bdd\uff0c\u5c31\u4f1a\u5728\u6253\u5305\u65f6\u66ff\u5b83\u6807\u8bb0\u4e0a unused harmony\u3002\n",(0,s.jsx)(n.img,{src:t(8581).A+"",width:"2004",height:"73"})]}),"\n",(0,s.jsxs)(n.p,{children:["\u6700\u540e\u7531 ",(0,s.jsx)(n.code,{children:"Terser"}),"\u3001",(0,s.jsx)(n.code,{children:"UglifyJS"})," \u7b49 ",(0,s.jsx)(n.code,{children:"DCE"})," \u5de5\u5177\u201c\u6447\u201d\u6389\u8fd9\u90e8\u5206\u65e0\u6548\u4ee3\u7801\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://try.terser.org/",children:"terser \u6d4b\u8bd5"})}),"\n",(0,s.jsx)(n.h2,{id:"tree-shaking-\u5b9e\u73b0\u539f\u7406",children:"tree shaking \u5b9e\u73b0\u539f\u7406"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"tree shaking"})," \u672c\u8eab\u4e5f\u662f\u91c7\u7528\u9759\u6001\u5206\u6790\u7684\u65b9\u6cd5\u3002"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u7a0b\u5e8f\u9759\u6001\u5206\u6790\uff08Static Code Analysis\uff09\u662f\u6307\u5728\u4e0d\u8fd0\u884c\u4ee3\u7801\u7684\u65b9\u5f0f\u4e0b\uff0c\u901a\u8fc7\u8bcd\u6cd5\u5206\u6790\u3001\u8bed\u6cd5\u5206\u6790\u3001\u63a7\u5236\u6d41\u5206\u6790\u3001\u6570\u636e\u6d41\u5206\u6790\u7b49\u6280\u672f\u5bf9\u7a0b\u5e8f\u4ee3\u7801\u8fdb\u884c\u626b\u63cf\uff0c\u9a8c\u8bc1\u4ee3\u7801\u662f\u5426\u6ee1\u8db3\u89c4\u8303\u6027\u3001\u5b89\u5168\u6027\u3001\u53ef\u9760\u6027\u3001\u53ef\u7ef4\u62a4\u6027\u7b49\u6307\u6807\u7684\u4e00\u79cd\u4ee3\u7801\u5206\u6790\u6280\u672f"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"tree shaking"})," \u4f7f\u7528\u7684\u524d\u63d0\u662f\u6a21\u5757\u5fc5\u987b\u91c7\u7528",(0,s.jsx)(n.code,{children:"ES6Module"}),"\u8bed\u6cd5\uff0c\u56e0\u4e3a",(0,s.jsx)(n.code,{children:"tree Shaking"})," \u4f9d\u8d56 ES6 \u7684\u8bed\u6cd5\uff1a",(0,s.jsx)(n.code,{children:"import"})," \u548c ",(0,s.jsx)(n.code,{children:"export"}),"\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u63a5\u4e0b\u6765\u6211\u4eec\u6765\u770b\u770b\u8fdc\u53e4\u7248\u672c\u7684 ",(0,s.jsx)(n.code,{children:"rollup"})," \u662f\u600e\u4e48\u5b9e\u73b0 ",(0,s.jsx)(n.code,{children:"tree shaking"})," \u7684\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"rollup",children:"rollup"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\u6839\u636e\u5165\u53e3\u6a21\u5757\u5185\u5bb9\u521d\u59cb\u5316 ",(0,s.jsx)(n.code,{children:"Module"}),"\uff0c\u5e76\u4f7f\u7528 ",(0,s.jsx)(n.code,{children:"acorn"})," \u8fdb\u884c ",(0,s.jsx)(n.code,{children:"ast"})," \u8f6c\u5316"]}),"\n",(0,s.jsxs)(n.li,{children:["\u5206\u6790 ",(0,s.jsx)(n.code,{children:"ast"}),"\u3002 \u5bfb\u627e ",(0,s.jsx)(n.code,{children:"import"})," \u548c ",(0,s.jsx)(n.code,{children:"export"})," \u5173\u952e\u5b57\uff0c\u5efa\u7acb\u4f9d\u8d56\u5173\u7cfb"]}),"\n",(0,s.jsxs)(n.li,{children:["\u5206\u6790 ",(0,s.jsx)(n.code,{children:"ast"}),"\uff0c\u6536\u96c6\u5f53\u524d\u6a21\u5757\u5b58\u5728\u7684\u51fd\u6570\u3001\u53d8\u91cf\u7b49\u4fe1\u606f"]}),"\n",(0,s.jsxs)(n.li,{children:["\u518d\u4e00\u6b21\u5206\u6790 ",(0,s.jsx)(n.code,{children:"ast"}),", \u6536\u96c6\u5404\u51fd\u6570\u53d8\u91cf\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u56e0\u4e3a\u6211\u4eec\u662f\u6839\u636e\u4f9d\u8d56\u5173\u7cfb\u8fdb\u884c\u6536\u96c6\u4ee3\u7801\uff0c\u5982\u679c\u51fd\u6570\u53d8\u91cf\u672a\u88ab\u4f7f\u7528\uff0c"]}),"\n",(0,s.jsxs)(n.li,{children:["\u6839\u636e\u6536\u96c6\u5230\u7684\u51fd\u6570\u53d8\u91cf\u6807\u8bc6\u7b26\u7b49\u4fe1\u606f\uff0c\u8fdb\u884c\u5224\u65ad\uff0c\u5982\u679c\u662f ",(0,s.jsx)(n.code,{children:"import"}),"\uff0c\u5219\u8fdb\u884c ",(0,s.jsx)(n.code,{children:"Module"})," \u7684\u521b\u5efa\uff0c\u91cd\u65b0\u8d70\u4e0a\u51e0\u6b65\u3002\u5426\u5219\u7684\u8bdd\uff0c\u628a\u5bf9\u5e94\u7684\u4ee3\u7801\u4fe1\u606f\u5b58\u653e\u5230\u4e00\u4e2a\u7edf\u4e00\u7684 ",(0,s.jsx)(n.code,{children:"result"})," \u4e2d\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:["\u6839\u636e\u6700\u7ec8\u7684\u7ed3\u679c\u751f\u6210 ",(0,s.jsx)(n.code,{children:"bundle"}),"\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(8080).A+"",width:"249",height:"1161"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["\u6e90\u7801\u7248\u672c\uff1a",(0,s.jsx)(n.a,{href:"https://github.com/rollup/rollup/tree/v0.3.1",children:"v0.3.1"})]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u901a\u8fc7 ",(0,s.jsx)(n.code,{children:"entry"})," \u5165\u53e3\u6587\u4ef6\u8fdb\u884c\u521b\u5efa ",(0,s.jsx)(n.code,{children:"bundle"}),"\uff0c\u6267\u884c ",(0,s.jsx)(n.code,{children:"build"})," \u65b9\u6cd5\uff0c\u5f00\u59cb\u8fdb\u884c\u6253\u5305\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"export function rollup(entry, options = {}) {\n  const bundle = new Bundle({\n    entry,\n    resolvePath: options.resolvePath\n  });\n\n  return bundle.build().then(() => {\n    return {\n      generate: (options) => bundle.generate(options),\n      write: (dest, options = {}) => {\n        let { code, map } = bundle.generate({\n          dest,\n          format: options.format,\n          globalName: options.globalName\n        });\n\n        code += `\\n//# ${SOURCEMAPPING_URL}=${basename(dest)}.map`;\n\n        return Promise.all([writeFile(dest, code), writeFile(dest + '.map', map.toString())]);\n      }\n    };\n  });\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"build"})," \u5185\u90e8\u6267\u884c ",(0,s.jsx)(n.code,{children:"fetchModule"})," \u65b9\u6cd5\uff0c\u6839\u636e\u6587\u4ef6\u540d\uff0c",(0,s.jsx)(n.code,{children:"readFile"})," \u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\uff0c\u521b\u5efa ",(0,s.jsx)(n.code,{children:"Module"}),"\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"build () {\n    // bring in top-level AST nodes from the entry module\n    return this.fetchModule( this.entryPath, null )\n        .then( entryModule => {\n            this.entryModule = entryModule;\n\n            if ( entryModule.exports.default ) {\n                let defaultExportName = makeLegalIdentifier( basename( this.entryPath ).slice( 0, -extname( this.entryPath ).length ) );\n                while ( entryModule.ast._scope.contains( defaultExportName ) ) {\n                    defaultExportName = `_${defaultExportName}`;\n                }\n\n                entryModule.suggestName( 'default', defaultExportName );\n            }\n\n            return entryModule.expandAllStatements( true );\n        })\n        .then( statements => {\n            this.statements = statements;\n            this.deconflict();\n        });\n}\n\nfetchModule ( importee, importer ) {\n    return Promise.resolve( importer === null ? importee : this.resolvePath( importee, importer ) )\n        .then( path => {\n                /*\n                    \u7f13\u5b58\u5904\u7406\n                */\n\n                this.modulePromises[ path ] = readFile( path, { encoding: 'utf-8' })\n                    .then( code => {\n                        const module = new Module({\n                            path,\n                            code,\n                            bundle: this\n                        });\n\n                        return module;\n                    });\n\n            return this.modulePromises[ path ];\n        });\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u6839\u636e\u8bfb\u53d6\u5230\u7684\u6587\u4ef6\u5185\u5bb9\uff0c\u4f7f\u7528 ",(0,s.jsx)(n.code,{children:"acorn"})," \u7f16\u8bd1\u5668\u8fdb\u884c\u8fdb\u884c ",(0,s.jsx)(n.code,{children:"ast"})," \u7684\u8f6c\u5316\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"//\nexport default class Module {\n    constructor ({ path, code, bundle }) {\n\t\t/*\n        \u521d\u59cb\u5316\n        */\n\t\tthis.ast = parse(code, {\n\t\t\tecmaVersion: 6,\n\t\t\tsourceType: 'module',\n\t\t\tonComment: (block, text, start, end) =>\n\t\t\tthis.comments.push({ block, text, start, end })\n\t\t});\n\t\tthis.analyse();\n\t}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(7482).A+"",width:"873",height:"828"})}),"\n",(0,s.jsxs)(n.p,{children:["\u904d\u5386\u8282\u70b9\u4fe1\u606f\u3002\u5bfb\u627e ",(0,s.jsx)(n.code,{children:"import"})," \u548c ",(0,s.jsx)(n.code,{children:"export"})," \u5173\u952e\u5b57\uff0c\u8fd9\u4e00\u6b65\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684\u6839\u636e ",(0,s.jsx)(n.code,{children:"esm"})," \u7684\u9759\u6001\u7ed3\u6784\u8fdb\u884c\u5206\u6790\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u628a ",(0,s.jsx)(n.code,{children:"import"})," \u7684\u4fe1\u606f\uff0c\u6536\u96c6\u5230 ",(0,s.jsx)(n.code,{children:"this.imports"})," \u5bf9\u8c61\u4e2d\uff0c\u628a ",(0,s.jsx)(n.code,{children:"exports"})," \u7684\u4fe1\u606f\uff0c\u6536\u96c6\u5230 ",(0,s.jsx)(n.code,{children:"this.exports"})," \u4e2d."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"this.ast.body.forEach( node => {\n\tlet source;\n\tif ( node.type === 'ImportDeclaration' ) {\n\t\tsource = node.source.value;\n\n\t\tnode.specifiers.forEach( specifier => {\n\t\t\tconst isDefault = specifier.type === 'ImportDefaultSpecifier';\n\t\t\tconst isNamespace = specifier.type === 'ImportNamespaceSpecifier';\n\n\t\t\tconst localName = specifier.local.name;\n\t\t\tconst name = isDefault ? 'default' : isNamespace ? '*' : specifier.imported.name;\n\n\t\t\tif ( has( this.imports, localName ) ) {\n\t\t\t\tconst err = new Error( `Duplicated import '${localName}'` );\n\t\t\t\terr.file = this.path;\n\t\t\t\terr.loc = getLocation( this.code.original, specifier.start );\n\t\t\t\tthrow err;\n\t\t\t}\n\n\t\t\tthis.imports[ localName ] = {\n\t\t\t\tsource, // \u6a21\u5757id\n\t\t\t\tname,\n\t\t\t\tlocalName\n\t\t\t};\n\t\t});\n\t}\n\n\telse if ( /^Export/.test( node.type ) ) {\n\t\tif ( node.type === 'ExportDefaultDeclaration' ) {\n\t\t\tconst isDeclaration = /Declaration$/.test( node.declaration.type );\n\n\t\t\tthis.exports.default = {\n\t\t\t\tnode,\n\t\t\t\tname: 'default',\n\t\t\t\tlocalName: isDeclaration ? node.declaration.id.name : 'default',\n\t\t\t\tisDeclaration\n\t\t\t};\n\t\t}\n\n\t\t// export { foo, bar, baz }\n\t\t// export var foo = 42;\n\t\t// export function foo () {}\n\t\telse if ( node.type === 'ExportNamedDeclaration' ) {\n\t\t\t// export { foo } from './foo';\n\t\t\tsource = node.source && node.source.value;\n\n\t\t\tif ( node.specifiers.length ) {\n\t\t\t\t// export { foo, bar, baz }\n\t\t\t\tnode.specifiers.forEach( specifier => {\n\t\t\t\t\tconst localName = specifier.local.name;\n\t\t\t\t\tconst exportedName = specifier.exported.name;\n\n\t\t\t\t\tthis.exports[ exportedName ] = {\n\t\t\t\t\t\tlocalName,\n\t\t\t\t\t\texportedName\n\t\t\t\t\t};\n\n\t\t\t\t\tif ( source ) {\n\t\t\t\t\t\tthis.imports[ localName ] = {\n\t\t\t\t\t\t\tsource,\n\t\t\t\t\t\t\tlocalName,\n\t\t\t\t\t\t\tname: exportedName\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\telse {\n\t\t\t\tlet declaration = node.declaration;\n\n\t\t\t\tlet name;\n\n\t\t\t\tif ( declaration.type === 'VariableDeclaration' ) {\n\t\t\t\t\t// export var foo = 42\n\t\t\t\t\tname = declaration.declarations[0].id.name;\n\t\t\t\t} else {\n\t\t\t\t\t// export function foo () {}\n\t\t\t\t\tname = declaration.id.name;\n\t\t\t\t}\n\n\t\t\t\tthis.exports[ name ] = {\n\t\t\t\t\tnode,\n\t\t\t\t\tlocalName: name,\n\t\t\t\t\texpression: declaration\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(218).A+"",width:"1790",height:"314"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"\tanalyse () {\n\t\t// imports and exports, indexed by ID\n\t\tthis.imports = {};\n\t\tthis.exports = {};\n\n        // \u904d\u5386 ast \u67e5\u627e\u5bf9\u5e94\u7684 import\u3001export \u5173\u8054\n\t\tthis.ast.body.forEach( node => {\n\t\t\tlet source;\n\n\t\t\t// import foo from './foo';\n\t\t\t// import { bar } from './bar';\n\t\t\tif ( node.type === 'ImportDeclaration' ) {\n\t\t\t\tsource = node.source.value;\n\n\t\t\t\tnode.specifiers.forEach( specifier => {\n\t\t\t\t\tconst isDefault = specifier.type === 'ImportDefaultSpecifier';\n\t\t\t\t\tconst isNamespace = specifier.type === 'ImportNamespaceSpecifier';\n\n\t\t\t\t\tconst localName = specifier.local.name;\n\t\t\t\t\tconst name = isDefault ? 'default' : isNamespace ? '*' : specifier.imported.name;\n\n\t\t\t\t\tif ( has( this.imports, localName ) ) {\n\t\t\t\t\t\tconst err = new Error( `Duplicated import '${localName}'` );\n\t\t\t\t\t\terr.file = this.path;\n\t\t\t\t\t\terr.loc = getLocation( this.code.original, specifier.start );\n\t\t\t\t\t\tthrow err;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.imports[ localName ] = {\n\t\t\t\t\t\tsource, // \u6a21\u5757id\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tlocalName\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t}\n\n\t\t\telse if ( /^Export/.test( node.type ) ) {\n\t\t\t\t// export default function foo () {}\n\t\t\t\t// export default foo;\n\t\t\t\t// export default 42;\n\t\t\t\tif ( node.type === 'ExportDefaultDeclaration' ) {\n\t\t\t\t\tconst isDeclaration = /Declaration$/.test( node.declaration.type );\n\n\t\t\t\t\tthis.exports.default = {\n\t\t\t\t\t\tnode,\n\t\t\t\t\t\tname: 'default',\n\t\t\t\t\t\tlocalName: isDeclaration ? node.declaration.id.name : 'default',\n\t\t\t\t\t\tisDeclaration\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// export { foo, bar, baz }\n\t\t\t\t// export var foo = 42;\n\t\t\t\t// export function foo () {}\n\t\t\t\telse if ( node.type === 'ExportNamedDeclaration' ) {\n\t\t\t\t\t// export { foo } from './foo';\n\t\t\t\t\tsource = node.source && node.source.value;\n\n\t\t\t\t\tif ( node.specifiers.length ) {\n\t\t\t\t\t\t// export { foo, bar, baz }\n\t\t\t\t\t\tnode.specifiers.forEach( specifier => {\n\t\t\t\t\t\t\tconst localName = specifier.local.name;\n\t\t\t\t\t\t\tconst exportedName = specifier.exported.name;\n\n\t\t\t\t\t\t\tthis.exports[ exportedName ] = {\n\t\t\t\t\t\t\t\tlocalName,\n\t\t\t\t\t\t\t\texportedName\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tif ( source ) {\n\t\t\t\t\t\t\t\tthis.imports[ localName ] = {\n\t\t\t\t\t\t\t\t\tsource,\n\t\t\t\t\t\t\t\t\tlocalName,\n\t\t\t\t\t\t\t\t\tname: exportedName\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\telse {\n\t\t\t\t\t\tlet declaration = node.declaration;\n\n\t\t\t\t\t\tlet name;\n\n\t\t\t\t\t\tif ( declaration.type === 'VariableDeclaration' ) {\n\t\t\t\t\t\t\t// export var foo = 42\n\t\t\t\t\t\t\tname = declaration.declarations[0].id.name;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// export function foo () {}\n\t\t\t\t\t\t\tname = declaration.id.name;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.exports[ name ] = {\n\t\t\t\t\t\t\tnode,\n\t\t\t\t\t\t\tlocalName: name,\n\t\t\t\t\t\t\texpression: declaration\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n        // \u67e5\u627e\u51fd\u6570\uff0c\u53d8\u91cf\uff0c\u7c7b\uff0c\u5757\u7ea7\u4f5c\u7528\u4e0e\u7b49,\u5e76\u6839\u636e\u5f15\u7528\u5173\u7cfb\u8fdb\u884c\u5173\u8054\n        analyse( this.ast, this.code, this );\n        /*\n        \u521d\u59cb\u5316\u6570\u636e\n        */\n\n\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u63a5\u4e0b\u6765\u67e5\u627e\u51fd\u6570\uff0c\u53d8\u91cf\uff0c\u7c7b\uff0c\u5757\u7ea7\u4f5c\u7528\u4e0e\u7b49,\u5e76\u6839\u636e\u5f15\u7528\u5173\u7cfb\u8fdb\u884c\u5173\u8054\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u4f7f\u7528 ",(0,s.jsx)(n.code,{children:"magicString"})," \u4e3a\u6bcf\u4e00\u4e2a ",(0,s.jsx)(n.code,{children:"statement"})," \u8282\u70b9\u589e\u52a0\u5185\u5bb9\u4fee\u6539\u7684\u529f\u80fd\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u904d\u5386\u6574\u9897 ",(0,s.jsx)(n.code,{children:"ast"})," \u6811\uff0c\u5148\u521d\u59cb\u5316\u4e00\u4e2a ",(0,s.jsx)(n.code,{children:"Scope"}),"\uff0c\u4f5c\u4e3a\u5f53\u524d\u6a21\u5757\u7684\u547d\u540d\u7a7a\u95f4\u3002\u5982\u679c\u662f\u51fd\u6570\u6216\u5757\u7ea7\u4f5c\u7528\u57df\u7b49\u5219\u65b0\u5efa\u4e00\u4e2a ",(0,s.jsx)(n.code,{children:"Scope"}),"\u3002\u5404 ",(0,s.jsx)(n.code,{children:"Scope"})," \u4e4b\u95f4\u901a\u8fc7 ",(0,s.jsx)(n.code,{children:"parent"})," \u8fdb\u884c\u5173\u8054\uff0c\u5efa\u7acb\u8d77\u4e00\u4e2a\u6839\u636e\u547d\u540d\u7a7a\u95f4\u5173\u7cfb\u6811\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679c\u662f\u53d8\u91cf\u548c\u51fd\u6570\uff0c\u5219\u4e0e\u5f53\u524d\u7684 ",(0,s.jsx)(n.code,{children:"Scope"})," \u8fdb\u884c\u5173\u8054, \u628a\u5bf9\u5e94\u7684\u6807\u8bc6\u7b26\u540d\u79f0\u589e\u52a0\u5230 ",(0,s.jsx)(n.code,{children:"Scope"})," \u7684\u4e2d\u3002\u5230\u8fd9\u4e00\u6b65\uff0c\u5df2\u7ecf\u6536\u96c6\u5230\u4e86\u5404\u8282\u70b9\u4e0a\u51fa\u73b0\u7684\u51fd\u6570\u548c\u53d8\u91cf\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(4450).A+"",width:"943",height:"307"})}),"\n",(0,s.jsxs)(n.p,{children:["\u63a5\u4e0b\u6765\uff0c\u518d\u4e00\u6b21\u904d\u5386 ",(0,s.jsx)(n.code,{children:"ast"}),"\u3002\u67e5\u627e\u53d8\u91cf\u51fd\u6570\uff0c\u662f\u5426\u53ea\u662f\u88ab\u8bfb\u53d6\u8fc7\uff0c\u6216\u8005\u53ea\u662f\u4fee\u6539\u8fc7\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6839\u636e ",(0,s.jsx)(n.code,{children:"Identifier"})," \u7c7b\u578b\u67e5\u627e\u6807\u8bc6\u7b26\uff0c\u5982\u679c\u5f53\u524d\u6807\u8bc6\u7b26\u80fd\u5728 ",(0,s.jsx)(n.code,{children:"Scope"})," \u4e2d\u627e\u5230\uff0c\u8bf4\u660e\u6709\u5bf9\u5176\u8fdb\u884c\u8fc7\u8bfb\u53d6\u3002\u5b58\u653e\u5728 ",(0,s.jsx)(n.code,{children:"_dependsOn"})," \u96c6\u5408\u4e2d\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(171).A+"",width:"884",height:"355"})}),"\n",(0,s.jsxs)(n.p,{children:["\u63a5\u4e0b\u6765\u6839\u636e ",(0,s.jsx)(n.code,{children:"AssignmentExpression"}),"\u3001",(0,s.jsx)(n.code,{children:"UpdateExpression"})," \u548c ",(0,s.jsx)(n.code,{children:"CallExpression"})," \u7c7b\u578b\u8282\u70b9\uff0c\u6536\u96c6\u6211\u4eec\u7684\u6807\u8bc6\u7b26\uff0c\u6709\u6ca1\u6709\u88ab\u4fee\u6539\u8fc7\u6216\u88ab\u5f53\u524d\u53c2\u6570\u4f20\u9012\u8fc7\u3002\u5e76\u5c06\u7ed3\u679c\u5b58\u653e\u5728 ",(0,s.jsx)(n.code,{children:"_modifies"})," \u4e2d\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"function analyse(ast, magicString, module) {\n  var scope = new Scope();\n  var currentTopLevelStatement = undefined;\n\n  function addToScope(declarator) {\n    var name = declarator.id.name;\n    scope.add(name, false);\n\n    if (!scope.parent) {\n      currentTopLevelStatement._defines[name] = true;\n    }\n  }\n\n  function addToBlockScope(declarator) {\n    var name = declarator.id.name;\n    scope.add(name, true);\n\n    if (!scope.parent) {\n      currentTopLevelStatement._defines[name] = true;\n    }\n  }\n\n  // first we need to generate comprehensive scope info\n  var previousStatement = null;\n  var commentIndex = 0;\n\n  ast.body.forEach(function (statement) {\n    currentTopLevelStatement = statement; // so we can attach scoping info\n\n    Object.defineProperties(statement, {\n      _defines: { value: {} },\n      _modifies: { value: {} },\n      _dependsOn: { value: {} },\n      _included: { value: false, writable: true },\n      _module: { value: module },\n      _source: { value: magicString.snip(statement.start, statement.end) }, // TODO don't use snip, it's a waste of memory\n      _margin: { value: [0, 0] },\n      _leadingComments: { value: [] },\n      _trailingComment: { value: null, writable: true }\n    });\n\n    var trailing = !!previousStatement;\n\n    // attach leading comment\n    do {\n      var comment = module.comments[commentIndex];\n\n      if (!comment || comment.end > statement.start) break;\n\n      // attach any trailing comment to the previous statement\n      if (trailing && !/\\n/.test(magicString.slice(previousStatement.end, comment.start))) {\n        previousStatement._trailingComment = comment;\n      }\n\n      // then attach leading comments to this statement\n      else {\n        statement._leadingComments.push(comment);\n      }\n\n      commentIndex += 1;\n      trailing = false;\n    } while (module.comments[commentIndex]);\n\n    // determine margin\n    var previousEnd = previousStatement\n      ? (previousStatement._trailingComment || previousStatement).end\n      : 0;\n    var start = (statement._leadingComments[0] || statement).start;\n\n    var gap = magicString.original.slice(previousEnd, start);\n    var margin = gap.split('\\n').length;\n\n    if (previousStatement) previousStatement._margin[1] = margin;\n    statement._margin[0] = margin;\n\n    walk(statement, {\n      enter: function (node) {\n        var newScope = undefined;\n\n        magicString.addSourcemapLocation(node.start);\n\n        switch (node.type) {\n          case 'FunctionExpression':\n          case 'FunctionDeclaration':\n          case 'ArrowFunctionExpression':\n            var names = node.params.map(getName);\n\n            if (node.type === 'FunctionDeclaration') {\n              addToScope(node);\n            } else if (node.type === 'FunctionExpression' && node.id) {\n              names.push(node.id.name);\n            }\n\n            newScope = new Scope({\n              parent: scope,\n              params: names, // TODO rest params?\n              block: false\n            });\n\n            break;\n\n          case 'BlockStatement':\n            newScope = new Scope({\n              parent: scope,\n              block: true\n            });\n\n            break;\n\n          case 'CatchClause':\n            newScope = new Scope({\n              parent: scope,\n              params: [node.param.name],\n              block: true\n            });\n\n            break;\n\n          case 'VariableDeclaration':\n            node.declarations.forEach(node.kind === 'let' ? addToBlockScope : addToScope); // TODO const?\n            break;\n\n          case 'ClassDeclaration':\n            addToScope(node);\n            break;\n        }\n\n        if (newScope) {\n          Object.defineProperty(node, '_scope', { value: newScope });\n          scope = newScope;\n        }\n      },\n      leave: function (node) {\n        if (node === currentTopLevelStatement) {\n          currentTopLevelStatement = null;\n        }\n\n        if (node._scope) {\n          scope = scope.parent;\n        }\n      }\n    });\n\n    previousStatement = statement;\n  });\n\n  // then, we need to find which top-level dependencies this statement has,\n  // and which it potentially modifies\n  ast.body.forEach(function (statement) {\n    function checkForReads(node, parent) {\n      if (node.type === 'Identifier') {\n        // disregard the `bar` in `foo.bar` - these appear as Identifier nodes\n        if (parent.type === 'MemberExpression' && node !== parent.object) {\n          return;\n        }\n\n        // disregard the `bar` in { bar: foo }\n        if (parent.type === 'Property' && node !== parent.value) {\n          return;\n        }\n\n        var definingScope = scope.findDefiningScope(node.name);\n\n        if ((!definingScope || definingScope.depth === 0) && !statement._defines[node.name]) {\n          statement._dependsOn[node.name] = true;\n        }\n      }\n    }\n\n    function checkForWrites(node) {\n      function addNode(node, disallowImportReassignments) {\n        while (node.type === 'MemberExpression') {\n          node = node.object;\n        }\n\n        // disallow assignments/updates to imported bindings and namespaces\n        if (\n          disallowImportReassignments &&\n          has(module.imports, node.name) &&\n          !scope.contains(node.name)\n        ) {\n          var err = new Error(\"Illegal reassignment to import '\" + node.name + \"'\");\n          err.file = module.path;\n          err.loc = getLocation(module.code.toString(), node.start);\n          throw err;\n        }\n\n        if (node.type !== 'Identifier') {\n          return;\n        }\n\n        statement._modifies[node.name] = true;\n      }\n\n      if (node.type === 'AssignmentExpression') {\n        addNode(node.left, true);\n      } else if (node.type === 'UpdateExpression') {\n        addNode(node.argument, true);\n      } else if (node.type === 'CallExpression') {\n        node.arguments.forEach(function (arg) {\n          return addNode(arg, false);\n        });\n      }\n\n      // TODO UpdateExpressions, method calls?\n    }\n\n    walk(statement, {\n      enter: function (node, parent) {\n        // skip imports\n        if (/^Import/.test(node.type)) return this.skip();\n\n        if (node._scope) scope = node._scope;\n\n        checkForReads(node, parent);\n        checkForWrites(node, parent);\n\n        //if ( node.type === 'ReturnStatement')\n      },\n      leave: function (node) {\n        if (node._scope) scope = scope.parent;\n      }\n    });\n  });\n\n  ast._scope = scope;\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u6267\u884c\u5b8c\u7ed3\u679c\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(6465).A+"",width:"1880",height:"1344"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u4e0a\u4e00\u6b65\u79cd\uff0c\u6211\u4eec\u4e3a\u51fd\u6570\uff0c\u53d8\u91cf\uff0c\u7c7b\uff0c\u5757\u7ea7\u4f5c\u7528\u4e0e\u7b49\u58f0\u660e\u4e0e\u6211\u4eec\u5f53\u524d\u8282\u70b9\u8fdb\u884c\u4e86\u5173\u8054\uff0c\u73b0\u5728\u8981\u628a\u8282\u70b9\u4e0a\u7684\u8fd9\u4e9b\u4fe1\u606f\uff0c\u7edf\u4e00\u6536\u96c6\u8d77\u6765\uff0c\u653e\u5230 ",(0,s.jsx)(n.code,{children:"Module"})," \u4e2d"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"//\nthis.ast.body.forEach((statement) => {\n  Object.keys(statement._defines).forEach((name) => {\n    this.definitions[name] = statement;\n  });\n\n  Object.keys(statement._modifies).forEach((name) => {\n    if (!has(this.modifications, name)) {\n      this.modifications[name] = [];\n    }\n\n    this.modifications[name].push(statement);\n  });\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(6465).A+"",width:"1880",height:"1344"})}),"\n",(0,s.jsxs)(n.p,{children:["\u4ece\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6bcf\u4e2a ",(0,s.jsx)(n.code,{children:"statement"})," \u4e2d\uff0c\u4f9d\u8d56\u4e86\u54ea\u4e9b\uff0c\u4fee\u6539\u4e86\u54ea\u4e9b\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5f53\u6211\u4eec\u5728\u5165\u53e3\u6a21\u5757\u7684\u64cd\u4f5c\u5b8c\u6210\u540e\uff0c\u5728\u904d\u5386 ",(0,s.jsx)(n.code,{children:"statement"})," \u8282\u70b9\uff0c\u6839\u636e ",(0,s.jsx)(n.code,{children:"_dependsOn"})," \u7684\u4e2d\u7684\u4fe1\u606f\uff0c\u6267\u884c ",(0,s.jsx)(n.code,{children:"define"})," \u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679c ",(0,s.jsx)(n.code,{children:"_dependsOn"})," \u7684\u6570\u636e\uff0c\u5728 ",(0,s.jsx)(n.code,{children:"this.imports"})," \u4e2d\uff0c\u80fd\u591f\u627e\u5230\uff0c\u8bf4\u660e\u8be5\u6807\u8bc6\u7b26\u662f\u4e00\u4e2a\u5bfc\u5165\u6a21\u5757\uff0c\u8c03\u7528 ",(0,s.jsx)(n.code,{children:"fetchModule"})," \u65b9\u6cd5\uff0c\u91cd\u590d\u4e0a\u9762\u7684\u903b\u8f91\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679c\u662f\u6b63\u5e38\u51fd\u6570\u53d8\u91cf\u4e4b\u7c7b\u7684\uff0c\u5219\u6536\u96c6\u5bf9\u5e94 ",(0,s.jsx)(n.code,{children:"statement"})," \u3002\u6267\u884c\u5230\u6700\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u76f8\u5173\u8054\u7684 ",(0,s.jsx)(n.code,{children:"statement"})," \u90fd\u6536\u96c6\u8d77\u6765\uff0c\u672a\u88ab\u6536\u96c6\u5230\uff0c\u8bf4\u660e\u5176\u5c31\u662f\u65e0\u7528\u4ee3\u7801\uff0c\u5df2\u7ecf\u88ab\u8fc7\u6ee4\u4e86\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6700\u540e\u5728\u91cd\u7ec4\u6210 ",(0,s.jsx)(n.code,{children:"bundle"}),"\uff0c\u901a\u8fc7 ",(0,s.jsx)(n.code,{children:"fs"})," \u5728\u53d1\u9001\u5230\u6211\u4eec\u7684\u6587\u4ef6\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"webpack",children:"webpack"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"webpack"})," \u5b9e\u73b0 ",(0,s.jsx)(n.code,{children:"tree shaking"})," \u4e0e ",(0,s.jsx)(n.code,{children:"rollup"})," \u662f\u540c\u4e00\u4e2a\u539f\u7406\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u4ee5\u4e0b\u4fe1\u606f\u6765\u81ea\u4e8e ",(0,s.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/403901557",children:"Webpack \u539f\u7406\u7cfb\u5217\u4e5d\uff1atree-shaking \u5b9e\u73b0\u539f\u7406"}),"\uff0c\u7ed3\u5408\u4e2a\u4eba\u7406\u89e3\uff0c\u8fdb\u884c\u4fee\u6539\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5728 ",(0,s.jsx)(n.code,{children:"make"})," \u9636\u6bb5\u4e2d\uff0c",(0,s.jsx)(n.code,{children:"webpack"})," \u901a\u8fc7 ",(0,s.jsx)(n.code,{children:"compilation"})," \u5bf9\u8c61\u8fdb\u884c\u6a21\u5757\u7684\u7f16\u8bd1\u5206\u6790\u7b49\u5de5\u4f5c\u3002"]}),"\n",(0,s.jsx)(n.h4,{id:"\u6536\u96c6\u6a21\u5757\u5bfc\u51fa",children:"\u6536\u96c6\u6a21\u5757\u5bfc\u51fa"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u5bf9\u6a21\u5757\u8fdb\u884c ",(0,s.jsx)(n.code,{children:"parse"})," \u7684\u65f6\u5019\uff0c\u4e5f\u662f\u4f7f\u7528 ",(0,s.jsx)(n.code,{children:"acorn"})," \u7f16\u8bd1\u5668\u8fdb\u884c\u8fdb\u884c ",(0,s.jsx)(n.code,{children:"ast"})," \u7684\u8f6c\u5316\u3002\u4e0e ",(0,s.jsx)(n.code,{children:"rollup"})," \u4e00\u6837\uff0c\u4e5f\u662f\u901a\u8fc7 ",(0,s.jsx)(n.code,{children:"esm"})," \u7684\u9759\u6001\u7ed3\u6784\u8bed\u6cd5 ",(0,s.jsx)(n.code,{children:"import"})," \u548c ",(0,s.jsx)(n.code,{children:"export"})," \u8fdb\u884c\u5206\u6790\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6240\u6709\u6a21\u5757\u90fd\u7f16\u8bd1\u5b8c\u6bd5\u540e\uff0c\u89e6\u53d1 ",(0,s.jsx)(n.code,{children:"compilation.hooks.finishModules"})," \u94a9\u5b50\uff0c\u5f00\u59cb\u6267\u884c ",(0,s.jsx)(n.code,{children:"FlagDependencyExportsPlugin"})," \u63d2\u4ef6\u56de\u8c03"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"FlagDependencyExportsPlugin"})," \u63d2\u4ef6\u4ece ",(0,s.jsx)(n.code,{children:"entry"})," \u5f00\u59cb\u8bfb\u53d6 ",(0,s.jsx)(n.code,{children:"ModuleGraph"})," \u4e2d\u5b58\u50a8\u7684\u6a21\u5757\u4fe1\u606f\uff0c\u904d\u5386\u6240\u6709 ",(0,s.jsx)(n.code,{children:"module"})," \u5bf9\u8c61"]}),"\n",(0,s.jsxs)(n.p,{children:["\u904d\u5386 ",(0,s.jsx)(n.code,{children:"module"})," \u5bf9\u8c61\u7684 ",(0,s.jsx)(n.code,{children:"dependencies"})," \u6570\u7ec4\uff0c\u627e\u5230\u6240\u6709 ",(0,s.jsx)(n.code,{children:"HarmonyExportXXXDependency"})," \u7c7b\u578b\u7684\u4f9d\u8d56\u5bf9\u8c61\uff0c\u5c06\u5176\u8f6c\u6362\u4e3a ",(0,s.jsx)(n.code,{children:"ExportInfo"})," \u5bf9\u8c61\u5e76\u8bb0\u5f55\u5230 ",(0,s.jsx)(n.code,{children:"ModuleGraph"})," \u4f53\u7cfb\u4e2d"]}),"\n",(0,s.jsxs)(n.p,{children:["\u7ecf\u8fc7 ",(0,s.jsx)(n.code,{children:"FlagDependencyExportsPlugin"})," \u63d2\u4ef6\u5904\u7406\u540e\uff0c\u6240\u6709 ",(0,s.jsx)(n.code,{children:"ESM"})," \u98ce\u683c\u7684 ",(0,s.jsx)(n.code,{children:"export"})," \u8bed\u53e5\u90fd\u4f1a\u8bb0\u5f55\u5728 ",(0,s.jsx)(n.code,{children:"ModuleGraph"})," \u4f53\u7cfb\u5185\uff0c\u540e\u7eed\u64cd\u4f5c\u5c31\u53ef\u4ee5\u4ece ",(0,s.jsx)(n.code,{children:"ModuleGraph"})," \u4e2d\u76f4\u63a5\u8bfb\u53d6\u51fa\u6a21\u5757\u7684\u5bfc\u51fa\u503c\u3002"]}),"\n",(0,s.jsx)(n.h4,{id:"\u6807\u8bb0\u6a21\u5757\u5bfc\u51fa",children:"\u6807\u8bb0\u6a21\u5757\u5bfc\u51fa"}),"\n",(0,s.jsxs)(n.p,{children:["\u6a21\u5757\u5bfc\u51fa\u4fe1\u606f\u6536\u96c6\u5b8c\u6bd5\u540e\uff0c",(0,s.jsx)(n.code,{children:"webpack"})," \u9700\u8981\u6807\u8bb0\u51fa\u5404\u4e2a\u6a21\u5757\u7684\u5bfc\u51fa\u5217\u8868\u4e2d\uff0c\u54ea\u4e9b\u5bfc\u51fa\u503c\u6709\u88ab\u5176\u5b83\u6a21\u5757\u7528\u5230\uff0c\u54ea\u4e9b\u6ca1\u6709\uff0c\u8fd9\u4e00\u8fc7\u7a0b\u53d1\u751f\u5728 ",(0,s.jsx)(n.code,{children:"Seal"})," \u9636\u6bb5\uff0c\u4e5f\u5c31\u662f\u5904\u7406 ",(0,s.jsx)(n.code,{children:"chunk"})," \u7684\u9636\u6bb5\uff0c\u4e3b\u6d41\u7a0b\uff1a"]}),"\n",(0,s.jsxs)(n.p,{children:["\u89e6\u53d1 ",(0,s.jsx)(n.code,{children:"compilation.hooks.optimizeDependencies"})," \u94a9\u5b50\uff0c\u5f00\u59cb\u6267\u884c ",(0,s.jsx)(n.code,{children:"FlagDependencyUsagePlugin"})," \u63d2\u4ef6\u903b\u8f91"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5728 ",(0,s.jsx)(n.code,{children:"FlagDependencyUsagePlugin"})," \u63d2\u4ef6\u4e2d\uff0c\u4ece ",(0,s.jsx)(n.code,{children:"entry"})," \u5f00\u59cb\u9010\u6b65\u904d\u5386 ",(0,s.jsx)(n.code,{children:"ModuleGraph"})," \u5b58\u50a8\u7684\u6240\u6709 ",(0,s.jsx)(n.code,{children:"module"})," \u5bf9\u8c61"]}),"\n",(0,s.jsxs)(n.p,{children:["\u904d\u5386 ",(0,s.jsx)(n.code,{children:"module"})," \u5bf9\u8c61\u5bf9\u5e94\u7684 ",(0,s.jsx)(n.code,{children:"exportInfo"})," \u6570\u7ec4\u4e3a\u6bcf\u4e00\u4e2a ",(0,s.jsx)(n.code,{children:"exportInfo"})," \u5bf9\u8c61\u6267\u884c ",(0,s.jsx)(n.code,{children:"compilation.getDependencyReferencedExports"})," \u65b9\u6cd5\uff0c\u786e\u5b9a\u5176\u5bf9\u5e94\u7684 ",(0,s.jsx)(n.code,{children:"dependency"})," \u5bf9\u8c61\u6709\u5426\u88ab\u5176\u5b83\u6a21\u5757\u4f7f\u7528"]}),"\n",(0,s.jsxs)(n.p,{children:["\u88ab\u4efb\u610f\u6a21\u5757\u4f7f\u7528\u5230\u7684\u5bfc\u51fa\u503c\uff0c\u8c03\u7528 ",(0,s.jsx)(n.code,{children:"exportInfo.setUsedConditionally"})," \u65b9\u6cd5\u5c06\u5176\u6807\u8bb0\u4e3a\u5df2\u88ab\u4f7f\u7528\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"exportInfo.setUsedConditionally"})," \u5185\u90e8\u4fee\u6539 ",(0,s.jsx)(n.code,{children:"exportInfo._usedInRuntime"})," \u5c5e\u6027\uff0c\u8bb0\u5f55\u8be5\u5bfc\u51fa\u88ab\u5982\u4f55\u4f7f\u7528"]}),"\n",(0,s.jsx)(n.h4,{id:"\u751f\u6210\u4ee3\u7801",children:"\u751f\u6210\u4ee3\u7801"}),"\n",(0,s.jsxs)(n.p,{children:["\u6253\u5305\u9636\u6bb5\uff0c\u8c03\u7528 ",(0,s.jsx)(n.code,{children:"HarmonyExportXXXDependency.Template.apply"})," \u65b9\u6cd5\u751f\u6210\u4ee3\u7801"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5728 ",(0,s.jsx)(n.code,{children:"apply"})," \u65b9\u6cd5\u5185\uff0c\u8bfb\u53d6 ",(0,s.jsx)(n.code,{children:"ModuleGraph"})," \u4e2d\u5b58\u50a8\u7684 ",(0,s.jsx)(n.code,{children:"exportsInfo"})," \u4fe1\u606f\uff0c\u5224\u65ad\u54ea\u4e9b\u5bfc\u51fa\u503c\u88ab\u4f7f\u7528\uff0c\u54ea\u4e9b\u672a\u88ab\u4f7f\u7528"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5bf9\u5df2\u7ecf\u88ab\u4f7f\u7528\u53ca\u672a\u88ab\u4f7f\u7528\u7684\u5bfc\u51fa\u503c\uff0c\u5206\u522b\u521b\u5efa\u5bf9\u5e94\u7684 ",(0,s.jsx)(n.code,{children:"HarmonyExportInitFragment"})," \u5bf9\u8c61\uff0c\u4fdd\u5b58\u5230 ",(0,s.jsx)(n.code,{children:"initFragments"})," \u6570\u7ec4"]}),"\n",(0,s.jsxs)(n.p,{children:["\u904d\u5386 ",(0,s.jsx)(n.code,{children:"initFragments"})," \u6570\u7ec4\uff0c\u751f\u6210\u6700\u7ec8\u7ed3\u679c"]}),"\n",(0,s.jsx)(n.h4,{id:"\u5220\u9664-dead-code",children:"\u5220\u9664 Dead Code"}),"\n",(0,s.jsxs)(n.p,{children:["\u6700\u540e\u7531 ",(0,s.jsx)(n.code,{children:"Terser"}),"\u3001",(0,s.jsx)(n.code,{children:"UglifyJS"})," \u7b49 ",(0,s.jsx)(n.code,{children:"DCE"})," \u5de5\u5177\u201c\u6447\u201d\u6389\u8fd9\u90e8\u5206\u65e0\u6548\u4ee3\u7801\uff0c\u6784\u6210\u5b8c\u6574\u7684 ",(0,s.jsx)(n.code,{children:"Tree Shaking"})," \u64cd\u4f5c"]}),"\n",(0,s.jsx)(n.h2,{id:"\u53c2\u8003\u8d44\u6599",children:"\u53c2\u8003\u8d44\u6599"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/happylindz/blog/issues/6",children:"\u6df1\u5165\u7406\u89e3 webpack \u6587\u4ef6\u6253\u5305\u673a\u5236"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/rollup/rollup/issues/349",children:"Tree shaking class methods"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://segmentfault.com/a/1190000012794598",children:"\u4f60\u7684 tree-shaking \u5e76\u6ca1\u4ec0\u4e48\u5375\u7528"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://juejin.cn/post/7002410645316436004#heading-2",children:"Webpack \u539f\u7406\u7cfb\u5217\u4e5d\uff1atree-shaking \u5b9e\u73b0\u539f\u7406"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://segmentfault.com/a/1190000037595350",children:"tree-shaking \u6548\u679c\u63a2\u8ba8"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,r.RP)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},5680:(e,n,t)=>{t.d(n,{RP:()=>a});var s=t(6540);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,s)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,s,r=function(e,n){if(null==e)return{};var t,s,r={},i=Object.keys(e);for(s=0;s<i.length;s++)t=i[s],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)t=i[s],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var d=s.createContext({}),a=function(e){var n=s.useContext(d),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},l={inlineCode:"code",wrapper:function(e){var n=e.children;return s.createElement(s.Fragment,{},n)}},p=s.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,d=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),h=a(t),m=r,x=h["".concat(d,".").concat(m)]||h[m]||l[m]||i;return t?s.createElement(x,o(o({ref:n},p),{},{components:t})):s.createElement(x,o({ref:n},p))}));p.displayName="MDXCreateElement"},7482:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/ast-9a58d91e3f6dbddb793d7162609b453a.png"},218:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/module-1-7d2b39b84fd35f8f399be242478a5923.png"},6465:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/module-2-3e0462951c327ce9e21284000a9e9b2d.png"},4450:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/scope-1db39e2b09b0cd28c0ecb5cb2d27b755.png"},171:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/search-node-e4d650b586ba17caa036efd87f1b60fd.png"},8080:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/tree-shaking-cec7faefe8684ab167f7b0d14fe4d9b0.png"},8581:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/usedExports-dist-164bce755595c46fb53cd341aa409891.png"}}]);